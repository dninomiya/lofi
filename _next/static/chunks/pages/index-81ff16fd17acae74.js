(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1841)}])},1841:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var r=n(4051),i=n.n(r),a=n(5893),o=n(6256),l=n(6257),c=n(7294),s=n(1510),u=n(944),d=function(){var e=(0,c.useState)(),t=e[0],n=e[1];return(0,c.useEffect)((function(){n(new Date);var e=setInterval((function(){n(new Date)}),1e3);return function(){clearInterval(e)}}),[]),(0,a.jsx)("p",{className:"text-sm hidden lg:block",children:t&&(0,s.Z)(t,"M\u6708d\u65e5(eee) HH\u6642mm\u5206ss\u79d2",{locale:u.Z})})},f=n(7536),m=n(9218),x=n(6096),p=n(8386),h=n(6159),v=n(9435),b=n(6622),j=n(5690),y=function(){(0,h.XB)(v.I8).then((function(){j.ZP.success("\u300c".concat(b.T.title,"\u300d\u3078\u3088\u3046\u3053\u305d\uff01"),{icon:"\ud83d\udc4b\ud83c\udffb"})}))},g=function(){(0,h.w7)(v.I8)},w=n(1294);n(8100);function N(e,t,n,r,i,a,o){try{var l=e[a](o),c=l.value}catch(s){return void n(s)}l.done?t(c):Promise.resolve(c).then(r,i)}function O(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){N(a,r,i,o,l,"next",e)}function l(e){N(a,r,i,o,l,"throw",e)}o(void 0)}))}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){k(e,t,n[t])}))}return e}(function(){var e=O(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,w.JU)((0,w.hJ)(v.db,"rooms")),a=S({},t,{rid:r.id,createdAt:Date.now(),users:[n.id]}),e.next=4,(0,w.pl)(r,S({},a,{rid:r.id,createdAt:Date.now()}));case 4:return e.abrupt("return",r.id);case 5:case"end":return e.stop()}}),e)})))})(),function(){var e=O(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,w.JU)(v.db,"rooms/".concat(t)),e.next=3,(0,w.QT)(n);case 3:return r=e.sent.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))}();var C=function(){var e=O(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,w.hJ)(v.db,"rooms/".concat(t,"/messages")),a=S({},n,{createdAt:Date.now()}),e.abrupt("return",(0,w.ET)(r,a));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}function E(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var _=function(e){var t=e.isVisible,n=(0,f.cI)({mode:"onChange"}),r=n.handleSubmit,i=n.register,o=n.reset,l=n.getValues,s=n.formState.isValid,u=i("body",{required:!0}),d=u.ref,h=E(u,["ref"]),v=(0,p.a)(),b=(0,c.useRef)();if((0,m.y1)("f",(function(e){var t;null===(t=b.current)||void 0===t||t.focus(),e.preventDefault()})),(0,c.useEffect)((function(){var e;b.current&&(null===(e=b.current)||void 0===e||e.focus())}),[t]),void 0===v)return null;if(null===v)return(0,a.jsxs)("p",{className:"mb-6",children:[(0,a.jsx)("button",{onClick:y,className:"text-pink-600",children:"\u533f\u540d\u3067\u53c2\u52a0"}),"\u3057\u3066\u30b3\u30e1\u30f3\u30c8\u3059\u308b"]});var j=function(e){C("global",{name:v.name,emoji:v.emoji,body:e.body}),o()};return(0,a.jsxs)("form",{className:"mb-1 text-right",onSubmit:r(j),children:[(0,a.jsx)(x.Z,V({onKeyDown:function(e){e.metaKey&&"Enter"===e.key&&s&&j(l())},placeholder:"\u3061\u3087\u3063\u3068\u4e00\u606f...\u2615\ufe0f",autoFocus:!0,className:"bg-transparent w-full resize-none rounded"},h,{ref:function(e){d(e),b.current=e}})),(0,a.jsxs)("button",{disabled:!s,className:"text-sm disabled:opacity-40 disabled:text-white text-green-400 text-glow",type:"submit",children:[(0,a.jsx)("span",{className:"emoji",children:"\u23ce"}),"(Cmd + Enter)"]})]})},D=n(6422),T=n(8616),I=n(3731);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function(){var e=(0,c.useState)(),t=e[0],n=e[1];return(0,c.useEffect)((function(){return(0,w.cf)(function(e){var t=(0,w.hJ)(v.db,"rooms/".concat(e,"/messages"));return(0,w.IO)(t,(0,w.Xo)("createdAt","desc"))}("global"),(function(e){var t=e.docs.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}({id:e.id},e.data())}));n(t)}))}),[]),void 0===t?null:(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(null===t||void 0===t?void 0:t.length)?(0,a.jsx)("ul",{className:"space-y-4",children:null===t||void 0===t?void 0:t.map((function(e){return(0,a.jsxs)("li",{children:[(0,a.jsx)("p",{className:"break-words",children:(0,a.jsx)(I.Z,{children:e.body})}),e.emoji&&e.name&&(0,a.jsxs)("p",{className:"flex mt-1 items-center space-x-1 flex-wrap text-xs opacity-60",children:[(0,a.jsx)(T.dy,{native:!0,size:16,emoji:e.emoji}),(0,a.jsx)("span",{children:e.name}),(0,a.jsx)("span",{children:(0,D.Z)(e.createdAt,{addSuffix:!0,locale:u.Z})})]})]},e.id)}))}):(0,a.jsx)("p",{children:"Empty...\ud83d\ude34"})})},q=(n(7898),n(162)),z=n(6727);function A(e){var t=e.isOpen,n=e.onClose,r=e.title,i=e.children;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(z.uT,{appear:!0,show:t,as:c.Fragment,children:(0,a.jsx)(z.Vq,{as:"div",className:"fixed inset-0 z-10 overflow-y-auto",onClose:n,children:(0,a.jsxs)("div",{className:"min-h-screen px-4 text-center",children:[(0,a.jsx)(z.uT.Child,{as:c.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)(z.Vq.Overlay,{className:"fixed inset-0"})}),(0,a.jsx)("span",{className:"inline-block h-screen align-middle","aria-hidden":"true",children:"\u200b"}),(0,a.jsx)(z.uT.Child,{as:c.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)("div",{className:"text-white inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-black shadow-xl rounded-2xl",children:[(0,a.jsx)(z.Vq.Title,{as:"h3",className:"text-lg leading-6 text-center mb-6 font-bold",children:r}),i]})})]})})})})}function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){J(e,t,n[t])}))}return e}var R=function(){var e=(0,c.useState)(!1),t=e[0],n=e[1],r=(0,c.useState)(!1),i=r[0],o=r[1],l=(0,p.a)(),s=(0,f.cI)(),u=s.handleSubmit,d=s.register,m=s.watch,x=s.control,h=s.formState.isValid;if(!l)return null;return(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{title:"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u7de8\u96c6",className:"px-2",onClick:function(){return n(!0)},children:"\ud83d\udc64"}),(0,a.jsxs)(A,{title:"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb",isOpen:t,onClose:function(){return n(!1)},children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("form",{onSubmit:u((function(e){(0,q.Nq)(l.id,e)})),className:"flex gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:function(){return o((function(e){return!e}))},className:"w-14 h-14 border-gray-800 border-2 grid place-content-center rounded-lg",children:(0,a.jsx)(T.dy,{size:32,emoji:m("emoji")||l.emoji})}),(0,a.jsx)("input",W({type:"text",autoComplete:"off",className:"flex-1 min-w-0 bg-transparent rounded border-gray-800 border-2",defaultValue:l.name},d("name",{required:!0}))),(0,a.jsx)("button",{disabled:!h,children:"\u66f4\u65b0"})]})}),i&&(0,a.jsx)("div",{children:(0,a.jsx)(f.Qr,{name:"emoji",control:x,render:function(e){return(0,a.jsx)(T.cW,{theme:"dark",title:"\u30a2\u30a4\u30b3\u30f3\u3092\u9078\u3076",emoji:"point_up",onSelect:function(t){return e.field.onChange(t.id)}})}})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-6",children:[(0,a.jsx)("button",{onClick:function(){return n(!1)},children:"\u9589\u3058\u308b"}),(0,a.jsx)("button",{className:"text-sm text-gray-700 ml-auto block",onClick:g,children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})]})]})]})},U=function(e){var t,n,r,i,o,l=e.playerState,c=e.target,s=function(){null===c||void 0===c||c.playVideo()},u=function(){null===c||void 0===c||c.pauseVideo()},d=function(){null===c||void 0===c||c.previousVideo()},f=function(){null===c||void 0===c||c.nextVideo()};return(0,m.y1)("right",f),(0,m.y1)("left",d),(0,m.y1)("space",(function(){1===(null===c||void 0===c?void 0:c.getPlayerState())?u():s()})),(0,a.jsxs)("div",{className:"flex items-center space-x-1 py-2",children:[1!==l&&(0,a.jsx)("button",{className:"flex py-2 px-1 text-2xl emoji",onClick:s,children:"\u25b6\ufe0e"}),1===l&&(0,a.jsx)("button",{className:"flex py-2 px-1 emoji text-2xl",onClick:u,children:"\u23f8"}),(0,a.jsx)("button",{className:"flex py-2 px-1 emoji text-2xl",onClick:d,children:"\u23ea"}),(0,a.jsx)("button",{className:"flex py-2 px-1 emoji text-2xl",onClick:f,children:"\u23e9"}),c&&(0,a.jsxs)("a",{className:"pl-2 flex-1",href:null===(t=c.playerInfo)||void 0===t?void 0:t.videoUrl,rel:"noreferrer",target:"_blank",children:[(0,a.jsx)("h2",{className:"font-bold truncate",children:null===(n=c.playerInfo)||void 0===n||null===(r=n.videoData)||void 0===r?void 0:r.title}),(0,a.jsx)("p",{className:"text-sm truncate",children:null===(i=c.playerInfo)||void 0===i||null===(o=i.videoData)||void 0===o?void 0:o.author})]})]})},H=n(5406),X=function(e){var t=e.onReady,n=e.onStateChange;return(0,a.jsxs)("div",{className:"fixed inset-0 w-full h-full flex items-center justify-items-center bg-black",children:[(0,a.jsx)(H.Z,{opts:{height:"390",width:"640",playerVars:{listType:"playlist",list:"PL0DVChfFgSa85wVKWF-r55_5005wRuQ4-",autoplay:1,controls:0,disablekb:1,fs:0,iv_load_policy:3,loop:1,modestbranding:1,rel:0}},onReady:function(e){t(e),e.target.setShuffle(!0),e.target.nextVideo()},className:"youtube-space",onStateChange:n}),(0,a.jsx)("div",{className:"youtube-vintage fixed inset-0"}),(0,a.jsx)("div",{className:"noise"})]})},B=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")};function K(e,t,n,r,i,a,o){try{var l=e[a](o),c=l.value}catch(s){return void n(s)}l.done?t(c):Promise.resolve(c).then(r,i)}var Q=function(){var e=(0,c.useState)(),t=e[0],n=e[1],r=(0,c.useState)(),s=r[0],u=r[1],f=(0,c.useState)(!0),m=f[0],x=f[1],h=(0,c.useState)(),j=h[0],g=h[1],w=(0,p.a)(),N=function(){var e,t=(e=i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,l.JU)(v.db,"status/online"),(0,l.cf)(t,(function(e){var t=e.data();u((null===t||void 0===t?void 0:t.count)||0)}));case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){K(a,r,i,o,l,"next",e)}function l(e){K(a,r,i,o,l,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){var e=Boolean(localStorage.getItem("chatClose"));x(!e),function(){var e=(0,o.iH)(v.WW,"connectedUsers/".concat(Date.now())),t=(0,o.iH)(v.WW,".info/connected");(0,o.jM)(t,(function(t){if(!0===t.val()){var n=(0,o.VF)(e,!0);(0,o.ae)(n).remove(),(0,o.t8)(n,!0)}}))}(),N()}),[]);return(0,a.jsx)("div",{children:(0,a.jsxs)("main",{className:"relative",children:[(0,a.jsx)(X,{onReady:function(e){n(e.target)},onStateChange:function(e){var t=e.data;g(t)}}),(0,a.jsxs)("div",{className:"flex flex-col fixed inset-0 z-10",children:[(0,a.jsxs)("header",{className:"py-4 px-6 bg-black text-white flex items-center gap-2",children:[(0,a.jsx)("h1",{children:b.T.title}),(0,a.jsx)("span",{className:"flex-1"}),(0,a.jsx)("button",{title:"\u30c1\u30e3\u30c3\u30c8\u3092".concat(m?"\u975e\u8868\u793a":"\u8868\u793a"),className:B("px-2",!m&&"opacity-40"),onClick:function(){x((function(e){var t=!e;return t?localStorage.removeItem("chatClose"):localStorage.setItem("chatClose","true"),t}))},children:"\ud83d\udcac"}),w?(0,a.jsx)(R,{}):(0,a.jsx)("button",{onClick:y,children:"\u53c2\u52a0"}),(0,a.jsx)("a",{href:"https://github.com/dninomiya/lofi/wiki",target:"_blank",rel:"noreferrer",className:"px-2",title:"\u3053\u306e\u30b5\u30a4\u30c8\u306b\u3064\u3044\u3066",children:"\u2139\ufe0f"}),(0,a.jsx)(d,{})]}),(0,a.jsxs)("main",{className:"flex-1 grid grid-cols-1 lg:grid-cols-3 overflow-hidden",children:[(0,a.jsx)("div",{className:"py-4 px-6 col-span-2 lg:block hidden",onClick:function(){return null===t||void 0===t?void 0:t.playVideo()},children:void 0!==s&&(0,a.jsxs)("p",{className:"opacity-40 text-sm",children:[s.toLocaleString(),"\u4eba\u304c\u3082\u304f\u3082\u304f\u4e2d..."]})}),(0,a.jsx)("div",{className:B("col-span-1 p-4 h-full overflow-hidden",!m&&"hidden"),children:(0,a.jsxs)("div",{className:"rounded-md bg-black bg-opacity-30 p-4 lg:p-6 text-white flex flex-col h-full",children:[(0,a.jsx)(_,{isVisible:m}),(0,a.jsx)(Z,{})]})})]}),(0,a.jsx)("footer",{className:"flex px-6 items-center bg-black z-10 text-white justify-between",children:t?(0,a.jsx)(U,{playerState:j,target:t}):(0,a.jsx)("div",{})})]})]})})}}},function(e){e.O(0,[229,961,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);