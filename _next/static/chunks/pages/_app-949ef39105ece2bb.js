(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6159:function(e,t,n){"use strict";n.d(t,{c4:function(){return ke},v0:function(){return Yt},Aj:function(){return Oe},rh:function(){return gt},w7:function(){return Me}});var i=n(4444),r=n(2238);function s(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}Object.create;Object.create;var o=n(3333),a=n(8463);function c(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const l=c,h=new i.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),u=new o.Yd("@firebase/auth");function d(e,...t){u.logLevel<=o.in.ERROR&&u.error(`Auth (${r.Jn}): ${e}`,...t)}function f(e,...t){throw y(e,...t)}function p(e,...t){return y(e,...t)}function g(e,t,n){const r=Object.assign(Object.assign({},l()),{[t]:n});return new i.LL("auth","Firebase",r).create(t,{appName:e.name})}function m(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&f(e,"argument-error"),g(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function y(e,...t){if("string"!==typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return h.create(e,...t)}function _(e,t,...n){if(!e)throw y(t,...n)}function v(e){const t="INTERNAL ASSERTION FAILED: "+e;throw d(t),new Error(t)}function w(e,t){e||v(t)}const b=new Map;function T(e){w(e instanceof Function,"Expected a class definition");let t=b.get(e);return t?(w(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,b.set(e,t),t)}function I(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function E(){return"http:"===C()||"https:"===C()}function C(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class k{constructor(e,t){this.shortDelay=e,this.longDelay=t,w(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(E()||(0,i.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function S(e,t){w(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class N{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void v("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void v("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void v("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const A={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},R=new k(3e4,6e4);function P(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function x(e,t,n,r,s={}){return D(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),N.fetch()(M(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function D(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},A),t);try{const t=new L(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw F(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw F(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw F(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw g(e,a,o);f(e,a)}}catch(s){if(s instanceof i.ZR)throw s;f(e,"network-request-failed")}}async function O(e,t,n,i,r={}){const s=await x(e,t,n,i,r);return"mfaPendingCredential"in s&&f(e,"multi-factor-auth-required",{_serverResponse:s}),s}function M(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?S(e.config,r):`${e.config.apiScheme}://${r}`}class L{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(p(this.auth,"network-request-failed"))),R.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function F(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=p(e,t,i);return r.customData._tokenResponse=n,r}function U(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function V(e){return 1e3*Number(e)}function q(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return d("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.tV)(n);return e?JSON.parse(e):(d("Failed to decode base64 JWT payload"),null)}catch(s){return d("Caught error parsing JWT payload as JSON",s),null}}async function j(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof i.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class ${constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class G{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=U(this.lastLoginAt),this.creationTime=U(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function B(e){var t;const n=e.auth,i=await e.getIdToken(),r=await j(e,async function(e,t){return x(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));_(null===r||void 0===r?void 0:r.users.length,n,"internal-error");const o=r.users[0];e._notifyReloadListener(o);const a=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?o.providerUserInfo.map((e=>{var{providerId:t}=e,n=s(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const c=(l=e.providerData,h=a,[...l.filter((e=>!h.some((t=>t.providerId===e.providerId)))),...h]);var l,h;const u=e.isAnonymous,d=!(e.email&&o.passwordHash)&&!(null===c||void 0===c?void 0:c.length),f=!!u&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new G(o.createdAt,o.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class z{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_(e.idToken,"internal-error"),_("undefined"!==typeof e.idToken,"internal-error"),_("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){const t=q(e);return _(t,"internal-error"),_("undefined"!==typeof t.exp,"internal-error"),_("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return _(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await D(e,{},(async()=>{const n=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=M(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",N.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new z;return n&&(_("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(_("string"===typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(_("number"===typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new z,this.toJSON())}_performRefresh(){return v("not implemented")}}function K(e,t){_("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class W{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=s(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new G(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await j(this,this.stsTokenManager.getToken(this.auth,e));return _(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.m9)(e),r=await n.getIdToken(t),s=q(r);_(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"===typeof s.firebase?s.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:U(V(s.auth_time)),issuedAtTime:U(V(s.iat)),expirationTime:U(V(s.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.m9)(e);await B(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(_(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new W(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){_(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await B(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await j(this,async function(e,t){return x(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:T,stsTokenManager:I}=t;_(v&&I,e,"internal-error");const E=z.fromJSON(this.name,I);_("string"===typeof v,e,"internal-error"),K(h,e.name),K(u,e.name),_("boolean"===typeof w,e,"internal-error"),_("boolean"===typeof b,e,"internal-error"),K(d,e.name),K(f,e.name),K(p,e.name),K(g,e.name),K(m,e.name),K(y,e.name);const C=new W({uid:v,auth:e,email:u,emailVerified:w,displayName:h,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return T&&Array.isArray(T)&&(C.providerData=T.map((e=>Object.assign({},e)))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t,n=!1){const i=new z;i.updateFromServerResponse(t);const r=new W({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await B(r),r}}class H{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}H.type="NONE";const Y=H;function X(e,t,n){return`firebase:${e}:${t}:${n}`}class Q{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=X(this.userKey,i.apiKey,r),this.fullPersistenceKey=X("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?W._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Q(T(Y),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||T(Y);const s=X(n,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(s);if(t){const n=W._fromJSON(e,t);l!==r&&(o=n),r=l;break}}catch(c){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(c){}}))),new Q(r,e,n)):new Q(r,e,n)}}function J(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Z(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(re(t))return"Blackberry";if(se(t))return"Webos";if(ee(t))return"Safari";if((t.includes("chrome/")||te(t))&&!t.includes("edge/"))return"Chrome";if(ie(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Z(e=(0,i.z$)()){return/firefox\//i.test(e)}function ee(e=(0,i.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function te(e=(0,i.z$)()){return/crios\//i.test(e)}function ne(e=(0,i.z$)()){return/iemobile/i.test(e)}function ie(e=(0,i.z$)()){return/android/i.test(e)}function re(e=(0,i.z$)()){return/blackberry/i.test(e)}function se(e=(0,i.z$)()){return/webos/i.test(e)}function oe(e=(0,i.z$)()){return/iphone|ipad|ipod/i.test(e)}function ae(e=(0,i.z$)()){return oe(e)||ie(e)||se(e)||re(e)||/windows phone/i.test(e)||ne(e)}function ce(e,t=[]){let n;switch(e){case"Browser":n=J((0,i.z$)());break;case"Worker":n=`${J((0,i.z$)())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.Jn}/${s}`}class le{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ue(this),this.idTokenSubscription=new ue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=T(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Q.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(r){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e)):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===n||void 0===n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);i&&i!==r||!(null===s||void 0===s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(_(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await B(e)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,i.m9)(e):null;return t&&_(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&_(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(T(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&T(e)||this._popupRedirectResolver;_(t,this,"argument-error"),this.redirectPersistenceManager=await Q.create(this,[T(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"===typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return _(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"===typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ce(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function he(e){return(0,i.m9)(e)}class ue{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)((e=>this.observer=e))}get next(){return _(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class de{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return v("not implemented")}_getIdTokenResponse(e){return v("not implemented")}_linkToIdToken(e,t){return v("not implemented")}_getReauthenticationResolver(e){return v("not implemented")}}async function fe(e,t){return x(e,"POST","/v1/accounts:update",t)}class pe extends de{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new pe(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new pe(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPassword",P(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{email:this._email,oobCode:this._password});default:f(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return fe(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return O(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:f(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ge(e,t){return O(e,"POST","/v1/accounts:signInWithIdp",P(e,t))}class me extends de{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new me(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):f("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=s(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new me(n,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){return ge(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,ge(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ge(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}const ye={USER_NOT_FOUND:"user-not-found"};class _e extends de{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new _e({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new _e({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await O(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t));if(n.temporaryProof)throw F(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return O(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ye)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new _e({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class ve{constructor(e){var t,n,r,s,o,a;const c=(0,i.zd)((0,i.pd)(e)),l=null!==(t=c.apiKey)&&void 0!==t?t:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);_(l&&h&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=h,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.zd)((0,i.pd)(e)).link,n=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,r=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(r?(0,i.zd)((0,i.pd)(r)).link:null)||r||n||t||e}(e);try{return new ve(t)}catch(n){return null}}}class we{constructor(){this.providerId=we.PROVIDER_ID}static credential(e,t){return pe._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ve.parseLink(t);return _(n,"argument-error"),pe._fromEmailAndCode(e,n.code,n.tenantId)}}we.PROVIDER_ID="password",we.EMAIL_PASSWORD_SIGN_IN_METHOD="password",we.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class be{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Te extends be{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ie extends Te{constructor(){super("facebook.com")}static credential(e){return me._fromParams({providerId:Ie.PROVIDER_ID,signInMethod:Ie.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ie.credentialFromTaggedObject(e)}static credentialFromError(e){return Ie.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ie.credential(e.oauthAccessToken)}catch(t){return null}}}Ie.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ie.PROVIDER_ID="facebook.com";class Ee extends Te{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return me._fromParams({providerId:Ee.PROVIDER_ID,signInMethod:Ee.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ee.credentialFromTaggedObject(e)}static credentialFromError(e){return Ee.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ee.credential(t,n)}catch(i){return null}}}Ee.GOOGLE_SIGN_IN_METHOD="google.com",Ee.PROVIDER_ID="google.com";class Ce extends Te{constructor(){super("github.com")}static credential(e){return me._fromParams({providerId:Ce.PROVIDER_ID,signInMethod:Ce.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ce.credentialFromTaggedObject(e)}static credentialFromError(e){return Ce.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ce.credential(e.oauthAccessToken)}catch(t){return null}}}Ce.GITHUB_SIGN_IN_METHOD="github.com",Ce.PROVIDER_ID="github.com";class ke extends Te{constructor(){super("twitter.com")}static credential(e,t){return me._fromParams({providerId:ke.PROVIDER_ID,signInMethod:ke.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ke.credentialFromTaggedObject(e)}static credentialFromError(e){return ke.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ke.credential(t,n)}catch(i){return null}}}ke.TWITTER_SIGN_IN_METHOD="twitter.com",ke.PROVIDER_ID="twitter.com";class Se{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await W._fromIdTokenResponse(e,n,i),s=Ne(n);return new Se({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Ne(n);return new Se({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Ne(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Ae extends i.ZR{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Ae.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Ae(e,t,n,i)}}function Re(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ae._fromErrorAndOperation(e,n,t,i);throw n}))}async function Pe(e,t,n=!1){const i=await j(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Se._forOperation(e,"link",i)}async function xe(e,t,n=!1){const{auth:i}=e,r="reauthenticate";try{const s=await j(e,Re(i,r,t,e),n);_(s.idToken,i,"internal-error");const o=q(s.idToken);_(o,i,"internal-error");const{sub:a}=o;return _(e.uid===a,i,"user-mismatch"),Se._forOperation(e,r,s)}catch(s){throw"auth/user-not-found"===(null===s||void 0===s?void 0:s.code)&&f(i,"user-mismatch"),s}}async function De(e,t,n=!1){const i="signIn",r=await Re(e,i,t),s=await Se._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}function Oe(e,t,n,r){return(0,i.m9)(e).onAuthStateChanged(t,n,r)}function Me(e){return(0,i.m9)(e).signOut()}new WeakMap;const Le="__sak";class Fe{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Le,"1"),this.storage.removeItem(Le),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ue extends Fe{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,i.z$)();return ee(e)||oe(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=ae(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ue.type="LOCAL";const Ve=Ue;class qe extends Fe{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}qe.type="SESSION";const je=qe;class $e{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new $e(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ge(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}$e.receivers=[];class Be{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=Ge("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(l),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function ze(){return window}function Ke(){return"undefined"!==typeof ze().WorkerGlobalScope&&"function"===typeof ze().importScripts}const We="firebaseLocalStorageDb",He="firebaseLocalStorage",Ye="fbase_key";class Xe{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Qe(e,t){return e.transaction([He],t?"readwrite":"readonly").objectStore(He)}function Je(){const e=indexedDB.open(We,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(He,{keyPath:Ye})}catch(i){n(i)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(He)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(We);return new Xe(e).toPromise()}(),t(await Je()))}))}))}async function Ze(e,t,n){const i=Qe(e,!0).put({[Ye]:t,value:n});return new Xe(i).toPromise()}function et(e,t){const n=Qe(e,!0).delete(t);return new Xe(n).toPromise()}class tt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Je()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ke()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$e._getInstance(Ke()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Be(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Je();return await Ze(e,Le,"1"),await et(e,Le),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Ze(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Qe(e,!1).get(t),i=await new Xe(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>et(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Qe(e,!1).getAll();return new Xe(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}tt.type="LOCAL";const nt=tt;function it(e){return new Promise(((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=p("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(i)}))}function rt(e){return`__${e}${Math.floor(1e6*Math.random())}`}rt("rcb"),new k(3e4,6e4);const st="recaptcha";async function ot(e,t,n){var i;const r=await n.verify();try{let s;if(_("string"===typeof r,e,"argument-error"),_(n.type===st,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){_("enroll"===t.type,e,"internal-error");const n=await function(e,t){return x(e,"POST","/v2/accounts/mfaEnrollment:start",P(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{_("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;_(n,e,"missing-multi-factor-info");const o=await function(e,t){return x(e,"POST","/v2/accounts/mfaSignIn:start",P(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return x(e,"POST","/v1/accounts:sendVerificationCode",P(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}class at{constructor(e){this.providerId=at.PROVIDER_ID,this.auth=he(e)}verifyPhoneNumber(e,t){return ot(this.auth,e,(0,i.m9)(t))}static credential(e,t){return _e._fromVerification(e,t)}static credentialFromResult(e){const t=e;return at.credentialFromTaggedObject(t)}static credentialFromError(e){return at.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?_e._fromTokenResponse(t,n):null}}function ct(e,t){return t?T(t):(_(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}at.PROVIDER_ID="phone",at.PHONE_SIGN_IN_METHOD="phone";class lt extends de{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ge(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ge(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ge(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ht(e){return De(e.auth,new lt(e),e.bypassAuthState)}function ut(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),xe(n,new lt(e),e.bypassAuthState)}async function dt(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),Pe(n,new lt(e),e.bypassAuthState)}class ft{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ht;case"linkViaPopup":case"linkViaRedirect":return dt;case"reauthViaPopup":case"reauthViaRedirect":return ut;default:f(this.auth,"internal-error")}}resolve(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pt=new k(2e3,1e4);async function gt(e,t,n){const i=he(e);m(e,t,be);const r=ct(i,n);return new mt(i,"signInViaPopup",t,r).executeNotNull()}class mt extends ft{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,mt.currentPopupAction&&mt.currentPopupAction.cancel(),mt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _(e,this.auth,"internal-error"),e}async onExecution(){w(1===this.filter.length,"Popup operations only handle one event");const e=Ge();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(p(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(p(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(p(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,pt.get())};e()}}mt.currentPopupAction=null;const yt=new Map;class _t extends ft{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=yt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=wt(t),i=vt(e);if(!(await i._isAvailable()))return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}yt.set(this.auth._key(),e)}return this.bypassAuthState||yt.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function vt(e){return T(e._redirectPersistence)}function wt(e){return X("pendingRedirect",e.config.apiKey,e.name)}async function bt(e,t,n=!1){const i=he(e),r=ct(i,t),s=new _t(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class Tt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Et(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Et(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(p(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(It(e))}saveEventToCache(e){this.cachedEventUids.add(It(e)),this.lastProcessedEventTime=Date.now()}}function It(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Et({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null===t||void 0===t?void 0:t.code)}const Ct=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,kt=/^https?/;async function St(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return x(e,"GET","/v1/projects",t)}(e);for(const i of t)try{if(Nt(i))return}catch(n){}f(e,"unauthorized-domain")}function Nt(e){const t=I(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!kt.test(n))return!1;if(Ct.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const At=new k(3e4,6e4);function Rt(){const e=ze().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let Pt=null;function xt(e){return Pt=Pt||function(e){return new Promise(((t,n)=>{var i,r,s;function o(){Rt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Rt(),n(p(e,"network-request-failed"))},timeout:At.get()})}if(null===(r=null===(i=ze().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=ze().gapi)||void 0===s?void 0:s.load)){const t=rt("iframefcb");return ze()[t]=()=>{gapi.load?o():n(p(e,"network-request-failed"))},it(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Pt=null,e}))}(e),Pt}const Dt=new k(5e3,15e3),Ot={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Mt=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Lt(e){const t=e.config;_(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?S(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:r.Jn},o=Mt.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,i.xO)(s).slice(1)}`}const Ft={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ut{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Vt(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const l=Object.assign(Object.assign({},Ft),{width:r.toString(),height:s.toString(),top:o,left:a}),h=(0,i.z$)().toLowerCase();n&&(c=te(h)?"_blank":n),Z(h)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.z$)()){var t;return oe(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",c),new Ut(null);const d=window.open(t||"",c,u);_(d,e,"popup-blocked");try{d.focus()}catch(f){}return new Ut(d)}const qt="__/auth/handler",jt="emulator/auth/handler";function $t(e,t,n,s,o,a){_(e.config.authDomain,e,"auth-domain-config-required"),_(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:r.Jn,eventId:o};if(t instanceof be){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof Te){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const l=c;for(const i of Object.keys(l))void 0===l[i]&&delete l[i];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${qt}`;return S(e,jt)}(e)}?${(0,i.xO)(l).slice(1)}`}const Gt="webStorageSupport";const Bt=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=je,this._completeRedirectFn=bt}async _openPopup(e,t,n,i){var r;w(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return Vt(e,$t(e,t,n,I(),i),Ge())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=$t(e,t,n,I(),i),ze().location.href=r,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(w(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await xt(e),n=ze().gapi;return _(n,e,"internal-error"),t.open({where:document.body,url:Lt(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ot,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=p(e,"network-request-failed"),s=ze().setTimeout((()=>{i(r)}),Dt.get());function o(){ze().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new Tt(e);return t.register("authEvent",(t=>{_(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gt,{type:Gt},(n=>{var i;const r=null===(i=null===n||void 0===n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==r&&t(!!r),f(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=St(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ae()||ee()||oe()}};var zt,Kt="@firebase/auth",Wt="0.19.9";class Ht{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Yt(e=(0,r.Mq)()){const t=(0,r.qX)(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=(0,r.qX)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,i.vZ)(r,null!==t&&void 0!==t?t:{}))return e;f(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Bt,persistence:[nt,Ve,je]})}zt="Browser",(0,r.Xd)(new a.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:i,authDomain:r}=n.options;return(e=>{_(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),_(!(null===r||void 0===r?void 0:r.includes(":")),"argument-error",{appName:e.name});const n={apiKey:i,authDomain:r,clientPlatform:zt,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ce(zt)},s=new le(e,n);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(T);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null===t||void 0===t?void 0:t.popupRedirectResolver)}(s,t),s})(n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,r.Xd)(new a.wA("auth-internal",(e=>(e=>new Ht(e))(he(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KN)(Kt,Wt,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(zt)),(0,r.KN)(Kt,Wt,"esm2017")},1294:function(e,t,n){"use strict";n.d(t,{ET:function(){return lu},hJ:function(){return sh},JU:function(){return oh},QT:function(){return su},ad:function(){return hh},nP:function(){return fu},cf:function(){return hu},Xo:function(){return Zh},IO:function(){return Yh},pl:function(){return au},r7:function(){return cu},ar:function(){return Qh}});var i,r=n(2238),s=n(8463),o=n(3333),a=n(4444),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},l={},h=h||{},u=c||self;function d(){}function f(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var g="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(e,t,n){return e.call.apply(e.bind,arguments)}function _(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function v(e,t,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:_).apply(null,arguments)}function w(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function b(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function T(){this.s=this.s,this.o=this.o}var I={};T.prototype.s=!1,T.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,g)&&e[g]||(e[g]=++m)}(this);delete I[e]}},T.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},C=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const i=e.length,r="string"===typeof e?e.split(""):e;for(let s=0;s<i;s++)s in r&&t.call(n,r[s],s,e)};function k(e){return Array.prototype.concat.apply([],arguments)}function S(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function N(e){return/^[\s\xa0]*$/.test(e)}var A,R=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function P(e,t){return-1!=e.indexOf(t)}function x(e,t){return e<t?-1:e>t?1:0}e:{var D=u.navigator;if(D){var O=D.userAgent;if(O){A=O;break e}}A=""}function M(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function L(e){const t={};for(const n in e)t[n]=e[n];return t}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(e,t){let n,i;for(let r=1;r<arguments.length;r++){for(n in i=arguments[r],i)e[n]=i[n];for(let t=0;t<F.length;t++)n=F[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function V(e){return V[" "](e),e}V[" "]=d;var q,j=P(A,"Opera"),$=P(A,"Trident")||P(A,"MSIE"),G=P(A,"Edge"),B=G||$,z=P(A,"Gecko")&&!(P(A.toLowerCase(),"webkit")&&!P(A,"Edge"))&&!(P(A,"Trident")||P(A,"MSIE"))&&!P(A,"Edge"),K=P(A.toLowerCase(),"webkit")&&!P(A,"Edge");function W(){var e=u.document;return e?e.documentMode:void 0}e:{var H="",Y=function(){var e=A;return z?/rv:([^\);]+)(\)|;)/.exec(e):G?/Edge\/([\d\.]+)/.exec(e):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):K?/WebKit\/(\S+)/.exec(e):j?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(Y&&(H=Y?Y[1]:""),$){var X=W();if(null!=X&&X>parseFloat(H)){q=String(X);break e}}q=H}var Q,J={};function Z(){return function(e){var t=J;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=R(String(q)).split("."),n=R("9").split("."),i=Math.max(t.length,n.length);for(let o=0;0==e&&o<i;o++){var r=t[o]||"",s=n[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;e=x(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||x(0==r[2].length,0==s[2].length)||x(r[2],s[2]),r=r[3],s=s[3]}while(0==e)}return 0<=e}))}if(u.document&&$){var ee=W();Q=ee||(parseInt(q,10)||void 0)}else Q=void 0;var te=Q,ne=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{u.addEventListener("test",d,t),u.removeEventListener("test",d,t)}catch(n){}return e}();function ie(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function re(e,t){if(ie.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(z){e:{try{V(t.nodeName);var r=!0;break e}catch(s){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:se[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&re.Z.h.call(this)}}ie.prototype.h=function(){this.defaultPrevented=!0},b(re,ie);var se={2:"touch",3:"pen",4:"mouse"};re.prototype.h=function(){re.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var oe="closure_listenable_"+(1e6*Math.random()|0),ae=0;function ce(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ia=r,this.key=++ae,this.ca=this.fa=!1}function le(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function he(e){this.src=e,this.g={},this.h=0}function ue(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=E(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(le(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function de(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==i)return r}return-1}he.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=de(e,t,i,r);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ce(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var fe="closure_lm_"+(1e6*Math.random()|0),pe={};function ge(e,t,n,i,r){if(i&&i.once)return ye(e,t,n,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ge(e,t[s],n,i,r);return null}return n=Ee(n),e&&e[oe]?e.N(t,n,p(i)?!!i.capture:!!i,r):me(e,t,n,!1,i,r)}function me(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=p(r)?!!r.capture:!!r,a=Te(e);if(a||(e[fe]=a=new he(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}var t=be;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)ne||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(we(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function ye(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ye(e,t[s],n,i,r);return null}return n=Ee(n),e&&e[oe]?e.O(t,n,p(i)?!!i.capture:!!i,r):me(e,t,n,!0,i,r)}function _e(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)_e(e,t[s],n,i,r);else i=p(i)?!!i.capture:!!i,n=Ee(n),e&&e[oe]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=de(s=e.g[t],n,i,r))&&(le(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=Te(e))&&(t=e.g[t.toString()],e=-1,t&&(e=de(t,n,i,r)),(n=-1<e?t[e]:null)&&ve(n))}function ve(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[oe])ue(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(we(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=Te(t))?(ue(n,e),0==n.h&&(n.src=null,t[fe]=null)):le(e)}}}function we(e){return e in pe?pe[e]:pe[e]="on"+e}function be(e,t){if(e.ca)e=!0;else{t=new re(t,this);var n=e.listener,i=e.ia||e.src;e.fa&&ve(e),e=n.call(i,t)}return e}function Te(e){return(e=e[fe])instanceof he?e:null}var Ie="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ee(e){return"function"===typeof e?e:(e[Ie]||(e[Ie]=function(t){return e.handleEvent(t)}),e[Ie])}function Ce(){T.call(this),this.i=new he(this),this.P=this,this.I=null}function ke(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"===typeof t)t=new ie(t,e);else if(t instanceof ie)t.target=t.target||e;else{var r=t;U(t=new ie(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=Se(o,i,!0,t)&&r}if(r=Se(o=t.g=e,i,!0,t)&&r,r=Se(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=Se(o=t.g=n[s],i,!1,t)&&r}function Se(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&ue(e.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}b(Ce,T),Ce.prototype[oe]=!0,Ce.prototype.removeEventListener=function(e,t,n,i){_e(this,e,t,n,i)},Ce.prototype.M=function(){if(Ce.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)le(n[i]);delete t.g[e],t.h--}}this.I=null},Ce.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Ce.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Ne=u.JSON.stringify;function Ae(){var e=Le;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Re,Pe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new xe),(e=>e.reset()));class xe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function De(e){u.setTimeout((()=>{throw e}),0)}function Oe(e,t){Re||function(){var e=u.Promise.resolve(void 0);Re=function(){e.then(Fe)}}(),Me||(Re(),Me=!0),Le.add(e,t)}var Me=!1,Le=new class{constructor(){this.h=this.g=null}add(e,t){const n=Pe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Fe(){for(var e;e=Ae();){try{e.h.call(e.g)}catch(n){De(n)}var t=Pe;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Me=!1}function Ue(e,t){Ce.call(this),this.h=e||1,this.g=t||u,this.j=v(this.kb,this),this.l=Date.now()}function Ve(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function qe(e,t,n){if("function"===typeof e)n&&(e=v(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=v(e.handleEvent,e)}return 2147483647<Number(t)?-1:u.setTimeout(e,t||0)}function je(e){e.g=qe((()=>{e.g=null,e.i&&(e.i=!1,je(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}b(Ue,Ce),(i=Ue.prototype).da=!1,i.S=null,i.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ke(this,"tick"),this.da&&(Ve(this),this.start()))}},i.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},i.M=function(){Ue.Z.M.call(this),Ve(this),delete this.g};class $e extends T{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:je(this)}M(){super.M(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ge(e){T.call(this),this.h=e,this.g={}}b(Ge,T);var Be=[];function ze(e,t,n,i){Array.isArray(n)||(n&&(Be[0]=n.toString()),n=Be);for(var r=0;r<n.length;r++){var s=ge(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Ke(e){M(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ve(e)}),e),e.g={}}function We(){this.g=!0}function He(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Ne(n)}catch(a){return t}}(e,n)+(i?" "+i:"")}))}Ge.prototype.M=function(){Ge.Z.M.call(this),Ke(this)},Ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Aa=function(){this.g=!1},We.prototype.info=function(){};var Ye={},Xe=null;function Qe(){return Xe=Xe||new Ce}function Je(e){ie.call(this,Ye.Ma,e)}function Ze(e){const t=Qe();ke(t,new Je(t,e))}function et(e,t){ie.call(this,Ye.STAT_EVENT,e),this.stat=t}function tt(e){const t=Qe();ke(t,new et(t,e))}function nt(e,t){ie.call(this,Ye.Na,e),this.size=t}function it(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return u.setTimeout((function(){e()}),t)}Ye.Ma="serverreachability",b(Je,ie),Ye.STAT_EVENT="statevent",b(et,ie),Ye.Na="timingevent",b(nt,ie);var rt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},st={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ot(){}function at(e){return e.h||(e.h=e.i())}function ct(){}ot.prototype.h=null;var lt,ht={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ut(){ie.call(this,"d")}function dt(){ie.call(this,"c")}function ft(){}function pt(e,t,n,i){this.l=e,this.j=t,this.m=n,this.X=i||1,this.V=new Ge(this),this.P=mt,e=B?125:void 0,this.W=new Ue(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}b(ut,ie),b(dt,ie),b(ft,ot),ft.prototype.g=function(){return new XMLHttpRequest},ft.prototype.i=function(){return{}},lt=new ft;var mt=45e3,yt={},_t={};function vt(e,t,n){e.K=1,e.v=$t(Lt(t)),e.s=n,e.U=!0,wt(e,null)}function wt(e,t){e.F=Date.now(),Et(e),e.A=Lt(e.v);var n=e.A,i=e.X;Array.isArray(i)||(i=[String(i)]),tn(n.h,"t",i),e.C=0,n=e.l.H,e.h=new gt,e.g=ii(e.l,n?t:null,!e.s),0<e.O&&(e.L=new $e(v(e.Ia,e,e.g),e.O)),ze(e.V,e.g,"readystatechange",e.gb),t=e.H?L(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ze(1),function(e,t,n,i,r,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function bt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Tt(e,t,n){let i,r=!0;for(;!e.I&&e.C<n.length;){if(i=It(e,n),i==_t){4==t&&(e.o=4,tt(14),r=!1),He(e.j,e.m,null,"[Incomplete Response]");break}if(i==yt){e.o=4,tt(15),He(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}He(e.j,e.m,i,null),At(e,i)}bt(e)&&i!=_t&&i!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,tt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yn(t),t.L=!0,tt(11))):(He(e.j,e.m,n,"[Invalid Chunked Response]"),Nt(e),St(e))}function It(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?_t:(n=Number(t.substring(n,i)),isNaN(n)?yt:(i+=1)+n>t.length?_t:(t=t.substr(i,n),e.C=i+n,t))}function Et(e){e.Y=Date.now()+e.P,Ct(e,e.P)}function Ct(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=it(v(e.eb,e),t)}function kt(e){e.B&&(u.clearTimeout(e.B),e.B=null)}function St(e){0==e.l.G||e.I||Jn(e.l,e)}function Nt(e){kt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ve(e.W),Ke(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function At(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||ln(n.i,e)))if(n.I=e.N,!e.J&&ln(n.i,e)&&3==n.G){try{var i=n.Ca.g.parse(t)}catch(l){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Qn(n),qn(n)}Hn(n),tt(18)}}else n.ta=r[1],0<n.ta-n.U&&37500>r[2]&&n.N&&0==n.A&&!n.v&&(n.v=it(v(n.ab,n),6e3));if(1>=cn(n.i)&&n.ka){try{n.ka()}catch(l){}n.ka=void 0}}else ei(n,11)}else if((e.J||n.g==e)&&Qn(n),!N(t))for(r=n.Ca.g.parse(t),t=0;t<r.length;t++){let l=r[t];if(n.U=l[0],l=l[1],2==n.G)if("c"==l[0]){n.J=l[1],n.la=l[2];const t=l[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const r=l[4];null!=r&&(n.za=r,n.h.info("SVER="+n.za));const h=l[5];null!=h&&"number"===typeof h&&0<h&&(i=1.5*h,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.i;!s.g&&(P(e,"spdy")||P(e,"quic")||P(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(hn(s,s.h),s.h=null))}if(i.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.sa=e,jt(i.F,i.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((i=n).oa=ni(i,i.H?i.la:null,i.W),o.J){un(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(kt(a),Et(a)),i.g=o}else Wn(i);0<n.l.length&&Gn(n)}else"stop"!=l[0]&&"close"!=l[0]||ei(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?ei(n,7):Vn(n):"noop"!=l[0]&&n.j&&n.j.wa(l),n.A=0)}Ze(4)}catch(l){}}function Rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"===typeof e)C(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(f(e)||"string"===typeof e){n=[];for(var i=e.length,r=0;r<i;r++)n.push(r)}else for(r in n=[],i=0,e)n[i++]=r;i=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length;for(var s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}}function Pt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(e)if(e instanceof Pt)for(n=e.T(),i=0;i<n.length;i++)this.set(n[i],e.get(n[i]));else for(i in e)this.set(i,e[i])}function xt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var i=e.g[t];Dt(e.h,i)&&(e.g[n++]=i),t++}e.g.length=n}if(e.i!=e.g.length){var r={};for(n=t=0;t<e.g.length;)Dt(r,i=e.g[t])||(e.g[n++]=i,r[i]=1),t++;e.g.length=n}}function Dt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(i=pt.prototype).setTimeout=function(e){this.P=e},i.gb=function(e){e=e.target;const t=this.L;t&&3==On(e)?t.l():this.Ia(e)},i.Ia=function(e){try{if(e==this.g)e:{const h=On(this.g);var t=this.g.Da();const d=this.g.ba();if(!(3>h)&&(3!=h||B||this.g&&(this.h.h||this.g.ga()||Mn(this.g)))){this.I||4!=h||7==t||Ze(8==t||0>=d?3:2),kt(this);var n=this.g.ba();this.N=n;t:if(bt(this)){var i=Mn(this.g);e="";var r=i.length,s=4==On(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Nt(this),St(this);var o="";break t}this.h.i=new u.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,i,r,s,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,tt(12),Nt(this),St(this);break e}He(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,At(this,n)}this.U?(Tt(this,h,o),B&&this.i&&3==h&&(ze(this.V,this.W,"tick",this.fb),this.W.start())):(He(this.j,this.m,o,null),At(this,o)),4==h&&Nt(this),this.i&&!this.I&&(4==h?Jn(this.l,this):(this.i=!1,Et(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,tt(12)):(this.o=0,tt(13)),Nt(this),St(this)}}}catch(h){}},i.fb=function(){if(this.g){var e=On(this.g),t=this.g.ga();this.C<t.length&&(kt(this),Tt(this,e,t),this.i&&4!=e&&Et(this))}},i.cancel=function(){this.I=!0,Nt(this)},i.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Ze(3),tt(17)),Nt(this),this.o=2,St(this)):Ct(this,this.Y-e)},(i=Pt.prototype).R=function(){xt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},i.T=function(){return xt(this),this.g.concat()},i.get=function(e,t){return Dt(this.h,e)?this.h[e]:t},i.set=function(e,t){Dt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},i.forEach=function(e,t){for(var n=this.T(),i=0;i<n.length;i++){var r=n[i],s=this.get(r);e.call(t,s,r,this)}};var Ot=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Mt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Mt){this.g=void 0!==t?t:e.g,Ft(this,e.j),this.s=e.s,Ut(this,e.i),Vt(this,e.m),this.l=e.l,t=e.h;var n=new Qt;n.i=t.i,t.g&&(n.g=new Pt(t.g),n.h=t.h),qt(this,n),this.o=e.o}else e&&(n=String(e).match(Ot))?(this.g=!!t,Ft(this,n[1]||"",!0),this.s=Gt(n[2]||""),Ut(this,n[3]||"",!0),Vt(this,n[4]),this.l=Gt(n[5]||"",!0),qt(this,n[6]||"",!0),this.o=Gt(n[7]||"")):(this.g=!!t,this.h=new Qt(null,this.g))}function Lt(e){return new Mt(e)}function Ft(e,t,n){e.j=n?Gt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ut(e,t,n){e.i=n?Gt(t,!0):t}function Vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function qt(e,t,n){t instanceof Qt?(e.h=t,function(e,t){t&&!e.j&&(Jt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Zt(this,t),tn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=Bt(t,Yt)),e.h=new Qt(t,e.g))}function jt(e,t,n){e.h.set(t,n)}function $t(e){return jt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Gt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Bt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,zt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function zt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Bt(t,Kt,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Bt(t,Kt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Bt(n,"/"==n.charAt(0)?Ht:Wt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Bt(n,Xt)),e.join("")};var Kt=/[#\/\?@]/g,Wt=/[#\?:]/g,Ht=/[#\?]/g,Yt=/[#\?@]/g,Xt=/#/g;function Qt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Jt(e){e.g||(e.g=new Pt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Zt(e,t){Jt(e),t=nn(e,t),Dt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Dt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&xt(e)))}function en(e,t){return Jt(e),t=nn(e,t),Dt(e.g.h,t)}function tn(e,t,n){Zt(e,t),0<n.length&&(e.i=null,e.g.set(nn(e,t),S(n)),e.h+=n.length)}function nn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(i=Qt.prototype).add=function(e,t){Jt(this),this.i=null,e=nn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},i.forEach=function(e,t){Jt(this),this.g.forEach((function(n,i){C(n,(function(n){e.call(t,n,i,this)}),this)}),this)},i.T=function(){Jt(this);for(var e=this.g.R(),t=this.g.T(),n=[],i=0;i<t.length;i++)for(var r=e[i],s=0;s<r.length;s++)n.push(t[i]);return n},i.R=function(e){Jt(this);var t=[];if("string"===typeof e)en(this,e)&&(t=k(t,this.g.get(nn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=k(t,e[n])}return t},i.set=function(e,t){return Jt(this),this.i=null,en(this,e=nn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},i.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},i.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var i=t[n],r=encodeURIComponent(String(i));i=this.R(i);for(var s=0;s<i.length;s++){var o=r;""!==i[s]&&(o+="="+encodeURIComponent(String(i[s]))),e.push(o)}}return this.i=e.join("&")};function rn(e){this.l=e||on,u.PerformanceNavigationTiming?e=0<(e=u.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(u.g&&u.g.Ea&&u.g.Ea()&&u.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sn,on=10;function an(e){return!!e.h||!!e.g&&e.g.size>=e.j}function cn(e){return e.h?1:e.g?e.g.size:0}function ln(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function hn(e,t){e.g?e.g.add(t):e.h=t}function un(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return S(e.i)}function fn(){}function pn(){this.g=new fn}function gn(e,t,n){const i=n||"";try{Rt(e,(function(e,n){let r=e;p(e)&&(r=Ne(e)),t.push(i+n+"="+encodeURIComponent(r))}))}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function mn(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(s){}}function yn(e){this.l=e.$b||null,this.j=e.ib||!1}function _n(e,t){Ce.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=vn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rn.prototype.cancel=function(){if(this.i=dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fn.prototype.stringify=function(e){return u.JSON.stringify(e,void 0)},fn.prototype.parse=function(e){return u.JSON.parse(e,void 0)},b(yn,ot),yn.prototype.g=function(){return new _n(this.l,this.j)},yn.prototype.i=(sn={},function(){return sn}),b(_n,Ce);var vn=0;function wn(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function bn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Tn(e)}function Tn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(i=_n.prototype).open=function(e,t){if(this.readyState!=vn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Tn(this)},i.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||u).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},i.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=vn},i.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Tn(this)),this.g&&(this.readyState=3,Tn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof u.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;wn(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},i.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?bn(this):Tn(this),3==this.readyState&&wn(this)}},i.Ua=function(e){this.g&&(this.response=this.responseText=e,bn(this))},i.Ta=function(e){this.g&&(this.response=e,bn(this))},i.ha=function(){this.g&&bn(this)},i.setRequestHeader=function(e,t){this.v.append(e,t)},i.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(_n.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var In=u.JSON.parse;function En(e){Ce.call(this),this.headers=new Pt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Cn,this.K=this.L=!1}b(En,Ce);var Cn="",kn=/^https?$/i,Sn=["POST","PUT"];function Nn(e){return"content-type"==e.toLowerCase()}function An(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Rn(e),xn(e)}function Rn(e){e.D||(e.D=!0,ke(e,"complete"),ke(e,"error"))}function Pn(e){if(e.h&&"undefined"!=typeof h&&(!e.C[1]||4!=On(e)||2!=e.ba()))if(e.v&&4==On(e))qe(e.Fa,0,e);else if(ke(e,"readystatechange"),4==On(e)){e.h=!1;try{const c=e.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===c){var r=String(e.H).match(Ot)[1]||null;if(!r&&u.self&&u.self.location){var s=u.self.location.protocol;r=s.substr(0,s.length-1)}i=!kn.test(r?r.toLowerCase():"")}n=i}if(n)ke(e,"complete"),ke(e,"success");else{e.m=6;try{var o=2<On(e)?e.g.statusText:""}catch(a){o=""}e.j=o+" ["+e.ba()+"]",Rn(e)}}finally{xn(e)}}}function xn(e,t){if(e.g){Dn(e);const i=e.g,r=e.C[0]?d:null;e.g=null,e.C=null,t||ke(e,"ready");try{i.onreadystatechange=r}catch(n){}}}function Dn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(u.clearTimeout(e.A),e.A=null)}function On(e){return e.g?e.g.readyState:0}function Mn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Cn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ln(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=function(e){let t="";return M(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):jt(e,t,n))}function Fn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Un(e){this.za=0,this.l=[],this.h=new We,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Fn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Fn("baseRetryDelayMs",5e3,e),this.$a=Fn("retryDelaySeedMs",1e4,e),this.Ya=Fn("forwardChannelMaxRetries",2,e),this.ra=Fn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new rn(e&&e.concurrentRequestLimit),this.Ca=new pn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Vn(e){if(jn(e),3==e.G){var t=e.V++,n=Lt(e.F);jt(n,"SID",e.J),jt(n,"RID",t),jt(n,"TYPE","terminate"),zn(e,n),(t=new pt(e,e.h,t,void 0)).K=2,t.v=$t(Lt(n)),n=!1,u.navigator&&u.navigator.sendBeacon&&(n=u.navigator.sendBeacon(t.v.toString(),"")),!n&&u.Image&&((new Image).src=t.v,n=!0),n||(t.g=ii(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Et(t)}ti(e)}function qn(e){e.g&&(Yn(e),e.g.cancel(),e.g=null)}function jn(e){qn(e),e.u&&(u.clearTimeout(e.u),e.u=null),Qn(e),e.i.cancel(),e.m&&("number"===typeof e.m&&u.clearTimeout(e.m),e.m=null)}function $n(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&Gn(e)}function Gn(e){an(e.i)||e.m||(e.m=!0,Oe(e.Ha,e),e.C=0)}function Bn(e,t){var n;n=t?t.m:e.V++;const i=Lt(e.F);jt(i,"SID",e.J),jt(i,"RID",n),jt(i,"AID",e.U),zn(e,i),e.o&&e.s&&Ln(i,e.o,e.s),n=new pt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Kn(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hn(e.i,n),vt(n,i,t)}function zn(e,t){e.j&&Rt({},(function(e,n){jt(t,n,e)}))}function Kn(e,t,n){n=Math.min(e.l.length,n);var i=e.j?v(e.j.Oa,e.j,e):null;e:{var r=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].h;const a=r[o].g;if(n-=t,0>n)t=Math.max(0,r[o].h-100),s=!1;else try{gn(a,e,"req"+n+"_")}catch(Pi){i&&i(a)}}if(s){i=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,i}function Wn(e){e.g||e.u||(e.Y=1,Oe(e.Ga,e),e.A=0)}function Hn(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=it(v(e.Ga,e),Zn(e,e.A)),e.A++,!0)}function Yn(e){null!=e.B&&(u.clearTimeout(e.B),e.B=null)}function Xn(e){e.g=new pt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Lt(e.oa);jt(t,"RID","rpc"),jt(t,"SID",e.J),jt(t,"CI",e.N?"0":"1"),jt(t,"AID",e.U),zn(e,t),jt(t,"TYPE","xmlhttp"),e.o&&e.s&&Ln(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=$t(Lt(t)),n.s=null,n.U=!0,wt(n,e)}function Qn(e){null!=e.v&&(u.clearTimeout(e.v),e.v=null)}function Jn(e,t){var n=null;if(e.g==t){Qn(e),Yn(e),e.g=null;var i=2}else{if(!ln(e.i,t))return;n=t.D,un(e.i,t),i=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var r=e.C;ke(i=Qe(),new nt(i,n,t,r)),Gn(e)}else Wn(e);else if(3==(r=t.o)||0==r&&0<e.I||!(1==i&&function(e,t){return!(cn(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=it(v(e.Ha,e,t),Zn(e,e.C)),e.C++,!0))}(e,t)||2==i&&Hn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:ei(e,5);break;case 4:ei(e,10);break;case 3:ei(e,6);break;default:ei(e,2)}}function Zn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function ei(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var i=v(e.jb,e);n||(n=new Mt("//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Ft(n,"https"),$t(n)),function(e,t){const n=new We;if(u.Image){const i=new Image;i.onload=w(mn,n,i,"TestLoadImage: loaded",!0,t),i.onerror=w(mn,n,i,"TestLoadImage: error",!1,t),i.onabort=w(mn,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=w(mn,n,i,"TestLoadImage: timeout",!1,t),u.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else tt(2);e.G=0,e.j&&e.j.va(t),ti(e),jn(e)}function ti(e){e.G=0,e.I=-1,e.j&&(0==dn(e.i).length&&0==e.l.length||(e.i.i.length=0,S(e.l),e.l.length=0),e.j.ua())}function ni(e,t,n){let i=function(e){return e instanceof Mt?Lt(e):new Mt(e,void 0)}(n);if(""!=i.i)t&&Ut(i,t+"."+i.i),Vt(i,i.m);else{const e=u.location;i=function(e,t,n,i){var r=new Mt(null,void 0);return e&&Ft(r,e),t&&Ut(r,t),n&&Vt(r,n),i&&(r.l=i),r}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&M(e.aa,(function(e,t){jt(i,t,e)})),t=e.D,n=e.sa,t&&n&&jt(i,t,n),jt(i,"VER",e.ma),zn(e,i),i}function ii(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new En(new yn({ib:!0})):new En(e.qa)).L=e.H,t}function ri(){}function si(){if($&&!(10<=Number(te)))throw Error("Environmental error: no available transport.")}function oi(e,t){Ce.call(this),this.g=new Un(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!N(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new li(this)}function ai(e){ut.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ci(){dt.call(this),this.status=1}function li(e){this.g=e}(i=En.prototype).ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():lt.g(),this.C=this.u?at(this.u):at(lt),this.g.onreadystatechange=v(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void An(this,s)}e=n||"";const r=new Pt(this.headers);i&&Rt(i,(function(e,t){r.set(t,e)})),i=function(e){e:{var t=Nn;const n=e.length,i="string"===typeof e?e.split(""):e;for(let r=0;r<n;r++)if(r in i&&t.call(void 0,i[r],r,e)){t=r;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(r.T()),n=u.FormData&&e instanceof u.FormData,!(0<=E(Sn,t))||i||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Dn(this),0<this.B&&((this.K=function(e){return $&&Z()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.pa,this)):this.A=qe(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){An(this,s)}},i.pa=function(){"undefined"!=typeof h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ke(this,"timeout"),this.abort(8))},i.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ke(this,"complete"),ke(this,"abort"),xn(this))},i.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),xn(this,!0)),En.Z.M.call(this)},i.Fa=function(){this.s||(this.F||this.v||this.l?Pn(this):this.cb())},i.cb=function(){Pn(this)},i.ba=function(){try{return 2<On(this)?this.g.status:-1}catch(sn){return-1}},i.ga=function(){try{return this.g?this.g.responseText:""}catch(sn){return""}},i.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),In(t)}},i.Da=function(){return this.m},i.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(i=Un.prototype).ma=8,i.G=1,i.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},i.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new pt(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=L(s),U(s,this.P)):s=this.P),null===this.o&&(r.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"===typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Kn(this,r,t),jt(n=Lt(this.F),"RID",e),jt(n,"CVER",22),this.D&&jt(n,"X-HTTP-Session-Id",this.D),zn(this,n),this.o&&s&&Ln(n,this.o,s),hn(this.i,r),this.Ra&&jt(n,"TYPE","init"),this.ja?(jt(n,"$req",t),jt(n,"SID","null"),r.$=!0,vt(r,n,null)):vt(r,n,t),this.G=2}}else 3==this.G&&(e?Bn(this,e):0==this.l.length||an(this.i)||Bn(this))},i.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=it(v(this.bb,this),e)}},i.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,tt(10),qn(this),Xn(this))},i.ab=function(){null!=this.v&&(this.v=null,qn(this),Hn(this),tt(19))},i.jb=function(e){e?(this.h.info("Successfully pinged google.com"),tt(2)):(this.h.info("Failed to ping google.com"),tt(1))},(i=ri.prototype).xa=function(){},i.wa=function(){},i.va=function(){},i.ua=function(){},i.Oa=function(){},si.prototype.g=function(e,t){return new oi(e,t)},b(oi,Ce),oi.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Oe(v(e.hb,e,t))),tt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=ni(e,null,e.W),Gn(e)},oi.prototype.close=function(){Vn(this.g)},oi.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,$n(this.g,t)}else this.v?((t={}).__data__=Ne(e),$n(this.g,t)):$n(this.g,e)},oi.prototype.M=function(){this.g.j=null,delete this.j,Vn(this.g),delete this.g,oi.Z.M.call(this)},b(ai,ut),b(ci,dt),b(li,ri),li.prototype.xa=function(){ke(this.g,"a")},li.prototype.wa=function(e){ke(this.g,new ai(e))},li.prototype.va=function(e){ke(this.g,new ci(e))},li.prototype.ua=function(){ke(this.g,"b")},si.prototype.createWebChannel=si.prototype.g,oi.prototype.send=oi.prototype.u,oi.prototype.open=oi.prototype.m,oi.prototype.close=oi.prototype.close,rt.NO_ERROR=0,rt.TIMEOUT=8,rt.HTTP_ERROR=6,st.COMPLETE="complete",ct.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",Ce.prototype.listen=Ce.prototype.N,En.prototype.listenOnce=En.prototype.O,En.prototype.getLastError=En.prototype.La,En.prototype.getLastErrorCode=En.prototype.Da,En.prototype.getStatus=En.prototype.ba,En.prototype.getResponseJson=En.prototype.Qa,En.prototype.getResponseText=En.prototype.ga,En.prototype.send=En.prototype.ea;var hi=l.createWebChannelTransport=function(){return new si},ui=l.getStatEventTarget=function(){return Qe()},di=l.ErrorCode=rt,fi=l.EventType=st,pi=l.Event=Ye,gi=l.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},mi=l.FetchXmlHttpFactory=yn,yi=l.WebChannel=ct,_i=l.XhrIo=En;n(3454);const vi="@firebase/firestore";class wi{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}wi.UNAUTHENTICATED=new wi(null),wi.GOOGLE_CREDENTIALS=new wi("google-credentials-uid"),wi.FIRST_PARTY=new wi("first-party-uid"),wi.MOCK_USER=new wi("mock-user");let bi="9.6.7";const Ti=new o.Yd("@firebase/firestore");function Ii(){return Ti.logLevel}function Ei(e,...t){if(Ti.logLevel<=o.in.DEBUG){const n=t.map(Si);Ti.debug(`Firestore (${bi}): ${e}`,...n)}}function Ci(e,...t){if(Ti.logLevel<=o.in.ERROR){const n=t.map(Si);Ti.error(`Firestore (${bi}): ${e}`,...n)}}function ki(e,...t){if(Ti.logLevel<=o.in.WARN){const n=t.map(Si);Ti.warn(`Firestore (${bi}): ${e}`,...n)}}function Si(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ni(e="Unexpected state"){const t=`FIRESTORE (${bi}) INTERNAL ASSERTION FAILED: `+e;throw Ci(t),new Error(t)}function Ai(e,t){e||Ni()}function Ri(e,t){return e}const Pi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xi extends a.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Di{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Oi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Mi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(wi.UNAUTHENTICATED)))}shutdown(){}}class Li{constructor(e){this.t=e,this.currentUser=wi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Di;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Di,e.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{Ei("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Ei("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Di)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Ei("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ai("string"==typeof t.accessToken),new Oi(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ai(null===e||"string"==typeof e),new wi(e)}}class Fi{constructor(e,t,n){this.type="FirstParty",this.user=wi.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const i=e.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Ui{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Fi(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(wi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Vi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qi{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&Ei("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,Ei("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{Ei("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?i(e):Ei("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ai("string"==typeof e.token),this.p=e.token,new Vi(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ji{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function $i(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}ji.A=-1;class Gi{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=$i(40);for(let r=0;r<i.length;++r)n.length<20&&i[r]<t&&(n+=e.charAt(i[r]%e.length))}return n}}function Bi(e,t){return e<t?-1:e>t?1:0}function zi(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}class Ki{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xi(Pi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xi(Pi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new xi(Pi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xi(Pi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ki.fromMillis(Date.now())}static fromDate(e){return Ki.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ki(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Bi(this.nanoseconds,e.nanoseconds):Bi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Wi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Wi(e)}static min(){return new Wi(new Ki(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Hi(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Yi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Xi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Qi{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ni(),void 0===n?n=e.length-t:n>e.length-t&&Ni(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Qi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qi?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ji extends Qi{construct(e,t,n){return new Ji(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new xi(Pi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ji(t)}static emptyPath(){return new Ji([])}}const Zi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class er extends Qi{construct(e,t,n){return new er(e,t,n)}static isValidIdentifier(e){return Zi.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),er.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new er(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new xi(Pi.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new xi(Pi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xi(Pi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new xi(Pi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new er(t)}static emptyPath(){return new er([])}}class tr{constructor(e){this.fields=e,e.sort(er.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zi(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class nr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new nr(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new nr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Bi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nr.EMPTY_BYTE_STRING=new nr("");const ir=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rr(e){if(Ai(!!e),"string"==typeof e){let t=0;const n=ir.exec(e);if(Ai(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:sr(e.seconds),nanos:sr(e.nanos)}}function sr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function or(e){return"string"==typeof e?nr.fromBase64String(e):nr.fromUint8Array(e)}function ar(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function cr(e){const t=e.mapValue.fields.__previous_value__;return ar(t)?cr(t):t}function lr(e){const t=rr(e.mapValue.fields.__local_write_time__.timestampValue);return new Ki(t.seconds,t.nanos)}class hr{constructor(e,t,n,i,r,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class ur{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ur("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ur&&e.projectId===this.projectId&&e.database===this.database}}function dr(e){return null==e}function fr(e){return 0===e&&1/e==-1/0}function pr(e){return"number"==typeof e&&Number.isInteger(e)&&!fr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class gr{constructor(e){this.path=e}static fromPath(e){return new gr(Ji.fromString(e))}static fromName(e){return new gr(Ji.fromString(e).popFirst(5))}static empty(){return new gr(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ji.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ji.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new gr(new Ji(e.slice()))}}const mr={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function yr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ar(e)?4:10:Ni()}function _r(e,t){if(e===t)return!0;const n=yr(e);if(n!==yr(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return lr(e).isEqual(lr(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=rr(e.timestampValue),i=rr(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return or(e.bytesValue).isEqual(or(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return sr(e.geoPointValue.latitude)===sr(t.geoPointValue.latitude)&&sr(e.geoPointValue.longitude)===sr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return sr(e.integerValue)===sr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=sr(e.doubleValue),i=sr(t.doubleValue);return n===i?fr(n)===fr(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return zi(e.arrayValue.values||[],t.arrayValue.values||[],_r);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Hi(n)!==Hi(i))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!_r(n[r],i[r])))return!1;return!0}(e,t);default:return Ni()}}function vr(e,t){return void 0!==(e.values||[]).find((e=>_r(e,t)))}function wr(e,t){if(e===t)return 0;const n=yr(e),i=yr(t);if(n!==i)return Bi(n,i);switch(n){case 0:return 0;case 1:return Bi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=sr(e.integerValue||e.doubleValue),i=sr(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return br(e.timestampValue,t.timestampValue);case 4:return br(lr(e),lr(t));case 5:return Bi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=or(e),i=or(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let r=0;r<n.length&&r<i.length;r++){const e=Bi(n[r],i[r]);if(0!==e)return e}return Bi(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Bi(sr(e.latitude),sr(t.latitude));return 0!==n?n:Bi(sr(e.longitude),sr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let r=0;r<n.length&&r<i.length;++r){const e=wr(n[r],i[r]);if(e)return e}return Bi(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){const e=Bi(i[o],s[o]);if(0!==e)return e;const t=wr(n[i[o]],r[s[o]]);if(0!==t)return t}return Bi(i.length,s.length)}(e.mapValue,t.mapValue);default:throw Ni()}}function br(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Bi(e,t);const n=rr(e),i=rr(t),r=Bi(n.seconds,i.seconds);return 0!==r?r:Bi(n.nanos,i.nanos)}function Tr(e){return Ir(e)}function Ir(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=rr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?or(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,gr.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Ir(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${Ir(e.fields[r])}`;return n+"}"}(e.mapValue):Ni();var t,n}function Er(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Cr(e){return!!e&&"integerValue"in e}function kr(e){return!!e&&"arrayValue"in e}function Sr(e){return!!e&&"nullValue"in e}function Nr(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ar(e){return!!e&&"mapValue"in e}function Rr(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Yi(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Rr(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Rr(e.arrayValue.values[n]);return t}return Object.assign({},e)}class Pr{constructor(e){this.value=e}static empty(){return new Pr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ar(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rr(t)}setAll(e){let t=er.emptyPath(),n={},i=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=Rr(e):i.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());Ar(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _r(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ar(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Yi(t,((t,n)=>e[t]=n));for(const i of n)delete e[i]}clone(){return new Pr(Rr(this.value))}}function xr(e){const t=[];return Yi(e.fields,((e,n)=>{const i=new er([e]);if(Ar(n)){const e=xr(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new tr(t)}class Dr{constructor(e,t,n,i,r,s){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.data=r,this.documentState=s}static newInvalidDocument(e){return new Dr(e,0,Wi.min(),Wi.min(),Pr.empty(),0)}static newFoundDocument(e,t,n){return new Dr(e,1,t,Wi.min(),n,0)}static newNoDocument(e,t){return new Dr(e,2,t,Wi.min(),Pr.empty(),0)}static newUnknownDocument(e,t){return new Dr(e,3,t,Wi.min(),Pr.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Dr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dr(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Or{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}Or.UNKNOWN_ID=-1;class Mr{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.P=null}}function Lr(e,t=null,n=[],i=[],r=null,s=null,o=null){return new Mr(e,t,n,i,r,s,o)}function Fr(e){const t=Ri(e);if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+Tr(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),dr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Tr(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Tr(e))).join(",")),t.P=e}return t.P}function Ur(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!Qr(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(n=e.filters[r],i=t.filters[r],n.op!==i.op||!n.field.isEqual(i.field)||!_r(n.value,i.value))return!1;var n,i;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Zr(e.startAt,t.startAt)&&Zr(e.endAt,t.endAt)}function Vr(e){return gr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class qr extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.v(e,t,n):new jr(e,t,n):"array-contains"===t?new zr(e,n):"in"===t?new Kr(e,n):"not-in"===t?new Wr(e,n):"array-contains-any"===t?new Hr(e,n):new qr(e,t,n)}static v(e,t,n){return"in"===t?new $r(e,n):new Gr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.V(wr(t,this.value)):null!==t&&yr(this.value)===yr(t)&&this.V(wr(t,this.value))}V(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ni()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class jr extends qr{constructor(e,t,n){super(e,t,n),this.key=gr.fromName(n.referenceValue)}matches(e){const t=gr.comparator(e.key,this.key);return this.V(t)}}class $r extends qr{constructor(e,t){super(e,"in",t),this.keys=Br("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Gr extends qr{constructor(e,t){super(e,"not-in",t),this.keys=Br("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Br(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>gr.fromName(e.referenceValue)))}class zr extends qr{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return kr(t)&&vr(t.arrayValue,this.value)}}class Kr extends qr{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&vr(this.value.arrayValue,t)}}class Wr extends qr{constructor(e,t){super(e,"not-in",t)}matches(e){if(vr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!vr(this.value.arrayValue,t)}}class Hr extends qr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!kr(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>vr(this.value.arrayValue,e)))}}class Yr{constructor(e,t){this.position=e,this.inclusive=t}}class Xr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Qr(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Jr(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?gr.comparator(gr.fromName(o.referenceValue),n.key):wr(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Zr(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!_r(e.position[n],t.position[n]))return!1;return!0}class es{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function ts(e,t,n,i,r,s,o,a){return new es(e,t,n,i,r,s,o,a)}function ns(e){return new es(e)}function is(e){return!dr(e.limit)&&"F"===e.limitType}function rs(e){return!dr(e.limit)&&"L"===e.limitType}function ss(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function os(e){for(const t of e.filters)if(t.S())return t.field;return null}function as(e){return null!==e.collectionGroup}function cs(e){const t=Ri(e);if(null===t.D){t.D=[];const e=os(t),n=ss(t);if(null!==e&&null===n)e.isKeyField()||t.D.push(new Xr(e)),t.D.push(new Xr(er.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.D.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.D.push(new Xr(er.keyField(),e))}}}return t.D}function ls(e){const t=Ri(e);if(!t.C)if("F"===t.limitType)t.C=Lr(t.path,t.collectionGroup,cs(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const r of cs(t)){const t="desc"===r.dir?"asc":"desc";e.push(new Xr(r.field,t))}const n=t.endAt?new Yr(t.endAt.position,!t.endAt.inclusive):null,i=t.startAt?new Yr(t.startAt.position,!t.startAt.inclusive):null;t.C=Lr(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t.C}function hs(e,t,n){return new es(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function us(e,t){return Ur(ls(e),ls(t))&&e.limitType===t.limitType}function ds(e){return`${Fr(ls(e))}|lt:${e.limitType}`}function fs(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Tr(t.value)}`;var t})).join(", ")}]`),dr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Tr(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Tr(e))).join(",")),`Target(${t})`}(ls(e))}; limitType=${e.limitType})`}function ps(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):gr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Jr(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,cs(e),t))&&!(e.endAt&&!function(e,t,n){const i=Jr(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,cs(e),t))}(e,t)}function gs(e){return(t,n)=>{let i=!1;for(const r of cs(e)){const e=ms(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function ms(e,t,n){const i=e.field.isKeyField()?gr.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?wr(i,r):Ni()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return Ni()}}function ys(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fr(t)?"-0":t}}function _s(e){return{integerValue:""+e}}function vs(e,t){return pr(t)?_s(t):ys(e,t)}class ws{constructor(){this._=void 0}}function bs(e,t,n){return e instanceof Es?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Cs?ks(e,t):e instanceof Ss?Ns(e,t):function(e,t){const n=Is(e,t),i=Rs(n)+Rs(e.k);return Cr(n)&&Cr(e.k)?_s(i):ys(e.O,i)}(e,t)}function Ts(e,t,n){return e instanceof Cs?ks(e,t):e instanceof Ss?Ns(e,t):n}function Is(e,t){return e instanceof As?Cr(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Es extends ws{}class Cs extends ws{constructor(e){super(),this.elements=e}}function ks(e,t){const n=Ps(t);for(const i of e.elements)n.some((e=>_r(e,i)))||n.push(i);return{arrayValue:{values:n}}}class Ss extends ws{constructor(e){super(),this.elements=e}}function Ns(e,t){let n=Ps(t);for(const i of e.elements)n=n.filter((e=>!_r(e,i)));return{arrayValue:{values:n}}}class As extends ws{constructor(e,t){super(),this.O=e,this.k=t}}function Rs(e){return sr(e.integerValue||e.doubleValue)}function Ps(e){return kr(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class xs{constructor(e,t){this.field=e,this.transform=t}}class Ds{constructor(e,t){this.version=e,this.transformResults=t}}class Os{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Os}static exists(e){return new Os(void 0,e)}static updateTime(e){return new Os(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ms(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ls{}function Fs(e,t,n){e instanceof $s?function(e,t,n){const i=e.value.clone(),r=zs(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Gs?function(e,t,n){if(!Ms(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=zs(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Bs(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Us(e,t,n){e instanceof $s?function(e,t,n){if(!Ms(e.precondition,t))return;const i=e.value.clone(),r=Ks(e.fieldTransforms,n,t);i.setAll(r),t.convertToFoundDocument(js(t),i).setHasLocalMutations()}(e,t,n):e instanceof Gs?function(e,t,n){if(!Ms(e.precondition,t))return;const i=Ks(e.fieldTransforms,n,t),r=t.data;r.setAll(Bs(e)),r.setAll(i),t.convertToFoundDocument(js(t),r).setHasLocalMutations()}(e,t,n):function(e,t){Ms(e.precondition,t)&&t.convertToNoDocument(Wi.min())}(e,t)}function Vs(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=Is(i.transform,e||null);null!=r&&(null==n&&(n=Pr.empty()),n.set(i.field,r))}return n||null}function qs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&zi(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Cs&&t instanceof Cs||e instanceof Ss&&t instanceof Ss?zi(e.elements,t.elements,_r):e instanceof As&&t instanceof As?_r(e.k,t.k):e instanceof Es&&t instanceof Es}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function js(e){return e.isFoundDocument()?e.version:Wi.min()}class $s extends Ls{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}}class Gs extends Ls{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}}function Bs(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function zs(e,t,n){const i=new Map;Ai(e.length===n.length);for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,Ts(o,a,n[r]))}return i}function Ks(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,bs(e,s,t))}return i}class Ws extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Hs extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Ys{constructor(e){this.count=e}}var Xs,Qs;function Js(e){switch(e){default:return Ni();case Pi.CANCELLED:case Pi.UNKNOWN:case Pi.DEADLINE_EXCEEDED:case Pi.RESOURCE_EXHAUSTED:case Pi.INTERNAL:case Pi.UNAVAILABLE:case Pi.UNAUTHENTICATED:return!1;case Pi.INVALID_ARGUMENT:case Pi.NOT_FOUND:case Pi.ALREADY_EXISTS:case Pi.PERMISSION_DENIED:case Pi.FAILED_PRECONDITION:case Pi.ABORTED:case Pi.OUT_OF_RANGE:case Pi.UNIMPLEMENTED:case Pi.DATA_LOSS:return!0}}function Zs(e){if(void 0===e)return Ci("GRPC error has no .code"),Pi.UNKNOWN;switch(e){case Xs.OK:return Pi.OK;case Xs.CANCELLED:return Pi.CANCELLED;case Xs.UNKNOWN:return Pi.UNKNOWN;case Xs.DEADLINE_EXCEEDED:return Pi.DEADLINE_EXCEEDED;case Xs.RESOURCE_EXHAUSTED:return Pi.RESOURCE_EXHAUSTED;case Xs.INTERNAL:return Pi.INTERNAL;case Xs.UNAVAILABLE:return Pi.UNAVAILABLE;case Xs.UNAUTHENTICATED:return Pi.UNAUTHENTICATED;case Xs.INVALID_ARGUMENT:return Pi.INVALID_ARGUMENT;case Xs.NOT_FOUND:return Pi.NOT_FOUND;case Xs.ALREADY_EXISTS:return Pi.ALREADY_EXISTS;case Xs.PERMISSION_DENIED:return Pi.PERMISSION_DENIED;case Xs.FAILED_PRECONDITION:return Pi.FAILED_PRECONDITION;case Xs.ABORTED:return Pi.ABORTED;case Xs.OUT_OF_RANGE:return Pi.OUT_OF_RANGE;case Xs.UNIMPLEMENTED:return Pi.UNIMPLEMENTED;case Xs.DATA_LOSS:return Pi.DATA_LOSS;default:return Ni()}}(Qs=Xs||(Xs={}))[Qs.OK=0]="OK",Qs[Qs.CANCELLED=1]="CANCELLED",Qs[Qs.UNKNOWN=2]="UNKNOWN",Qs[Qs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qs[Qs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qs[Qs.NOT_FOUND=5]="NOT_FOUND",Qs[Qs.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qs[Qs.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qs[Qs.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qs[Qs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qs[Qs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qs[Qs.ABORTED=10]="ABORTED",Qs[Qs.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qs[Qs.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qs[Qs.INTERNAL=13]="INTERNAL",Qs[Qs.UNAVAILABLE=14]="UNAVAILABLE",Qs[Qs.DATA_LOSS=15]="DATA_LOSS";class eo{constructor(e,t){this.comparator=e,this.root=t||no.EMPTY}insert(e,t){return new eo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,no.BLACK,null,null))}remove(e){return new eo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,no.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new to(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new to(this.root,e,this.comparator,!1)}getReverseIterator(){return new to(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new to(this.root,e,this.comparator,!0)}}class to{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class no{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:no.RED,this.left=null!=i?i:no.EMPTY,this.right=null!=r?r:no.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new no(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return no.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return no.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,no.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,no.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ni();if(this.right.isRed())throw Ni();const e=this.left.check();if(e!==this.right.check())throw Ni();return e+(this.isRed()?0:1)}}no.EMPTY=null,no.RED=!0,no.BLACK=!1,no.EMPTY=new class{constructor(){this.size=0}get key(){throw Ni()}get value(){throw Ni()}get color(){throw Ni()}get left(){throw Ni()}get right(){throw Ni()}copy(e,t,n,i,r){return this}insert(e,t,n){return new no(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class io{constructor(e){this.comparator=e,this.data=new eo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ro(this.data.getIterator())}getIteratorFrom(e){return new ro(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof io))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new io(this.comparator);return t.data=e,t}}class ro{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const so=new eo(gr.comparator);function oo(){return so}const ao=new eo(gr.comparator);function co(){return ao}const lo=new eo(gr.comparator),ho=new io(gr.comparator);function uo(...e){let t=ho;for(const n of e)t=t.add(n);return t}const fo=new io(Bi);function po(){return fo}class go{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,mo.createSynthesizedTargetChangeForCurrentChange(e,t)),new go(Wi.min(),n,po(),oo(),uo())}}class mo{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t){return new mo(nr.EMPTY_BYTE_STRING,t,uo(),uo(),uo())}}class yo{constructor(e,t,n,i){this.M=e,this.removedTargetIds=t,this.key=n,this.$=i}}class _o{constructor(e,t){this.targetId=e,this.F=t}}class vo{constructor(e,t,n=nr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class wo{constructor(){this.B=0,this.L=Io(),this.U=nr.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=uo(),t=uo(),n=uo();return this.L.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:Ni()}})),new mo(this.U,this.q,e,t,n)}J(){this.K=!1,this.L=Io()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class bo{constructor(e){this.nt=e,this.st=new Map,this.it=oo(),this.rt=To(),this.ot=new io(Bi)}ct(e){for(const t of e.M)e.$&&e.$.isFoundDocument()?this.ut(t,e.$):this.at(t,e.key,e.$);for(const t of e.removedTargetIds)this.at(t,e.key,e.$)}ht(e){this.forEachTarget(e,(t=>{const n=this.lt(t);switch(e.state){case 0:this.ft(t)&&n.W(e.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(e.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(t);break;case 3:this.ft(t)&&(n.et(),n.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),n.W(e.resumeToken));break;default:Ni()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach(((e,n)=>{this.ft(n)&&t(n)}))}_t(e){const t=e.targetId,n=e.F.count,i=this.wt(t);if(i){const e=i.target;if(Vr(e))if(0===n){const n=new gr(e.path);this.at(t,n,Dr.newNoDocument(n,Wi.min()))}else Ai(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach(((n,i)=>{const r=this.wt(i);if(r){if(n.current&&Vr(r.target)){const t=new gr(r.target.path);null!==this.it.get(t)||this.It(i,t)||this.at(i,t,Dr.newNoDocument(t,e))}n.j&&(t.set(i,n.H()),n.J())}}));let n=uo();this.rt.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.it.forEach(((t,n)=>n.setReadTime(e)));const i=new go(e,t,this.ot,this.it,n);return this.it=oo(),this.rt=To(),this.ot=new io(Bi),i}ut(e,t){if(!this.ft(e))return;const n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e))}at(e,t,n){if(!this.ft(e))return;const i=this.lt(e);this.It(e,t)?i.Y(t,1):i.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),n&&(this.it=this.it.insert(t,n))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new wo,this.st.set(e,t)),t}Et(e){let t=this.rt.get(e);return t||(t=new io(Bi),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||Ei("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}dt(e){this.st.set(e,new wo),this.nt.getRemoteKeysForTarget(e).forEach((t=>{this.at(e,t,null)}))}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function To(){return new eo(gr.comparator)}function Io(){return new eo(gr.comparator)}const Eo={asc:"ASCENDING",desc:"DESCENDING"},Co={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ko{constructor(e,t){this.databaseId=e,this.N=t}}function So(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function No(e,t){return e.N?t.toBase64():t.toUint8Array()}function Ao(e,t){return So(e,t.toTimestamp())}function Ro(e){return Ai(!!e),Wi.fromTimestamp(function(e){const t=rr(e);return new Ki(t.seconds,t.nanos)}(e))}function Po(e,t){return function(e){return new Ji(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function xo(e){const t=Ji.fromString(e);return Ai(Jo(t)),t}function Do(e,t){return Po(e.databaseId,t.path)}function Oo(e,t){const n=xo(t);if(n.get(1)!==e.databaseId.projectId)throw new xi(Pi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new xi(Pi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new gr(Uo(n))}function Mo(e,t){return Po(e.databaseId,t)}function Lo(e){const t=xo(e);return 4===t.length?Ji.emptyPath():Uo(t)}function Fo(e){return new Ji(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Uo(e){return Ai(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Vo(e,t,n){return{name:Do(e,t),fields:n.value.mapValue.fields}}function qo(e,t){let n;if(t instanceof $s)n={update:Vo(e,t.key,t.value)};else if(t instanceof Ws)n={delete:Do(e,t.key)};else if(t instanceof Gs)n={update:Vo(e,t.key,t.data),updateMask:Qo(t.fieldMask)};else{if(!(t instanceof Hs))return Ni();n={verify:Do(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Es)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Cs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ss)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof As)return{fieldPath:t.field.canonicalString(),increment:n.k};throw Ni()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ao(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ni()}(e,t.precondition)),n}function jo(e,t){return{documents:[Mo(e,t.path)]}}function $o(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=Mo(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Mo(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(Nr(e.value))return{unaryFilter:{field:Wo(e.field),op:"IS_NAN"}};if(Sr(e.value))return{unaryFilter:{field:Wo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Nr(e.value))return{unaryFilter:{field:Wo(e.field),op:"IS_NOT_NAN"}};if(Sr(e.value))return{unaryFilter:{field:Wo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wo(e.field),op:Ko(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);r&&(n.structuredQuery.where=r);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Wo(e.field),direction:zo(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.N||dr(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Go(e){let t=Lo(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Ai(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=Bo(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Xr(Ho(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,dr(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Yr(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new Yr(n,t)}(n.endAt)),ts(t,r,o,s,a,"F",c,l)}function Bo(e){return e?void 0!==e.unaryFilter?[Xo(e)]:void 0!==e.fieldFilter?[Yo(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>Bo(e))).reduce(((e,t)=>e.concat(t))):Ni():[]}function zo(e){return Eo[e]}function Ko(e){return Co[e]}function Wo(e){return{fieldPath:e.canonicalString()}}function Ho(e){return er.fromServerFormat(e.fieldPath)}function Yo(e){return qr.create(Ho(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ni()}}(e.fieldFilter.op),e.fieldFilter.value)}function Xo(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ho(e.unaryFilter.field);return qr.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ho(e.unaryFilter.field);return qr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ho(e.unaryFilter.field);return qr.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ho(e.unaryFilter.field);return qr.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Ni()}}function Qo(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Jo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Zo(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ta(t)),t=ea(e.get(n),t);return ta(t)}function ea(e,t){let n=t;const i=e.length;for(let r=0;r<i;r++){const t=e.charAt(r);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function ta(e){return e+"\x01\x01"}class na{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}na.store="owner",na.key="owner";class ia{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}ia.store="mutationQueues",ia.keyPath="userId";class ra{constructor(e,t,n,i,r){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=i,this.mutations=r}}ra.store="mutations",ra.keyPath="batchId",ra.userMutationsIndex="userMutationsIndex",ra.userMutationsKeyPath=["userId","batchId"];class sa{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Zo(t)]}static key(e,t,n){return[e,Zo(t),n]}}sa.store="documentMutations",sa.PLACEHOLDER=new sa;class oa{constructor(e,t,n,i,r,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=i,this.readTime=r,this.parentPath=s}}oa.store="remoteDocuments",oa.readTimeIndex="readTimeIndex",oa.readTimeIndexPath="readTime",oa.collectionReadTimeIndex="collectionReadTimeIndex",oa.collectionReadTimeIndexPath=["parentPath","readTime"];class aa{constructor(e){this.byteSize=e}}aa.store="remoteDocumentGlobal",aa.key="remoteDocumentGlobalKey";class ca{constructor(e,t,n,i,r,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=i,this.lastListenSequenceNumber=r,this.lastLimboFreeSnapshotVersion=s,this.query=o}}ca.store="targets",ca.keyPath="targetId",ca.queryTargetsIndexName="queryTargetsIndex",ca.queryTargetsKeyPath=["canonicalId","targetId"];class la{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}la.store="targetDocuments",la.keyPath=["targetId","path"],la.documentTargetsIndex="documentTargetsIndex",la.documentTargetsKeyPath=["path","targetId"];class ha{constructor(e,t,n,i){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=i}}ha.key="targetGlobalKey",ha.store="targetGlobal";class ua{constructor(e,t){this.collectionId=e,this.parent=t}}ua.store="collectionParents",ua.keyPath=["collectionId","parent"];class da{constructor(e,t,n,i){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=i}}da.store="clientMetadata",da.keyPath="clientId";class fa{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}fa.store="bundles",fa.keyPath="bundleId";class pa{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}pa.store="namedQueries",pa.keyPath="name";class ga{constructor(e,t,n){this.indexId=e,this.collectionGroup=t,this.fields=n}}ga.store="indexConfiguration",ga.keyPath="indexId",ga.collectionGroupIndex="collectionGroupIndex",ga.collectionGroupIndexPath="collectionGroup";class ma{constructor(e,t,n,i,r,s){this.indexId=e,this.uid=t,this.sequenceNumber=n,this.readTime=i,this.documentKey=r,this.largestBatchId=s}}ma.store="indexState",ma.keyPath=["indexId","uid"],ma.sequenceNumberIndex="sequenceNumberIndex",ma.sequenceNumberIndexPath=["uid","sequenceNumber"];class ya{constructor(e,t,n,i,r){this.indexId=e,this.uid=t,this.arrayValue=n,this.directionalValue=i,this.documentKey=r}}ya.store="indexEntries",ya.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],ya.documentKeyIndex="documentKeyIndex",ya.documentKeyIndexPath=["indexId","uid","documentKey"];class _a{constructor(e,t,n,i,r,s){this.userId=e,this.collectionPath=t,this.documentId=n,this.collectionGroup=i,this.largestBatchId=r,this.overlayMutation=s}}_a.store="documentOverlays",_a.keyPath=["userId","collectionPath","documentId"],_a.collectionPathOverlayIndex="collectionPathOverlayIndex",_a.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],_a.collectionGroupOverlayIndex="collectionGroupOverlayIndex",_a.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const va=[ia.store,ra.store,sa.store,oa.store,ca.store,na.store,ha.store,la.store,da.store,aa.store,ua.store,fa.store,pa.store],wa=[...va,_a.store],ba=(ga.store,ma.store,ya.store,"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.");class Ta{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class Ia{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ni(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ia(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ia?t:Ia.resolve(t)}catch(e){return Ia.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ia.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ia.reject(t)}static resolve(e){return new Ia(((t,n)=>{t(e)}))}static reject(e){return new Ia(((t,n)=>{n(e)}))}static waitFor(e){return new Ia(((t,n)=>{let i=0,r=0,s=!1;e.forEach((e=>{++i,e.next((()=>{++r,s&&r===i&&t()}),(e=>n(e)))})),s=!0,r===i&&t()}))}static or(e){let t=Ia.resolve(!1);for(const n of e)t=t.next((e=>e?Ia.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}}function Ea(e){return"IndexedDbTransactionError"===e.name}class Ca{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&Fs(t,e,n[i])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Us(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Us(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),i=n;this.applyToLocalView(i),n.isValidDocument()||i.convertToNoDocument(Wi.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),uo())}isEqual(e){return this.batchId===e.batchId&&zi(this.mutations,e.mutations,((e,t)=>qs(e,t)))&&zi(this.baseMutations,e.baseMutations,((e,t)=>qs(e,t)))}}class ka{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){Ai(e.mutations.length===n.length);let i=lo;const r=e.mutations;for(let s=0;s<r.length;s++)i=i.insert(r[s].key,n[s].version);return new ka(e,t,n,i)}}class Sa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Na{constructor(e,t,n,i,r=Wi.min(),s=Wi.min(),o=nr.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Na(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Na(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Na(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Aa{constructor(e){this.Ht=e}}function Ra(e){const t=Go({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?hs(t,t.limit,"L"):t}class Pa{constructor(){}Xt(e,t){this.Zt(e,t),t.te()}Zt(e,t){if("nullValue"in e)this.ee(t,5);else if("booleanValue"in e)this.ee(t,10),t.ne(e.booleanValue?1:0);else if("integerValue"in e)this.ee(t,15),t.ne(sr(e.integerValue));else if("doubleValue"in e){const n=sr(e.doubleValue);isNaN(n)?this.ee(t,13):(this.ee(t,15),fr(n)?t.ne(0):t.ne(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ee(t,20),"string"==typeof n?t.se(n):(t.se(`${n.seconds||""}`),t.ne(n.nanos||0))}else if("stringValue"in e)this.ie(e.stringValue,t),this.re(t);else if("bytesValue"in e)this.ee(t,30),t.oe(or(e.bytesValue)),this.re(t);else if("referenceValue"in e)this.ce(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ee(t,45),t.ne(n.latitude||0),t.ne(n.longitude||0)}else"mapValue"in e?_r(e,mr)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):Ni()}ie(e,t){this.ee(t,25),this.he(e,t)}he(e,t){t.se(e)}ue(e,t){const n=e.fields||{};this.ee(t,55);for(const i of Object.keys(n))this.ie(i,t),this.Zt(n[i],t)}ae(e,t){const n=e.values||[];this.ee(t,50);for(const i of n)this.Zt(i,t)}ce(e,t){this.ee(t,37),gr.fromName(e).path.forEach((e=>{this.ee(t,60),this.he(e,t)}))}ee(e,t){e.ne(t)}re(e){e.ne(2)}}Pa.le=new Pa;class xa{constructor(){this.xe=new Da}addToCollectionParentIndex(e,t){return this.xe.add(t),Ia.resolve()}getCollectionParents(e,t){return Ia.resolve(this.xe.getEntries(t))}addFieldIndex(e,t){return Ia.resolve()}deleteFieldIndex(e,t){return Ia.resolve()}getDocumentsMatchingTarget(e,t,n){return Ia.resolve(uo())}getFieldIndex(e,t){return Ia.resolve(null)}getFieldIndexes(e,t){return Ia.resolve([])}getNextCollectionGroupToUpdate(e){return Ia.resolve(null)}updateCollectionGroup(e,t,n){return Ia.resolve()}updateIndexEntries(e,t){return Ia.resolve()}}class Da{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new io(Ji.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new io(Ji.comparator)).toArray()}}class Oa{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Oa(e,Oa.DEFAULT_COLLECTION_PERCENTILE,Oa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Oa.DEFAULT_COLLECTION_PERCENTILE=10,Oa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oa.DEFAULT=new Oa(41943040,Oa.DEFAULT_COLLECTION_PERCENTILE,Oa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oa.DISABLED=new Oa(-1,0,0);class Ma{constructor(e){this.ze=e}next(){return this.ze+=2,this.ze}static He(){return new Ma(0)}static Je(){return new Ma(-1)}}async function La(e){if(e.code!==Pi.FAILED_PRECONDITION||e.message!==ba)throw e;Ei("LocalStore","Unexpectedly lost primary lease")}class Fa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,r]of n)if(this.equalsFn(i,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0!==i){for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),!0;return!1}forEach(e){Yi(this.inner,((t,n)=>{for(const[i,r]of n)e(i,r)}))}isEmpty(){return Xi(this.inner)}}class Ua{constructor(){this.changes=new Fa((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Dr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ia.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Va{constructor(e,t,n){this.qn=e,this.gs=t,this.indexManager=n}ys(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.ps(e,t,n)))}ps(e,t,n){return this.qn.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}Is(e,t){e.forEach(((e,n)=>{for(const i of t)i.applyToLocalView(n)}))}Es(e,t){return this.qn.getEntries(e,t).next((t=>this.Ts(e,t).next((()=>t))))}Ts(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.Is(t,e)))}As(e,t,n){return function(e){return gr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Rs(e,t.path):as(t)?this.Ps(e,t,n):this.bs(e,t,n)}Rs(e,t){return this.ys(e,new gr(t)).next((e=>{let t=co();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Ps(e,t,n){const i=t.collectionGroup;let r=co();return this.indexManager.getCollectionParents(e,i).next((s=>Ia.forEach(s,(s=>{const o=function(e,t){return new es(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.bs(e,o,n).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}bs(e,t,n){let i;return this.qn.getAll(e,t.path,n).next((n=>(i=n,this.gs.getAllMutationBatchesAffectingQuery(e,t)))).next((e=>{for(const t of e)for(const e of t.mutations){const n=e.key;let r=i.get(n);null==r&&(r=Dr.newInvalidDocument(n),i=i.insert(n,r)),Us(e,r,t.localWriteTime),r.isFoundDocument()||(i=i.remove(n))}})).next((()=>(i.forEach(((e,n)=>{ps(t,n)||(i=i.remove(e))})),i)))}}class qa{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.vs=n,this.Vs=i}static Ss(e,t){let n=uo(),i=uo();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new qa(e,t.fromCache,n,i)}}class ja{Ds(e){this.Cs=e}As(e,t,n,i){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Wi.min())?this.Ns(e,t):this.Cs.Es(e,i).next((r=>{const s=this.xs(t,r);return(is(t)||rs(t))&&this.ks(t.limitType,s,i,n)?this.Ns(e,t):(Ii()<=o.in.DEBUG&&Ei("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),fs(t)),this.Cs.As(e,t,n).next((e=>(s.forEach((t=>{e=e.insert(t.key,t)})),e))))}))}xs(e,t){let n=new io(gs(e));return t.forEach(((t,i)=>{ps(e,i)&&(n=n.add(i))})),n}ks(e,t,n,i){if(n.size!==t.size)return!0;const r="F"===e?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ns(e,t){return Ii()<=o.in.DEBUG&&Ei("QueryEngine","Using full collection scan to execute query:",fs(t)),this.Cs.As(e,t,Wi.min())}}class $a{constructor(e,t,n,i){this.persistence=e,this.Os=t,this.O=i,this.Ms=new eo(Bi),this.$s=new Fa((e=>Fr(e)),Ur),this.Fs=Wi.min(),this.Bs=e.getRemoteDocumentCache(),this.Un=e.getTargetCache(),this.Kn=e.getBundleCache(),this.Ls(n)}Ls(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new Va(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function Ga(e,t,n,i){return new $a(e,t,n,i)}async function Ba(e,t){const n=Ri(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.gs.getAllMutationBatches(e).next((r=>(i=r,n.Ls(t),n.gs.getAllMutationBatches(e)))).next((t=>{const r=[],s=[];let o=uo();for(const e of i){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.Us.Es(e,o).next((e=>({qs:e,removedBatchIds:r,addedBatchIds:s})))}))}))}function za(e){const t=Ri(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Un.getLastRemoteSnapshotVersion(e)))}function Ka(e,t,n){let i=uo();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=oo();return n.forEach(((n,r)=>{const s=e.get(n);r.isNoDocument()&&r.version.isEqual(Wi.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!s.isValidDocument()||r.version.compareTo(s.version)>0||0===r.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):Ei("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",r.version)})),i}))}function Wa(e,t){const n=Ri(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.gs.getNextMutationBatchAfterBatchId(e,t))))}function Ha(e,t){const n=Ri(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.Un.getTargetData(e,t).next((r=>r?(i=r,Ia.resolve(i)):n.Un.allocateTargetId(e).next((r=>(i=new Na(t,r,0,e.currentSequenceNumber),n.Un.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.Ms.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.$s.set(t,e.targetId)),e}))}async function Ya(e,t,n){const i=Ri(e),r=i.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!Ea(e))throw e;Ei("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.Ms=i.Ms.remove(t),i.$s.delete(r.target)}function Xa(e,t,n){const i=Ri(e);let r=Wi.min(),s=uo();return i.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const i=Ri(e),r=i.$s.get(n);return void 0!==r?Ia.resolve(i.Ms.get(r)):i.Un.getTargetData(t,n)}(i,e,ls(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Un.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>i.Os.As(e,t,n?r:Wi.min(),n?s:uo()))).next((e=>({documents:e,Ks:s})))))}class Qa{constructor(e){this.O=e,this.Ws=new Map,this.zs=new Map}getBundleMetadata(e,t){return Ia.resolve(this.Ws.get(t))}saveBundleMetadata(e,t){var n;return this.Ws.set(t.id,{id:(n=t).id,version:n.version,createTime:Ro(n.createTime)}),Ia.resolve()}getNamedQuery(e,t){return Ia.resolve(this.zs.get(t))}saveNamedQuery(e,t){return this.zs.set(t.name,function(e){return{name:e.name,query:Ra(e.bundledQuery),readTime:Ro(e.readTime)}}(t)),Ia.resolve()}}class Ja{constructor(){this.overlays=new eo(gr.comparator),this.Hs=new Map}getOverlay(e,t){return Ia.resolve(this.overlays.get(t))}saveOverlays(e,t,n){return n.forEach((n=>{this.Yt(e,t,n)})),Ia.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Hs.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.Hs.delete(n)),Ia.resolve()}getOverlaysForCollection(e,t,n){const i=new Map,r=t.length+1,s=new gr(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Ia.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new eo(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=new Map,r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=new Map,a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(t,e))),!(o.size>=i)););return Ia.resolve(o)}Yt(e,t,n){if(null===n)return;const i=this.overlays.get(n.key);null!==i&&this.Hs.get(i.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new Sa(t,n));let r=this.Hs.get(t);void 0===r&&(r=new Set,this.Hs.set(t,r)),r.add(n.key)}}class Za{constructor(){this.Js=new io(ec.Ys),this.Xs=new io(ec.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(e,t){const n=new ec(e,t);this.Js=this.Js.add(n),this.Xs=this.Xs.add(n)}ti(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ei(new ec(e,t))}ni(e,t){e.forEach((e=>this.removeReference(e,t)))}si(e){const t=new gr(new Ji([])),n=new ec(t,e),i=new ec(t,e+1),r=[];return this.Xs.forEachInRange([n,i],(e=>{this.ei(e),r.push(e.key)})),r}ii(){this.Js.forEach((e=>this.ei(e)))}ei(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}ri(e){const t=new gr(new Ji([])),n=new ec(t,e),i=new ec(t,e+1);let r=uo();return this.Xs.forEachInRange([n,i],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new ec(e,0),n=this.Js.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ec{constructor(e,t){this.key=e,this.oi=t}static Ys(e,t){return gr.comparator(e.key,t.key)||Bi(e.oi,t.oi)}static Zs(e,t){return Bi(e.oi,t.oi)||gr.comparator(e.key,t.key)}}class tc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.gs=[],this.ci=1,this.ui=new io(ec.Ys)}checkEmpty(e){return Ia.resolve(0===this.gs.length)}addMutationBatch(e,t,n,i){const r=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];const s=new Ca(r,t,n,i);this.gs.push(s);for(const o of i)this.ui=this.ui.add(new ec(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Ia.resolve(s)}lookupMutationBatch(e,t){return Ia.resolve(this.ai(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.hi(n),r=i<0?0:i;return Ia.resolve(this.gs.length>r?this.gs[r]:null)}getHighestUnacknowledgedBatchId(){return Ia.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(e){return Ia.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ec(t,0),i=new ec(t,Number.POSITIVE_INFINITY),r=[];return this.ui.forEachInRange([n,i],(e=>{const t=this.ai(e.oi);r.push(t)})),Ia.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new io(Bi);return t.forEach((e=>{const t=new ec(e,0),i=new ec(e,Number.POSITIVE_INFINITY);this.ui.forEachInRange([t,i],(e=>{n=n.add(e.oi)}))})),Ia.resolve(this.li(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;gr.isDocumentKey(r)||(r=r.child(""));const s=new ec(new gr(r),0);let o=new io(Bi);return this.ui.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.oi)),!0)}),s),Ia.resolve(this.li(o))}li(e){const t=[];return e.forEach((e=>{const n=this.ai(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ai(0===this.fi(t.batchId,"removed")),this.gs.shift();let n=this.ui;return Ia.forEach(t.mutations,(i=>{const r=new ec(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.ui=n}))}Qe(e){}containsKey(e,t){const n=new ec(t,0),i=this.ui.firstAfterOrEqual(n);return Ia.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.gs.length,Ia.resolve()}fi(e,t){return this.hi(e)}hi(e){return 0===this.gs.length?0:e-this.gs[0].batchId}ai(e){const t=this.hi(e);return t<0||t>=this.gs.length?null:this.gs[t]}}class nc{constructor(e){this.di=e,this.docs=new eo(gr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.di(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ia.resolve(n?n.document.mutableCopy():Dr.newInvalidDocument(t))}getEntries(e,t){let n=oo();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Dr.newInvalidDocument(e))})),Ia.resolve(n)}getAll(e,t,n){let i=oo();const r=new gr(t.child("")),s=this.docs.getIteratorFrom(r);for(;s.hasNext();){const{key:e,value:{document:r}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||r.readTime.compareTo(n)<=0||(i=i.insert(r.key,r.mutableCopy()))}return Ia.resolve(i)}_i(e,t){return Ia.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new ic(this)}getSize(e){return Ia.resolve(this.size)}}class ic extends Ua{constructor(e){super(),this.Tn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Tn.addEntry(e,i)):this.Tn.removeEntry(n)})),Ia.waitFor(t)}getFromCache(e,t){return this.Tn.getEntry(e,t)}getAllFromCache(e,t){return this.Tn.getEntries(e,t)}}class rc{constructor(e){this.persistence=e,this.wi=new Fa((e=>Fr(e)),Ur),this.lastRemoteSnapshotVersion=Wi.min(),this.highestTargetId=0,this.mi=0,this.gi=new Za,this.targetCount=0,this.yi=Ma.He()}forEachTarget(e,t){return this.wi.forEach(((e,n)=>t(n))),Ia.resolve()}getLastRemoteSnapshotVersion(e){return Ia.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ia.resolve(this.mi)}allocateTargetId(e){return this.highestTargetId=this.yi.next(),Ia.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.mi&&(this.mi=t),Ia.resolve()}Ze(e){this.wi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.yi=new Ma(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}addTargetData(e,t){return this.Ze(t),this.targetCount+=1,Ia.resolve()}updateTargetData(e,t){return this.Ze(t),Ia.resolve()}removeTargetData(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),this.targetCount-=1,Ia.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.wi.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.wi.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Ia.waitFor(r).next((()=>i))}getTargetCount(e){return Ia.resolve(this.targetCount)}getTargetData(e,t){const n=this.wi.get(t)||null;return Ia.resolve(n)}addMatchingKeys(e,t,n){return this.gi.ti(t,n),Ia.resolve()}removeMatchingKeys(e,t,n){this.gi.ni(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((t=>{r.push(i.markPotentiallyOrphaned(e,t))})),Ia.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.gi.si(t),Ia.resolve()}getMatchingKeysForTargetId(e,t){const n=this.gi.ri(t);return Ia.resolve(n)}containsKey(e,t){return Ia.resolve(this.gi.containsKey(t))}}class sc{constructor(e,t){this.pi={},this.overlays={},this.Nn=new ji(0),this.xn=!1,this.xn=!0,this.referenceDelegate=e(this),this.Un=new rc(this),this.indexManager=new xa,this.qn=function(e){return new nc(e)}((e=>this.referenceDelegate.Ii(e))),this.O=new Aa(t),this.Kn=new Qa(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ja,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.pi[e.toKey()];return n||(n=new tc(t,this.referenceDelegate),this.pi[e.toKey()]=n),n}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(e,t,n){Ei("MemoryPersistence","Starting transaction:",e);const i=new oc(this.Nn.next());return this.referenceDelegate.Ei(),n(i).next((e=>this.referenceDelegate.Ti(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Ai(e,t){return Ia.or(Object.values(this.pi).map((n=>()=>n.containsKey(e,t))))}}class oc extends Ta{constructor(e){super(),this.currentSequenceNumber=e}}class ac{constructor(e){this.persistence=e,this.Ri=new Za,this.Pi=null}static bi(e){return new ac(e)}get vi(){if(this.Pi)return this.Pi;throw Ni()}addReference(e,t,n){return this.Ri.addReference(n,t),this.vi.delete(n.toString()),Ia.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.vi.add(n.toString()),Ia.resolve()}markPotentiallyOrphaned(e,t){return this.vi.add(t.toString()),Ia.resolve()}removeTarget(e,t){this.Ri.si(t.targetId).forEach((e=>this.vi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.vi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Pi=new Set}Ti(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ia.forEach(this.vi,(n=>{const i=gr.fromPath(n);return this.Vi(e,i).next((e=>{e||t.removeEntry(i,Wi.min())}))})).next((()=>(this.Pi=null,t.apply(e))))}updateLimboDocument(e,t){return this.Vi(e,t).next((e=>{e?this.vi.delete(t.toString()):this.vi.add(t.toString())}))}Ii(e){return 0}Vi(e,t){return Ia.or([()=>Ia.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class cc{constructor(){this.activeTargetIds=po()}Ci(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ni(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Di(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class lc{constructor(){this._r=new cc,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this._r.Ci(e),this.wr[e]||"not-current"}updateQueryState(e,t,n){this.wr[e]=t}removeLocalQueryTarget(e){this._r.Ni(e)}isLocalQueryTarget(e){return this._r.activeTargetIds.has(e)}clearQueryState(e){delete this.wr[e]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(e){return this._r.activeTargetIds.has(e)}start(){return this._r=new cc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class hc{mr(e){}shutdown(){}}class uc{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(e){this.Er.push(e)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){Ei("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Er)e(0)}Ir(){Ei("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Er)e(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const dc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class fc{constructor(e){this.Ar=e.Ar,this.Rr=e.Rr}Pr(e){this.br=e}vr(e){this.Vr=e}onMessage(e){this.Sr=e}close(){this.Rr()}send(e){this.Ar(e)}Dr(){this.br()}Cr(e){this.Vr(e)}Nr(e){this.Sr(e)}}class pc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.kr=t+"://"+e.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(e,t,n,i,r){const s=this.$r(e,t);Ei("RestConnection","Sending: ",s,n);const o={};return this.Fr(o,i,r),this.Br(e,s,o,n).then((e=>(Ei("RestConnection","Received: ",e),e)),(t=>{throw ki("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}Lr(e,t,n,i,r){return this.Mr(e,t,n,i,r)}Fr(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+bi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}$r(e,t){const n=dc[e];return`${this.kr}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Br(e,t,n,i){return new Promise(((r,s)=>{const o=new _i;o.listenOnce(fi.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case di.NO_ERROR:const t=o.getResponseJson();Ei("Connection","XHR received:",JSON.stringify(t)),r(t);break;case di.TIMEOUT:Ei("Connection",'RPC "'+e+'" timed out'),s(new xi(Pi.DEADLINE_EXCEEDED,"Request time out"));break;case di.HTTP_ERROR:const n=o.getStatus();if(Ei("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Pi).indexOf(t)>=0?t:Pi.UNKNOWN}(e.status);s(new xi(t,e.message))}else s(new xi(Pi.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new xi(Pi.UNAVAILABLE,"Connection failed."));break;default:Ni()}}finally{Ei("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(i);o.send(t,"POST",a,n,15)}))}Ur(e,t,n){const i=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=hi(),s=ui(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new mi({})),this.Fr(o.initMessageHeaders,t,n),(0,a.uI)()||(0,a.b$)()||(0,a.d)()||(0,a.w1)()||(0,a.Mn)()||(0,a.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=i.join("");Ei("Connection","Creating WebChannel: "+c,o);const l=r.createWebChannel(c,o);let h=!1,u=!1;const d=new fc({Ar:e=>{u?Ei("Connection","Not sending because WebChannel is closed:",e):(h||(Ei("Connection","Opening WebChannel transport."),l.open(),h=!0),Ei("Connection","WebChannel sending:",e),l.send(e))},Rr:()=>l.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(l,yi.EventType.OPEN,(()=>{u||Ei("Connection","WebChannel transport opened.")})),f(l,yi.EventType.CLOSE,(()=>{u||(u=!0,Ei("Connection","WebChannel transport closed"),d.Cr())})),f(l,yi.EventType.ERROR,(e=>{u||(u=!0,ki("Connection","WebChannel transport errored:",e),d.Cr(new xi(Pi.UNAVAILABLE,"The operation could not be completed")))})),f(l,yi.EventType.MESSAGE,(e=>{var t;if(!u){const n=e.data[0];Ai(!!n);const i=n,r=i.error||(null===(t=i[0])||void 0===t?void 0:t.error);if(r){Ei("Connection","WebChannel received error:",r);const e=r.status;let t=function(e){const t=Xs[e];if(void 0!==t)return Zs(t)}(e),n=r.message;void 0===t&&(t=Pi.INTERNAL,n="Unknown error status: "+e+" with message "+r.message),u=!0,d.Cr(new xi(t,n)),l.close()}else Ei("Connection","WebChannel received:",n),d.Nr(n)}})),f(s,pi.STAT_EVENT,(e=>{e.stat===gi.PROXY?Ei("Connection","Detected buffering proxy"):e.stat===gi.NOPROXY&&Ei("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.Dr()}),0),d}}function gc(){return"undefined"!=typeof document?document:null}function mc(e){return new ko(e,!0)}class yc{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Sn=e,this.timerId=t,this.qr=n,this.Kr=i,this.Gr=r,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(e){this.cancel();const t=Math.floor(this.jr+this.Jr()),n=Math.max(0,Date.now()-this.Wr),i=Math.max(0,t-n);i>0&&Ei("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.jr} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,i,(()=>(this.Wr=Date.now(),e()))),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class _c{constructor(e,t,n,i,r,s,o,a){this.Sn=e,this.Xr=n,this.Zr=i,this.eo=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new yc(e,t)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,(()=>this.lo())))}fo(e){this._o(),this.stream.send(e)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(e,t){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==e?this.ro.reset():t&&t.code===Pi.RESOURCE_EXHAUSTED?(Ci(t.toString()),Ci("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):t&&t.code===Pi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.vr(t)}mo(){}auth(){this.state=1;const e=this.yo(this.no),t=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.no===t&&this.po(e,n)}),(t=>{e((()=>{const e=new xi(Pi.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Io(e)}))}))}po(e,t){const n=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr((()=>{n((()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,(()=>(this.co()&&(this.state=3),Promise.resolve()))),this.listener.Pr())))})),this.stream.vr((e=>{n((()=>this.Io(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}uo(){this.state=5,this.ro.Hr((async()=>{this.state=0,this.start()}))}Io(e){return Ei("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}yo(e){return t=>{this.Sn.enqueueAndForget((()=>this.no===e?t():(Ei("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class vc extends _c{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.O=r}Eo(e,t){return this.eo.Ur("Listen",e,t)}onMessage(e){this.ro.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ni()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.N?(Ai(void 0===t||"string"==typeof t),nr.fromBase64String(t||"")):(Ai(void 0===t||t instanceof Uint8Array),nr.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Pi.UNKNOWN:Zs(e.code);return new xi(t,e.message||"")}(o);n=new vo(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=Oo(e,i.document.name),s=Ro(i.document.updateTime),o=new Pr({mapValue:{fields:i.document.fields}}),a=Dr.newFoundDocument(r,s,o),c=i.targetIds||[],l=i.removedTargetIds||[];n=new yo(c,l,a.key,a)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=Oo(e,i.document),s=i.readTime?Ro(i.readTime):Wi.min(),o=Dr.newNoDocument(r,s),a=i.removedTargetIds||[];n=new yo([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=Oo(e,i.document),s=i.removedTargetIds||[];n=new yo([],s,r,null)}else{if(!("filter"in t))return Ni();{t.filter;const e=t.filter;e.targetId;const i=e.count||0,r=new Ys(i),s=e.targetId;n=new _o(s,r)}}return n}(this.O,e),n=function(e){if(!("targetChange"in e))return Wi.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Wi.min():t.readTime?Ro(t.readTime):Wi.min()}(e);return this.listener.To(t,n)}Ao(e){const t={};t.database=Fo(this.O),t.addTarget=function(e,t){let n;const i=t.target;return n=Vr(i)?{documents:jo(e,i)}:{query:$o(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=No(e,t.resumeToken):t.snapshotVersion.compareTo(Wi.min())>0&&(n.readTime=So(e,t.snapshotVersion.toTimestamp())),n}(this.O,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ni()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.O,e);n&&(t.labels=n),this.fo(t)}Ro(e){const t={};t.database=Fo(this.O),t.removeTarget=e,this.fo(t)}}class wc extends _c{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.O=r,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(e,t){return this.eo.Ur("Write",e,t)}onMessage(e){if(Ai(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();const t=function(e,t){return e&&e.length>0?(Ai(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Ro(e.updateTime):Ro(t);return n.isEqual(Wi.min())&&(n=Ro(t)),new Ds(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Ro(e.commitTime);return this.listener.Vo(n,t)}return Ai(!e.writeResults||0===e.writeResults.length),this.Po=!0,this.listener.So()}Do(){const e={};e.database=Fo(this.O),this.fo(e)}vo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>qo(this.O,e)))};this.fo(t)}}class bc extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.eo=n,this.O=i,this.Co=!1}No(){if(this.Co)throw new xi(Pi.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(e,t,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.eo.Mr(e,t,n,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Pi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xi(Pi.UNKNOWN,e.toString())}))}Lr(e,t,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.eo.Lr(e,t,n,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Pi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xi(Pi.UNKNOWN,e.toString())}))}terminate(){this.Co=!0}}class Tc{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve()))))}Bo(e){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.$o("Offline")))}set(e){this.Lo(),this.xo=0,"Online"===e&&(this.Oo=!1),this.$o(e)}$o(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Fo(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(Ci(t),this.Oo=!1):Ei("OnlineStateTracker",t)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class Ic{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=r,this.jo.mr((e=>{n.enqueueAndForget((async()=>{xc(this)&&(Ei("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ri(e);t.Ko.add(4),await Cc(t),t.Qo.set("Unknown"),t.Ko.delete(4),await Ec(t)}(this))}))})),this.Qo=new Tc(n,i)}}async function Ec(e){if(xc(e))for(const t of e.Go)await t(!0)}async function Cc(e){for(const t of e.Go)await t(!1)}function kc(e,t){const n=Ri(e);n.qo.has(t.targetId)||(n.qo.set(t.targetId,t),Pc(n)?Rc(n):Xc(n).co()&&Nc(n,t))}function Sc(e,t){const n=Ri(e),i=Xc(n);n.qo.delete(t),i.co()&&Ac(n,t),0===n.qo.size&&(i.co()?i.ho():xc(n)&&n.Qo.set("Unknown"))}function Nc(e,t){e.Wo.Z(t.targetId),Xc(e).Ao(t)}function Ac(e,t){e.Wo.Z(t),Xc(e).Ro(t)}function Rc(e){e.Wo=new bo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Tt:t=>e.qo.get(t)||null}),Xc(e).start(),e.Qo.Mo()}function Pc(e){return xc(e)&&!Xc(e).oo()&&e.qo.size>0}function xc(e){return 0===Ri(e).Ko.size}function Dc(e){e.Wo=void 0}async function Oc(e){e.qo.forEach(((t,n)=>{Nc(e,t)}))}async function Mc(e,t){Dc(e),Pc(e)?(e.Qo.Bo(t),Rc(e)):e.Qo.set("Unknown")}async function Lc(e,t,n){if(e.Qo.set("Online"),t instanceof vo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.qo.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.qo.delete(i),e.Wo.removeTarget(i))}(e,t)}catch(n){Ei("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Fc(e,n)}else if(t instanceof yo?e.Wo.ct(t):t instanceof _o?e.Wo._t(t):e.Wo.ht(t),!n.isEqual(Wi.min()))try{const t=await za(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Wo.yt(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.qo.get(i);r&&e.qo.set(i,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.qo.get(t);if(!n)return;e.qo.set(t,n.withResumeToken(nr.EMPTY_BYTE_STRING,n.snapshotVersion)),Ac(e,t);const i=new Na(n.target,t,1,n.sequenceNumber);Nc(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Ei("RemoteStore","Failed to raise snapshot:",t),await Fc(e,t)}}async function Fc(e,t,n){if(!Ea(t))throw t;e.Ko.add(1),await Cc(e),e.Qo.set("Offline"),n||(n=()=>za(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Ei("RemoteStore","Retrying IndexedDB access"),await n(),e.Ko.delete(1),await Ec(e)}))}function Uc(e,t){return t().catch((n=>Fc(e,n,t)))}async function Vc(e){const t=Ri(e),n=Qc(t);let i=t.Uo.length>0?t.Uo[t.Uo.length-1].batchId:-1;for(;qc(t);)try{const e=await Wa(t.localStore,i);if(null===e){0===t.Uo.length&&n.ho();break}i=e.batchId,jc(t,e)}catch(e){await Fc(t,e)}$c(t)&&Gc(t)}function qc(e){return xc(e)&&e.Uo.length<10}function jc(e,t){e.Uo.push(t);const n=Qc(e);n.co()&&n.bo&&n.vo(t.mutations)}function $c(e){return xc(e)&&!Qc(e).oo()&&e.Uo.length>0}function Gc(e){Qc(e).start()}async function Bc(e){Qc(e).Do()}async function zc(e){const t=Qc(e);for(const n of e.Uo)t.vo(n.mutations)}async function Kc(e,t,n){const i=e.Uo.shift(),r=ka.from(i,t,n);await Uc(e,(()=>e.remoteSyncer.applySuccessfulWrite(r))),await Vc(e)}async function Wc(e,t){t&&Qc(e).bo&&await async function(e,t){if(Js(n=t.code)&&n!==Pi.ABORTED){const n=e.Uo.shift();Qc(e).ao(),await Uc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Vc(e)}var n}(e,t),$c(e)&&Gc(e)}async function Hc(e,t){const n=Ri(e);n.asyncQueue.verifyOperationInProgress(),Ei("RemoteStore","RemoteStore received new credentials");const i=xc(n);n.Ko.add(3),await Cc(n),i&&n.Qo.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ko.delete(3),await Ec(n)}async function Yc(e,t){const n=Ri(e);t?(n.Ko.delete(2),await Ec(n)):t||(n.Ko.add(2),await Cc(n),n.Qo.set("Unknown"))}function Xc(e){return e.zo||(e.zo=function(e,t,n){const i=Ri(e);return i.No(),new vc(t,i.eo,i.authCredentials,i.appCheckCredentials,i.O,n)}(e.datastore,e.asyncQueue,{Pr:Oc.bind(null,e),vr:Mc.bind(null,e),To:Lc.bind(null,e)}),e.Go.push((async t=>{t?(e.zo.ao(),Pc(e)?Rc(e):e.Qo.set("Unknown")):(await e.zo.stop(),Dc(e))}))),e.zo}function Qc(e){return e.Ho||(e.Ho=function(e,t,n){const i=Ri(e);return i.No(),new wc(t,i.eo,i.authCredentials,i.appCheckCredentials,i.O,n)}(e.datastore,e.asyncQueue,{Pr:Bc.bind(null,e),vr:Wc.bind(null,e),So:zc.bind(null,e),Vo:Kc.bind(null,e)}),e.Go.push((async t=>{t?(e.Ho.ao(),await Vc(e)):(await e.Ho.stop(),e.Uo.length>0&&(Ei("RemoteStore",`Stopping write stream with ${e.Uo.length} pending writes`),e.Uo=[]))}))),e.Ho}class Jc{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Di,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new Jc(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xi(Pi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Zc(e,t){if(Ci("AsyncQueue",`${t}: ${e}`),Ea(e))return new xi(Pi.UNAVAILABLE,`${t}: ${e}`);throw e}class el{constructor(e){this.comparator=e?(t,n)=>e(t,n)||gr.comparator(t.key,n.key):(e,t)=>gr.comparator(e.key,t.key),this.keyedMap=co(),this.sortedSet=new eo(this.comparator)}static emptySet(e){return new el(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof el))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new el;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class tl{constructor(){this.Jo=new eo(gr.comparator)}track(e){const t=e.doc.key,n=this.Jo.get(t);n?0!==e.type&&3===n.type?this.Jo=this.Jo.insert(t,e):3===e.type&&1!==n.type?this.Jo=this.Jo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jo=this.Jo.remove(t):1===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):Ni():this.Jo=this.Jo.insert(t,e)}Yo(){const e=[];return this.Jo.inorderTraversal(((t,n)=>{e.push(n)})),e}}class nl{constructor(e,t,n,i,r,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,i){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new nl(e,t,el.emptySet(t),r,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&us(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class il{constructor(){this.Xo=void 0,this.listeners=[]}}class rl{constructor(){this.queries=new Fa((e=>ds(e)),us),this.onlineState="Unknown",this.Zo=new Set}}async function sl(e,t){const n=Ri(e),i=t.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new il),r)try{s.Xo=await n.onListen(i)}catch(e){const n=Zc(e,`Initialization of query '${fs(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.listeners.push(t),t.tc(n.onlineState),s.Xo&&t.ec(s.Xo)&&ll(n)}async function ol(e,t){const n=Ri(e),i=t.query;let r=!1;const s=n.queries.get(i);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}function al(e,t){const n=Ri(e);let i=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.listeners)e.ec(r)&&(i=!0);t.Xo=r}}i&&ll(n)}function cl(e,t,n){const i=Ri(e),r=i.queries.get(t);if(r)for(const s of r.listeners)s.onError(n);i.queries.delete(t)}function ll(e){e.Zo.forEach((e=>{e.next()}))}class hl{constructor(e,t,n){this.query=e,this.nc=t,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=n||{}}ec(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new nl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.sc?this.rc(e)&&(this.nc.next(e),t=!0):this.oc(e,this.onlineState)&&(this.cc(e),t=!0),this.ic=e,t}onError(e){this.nc.error(e)}tc(e){this.onlineState=e;let t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}oc(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.uc||!n)&&(!e.docs.isEmpty()||"Offline"===t)}rc(e){if(e.docChanges.length>0)return!0;const t=this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}cc(e){e=nl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}class ul{constructor(e){this.key=e}}class dl{constructor(e){this.key=e}}class fl{constructor(e,t){this.query=e,this.dc=t,this._c=null,this.current=!1,this.wc=uo(),this.mutatedKeys=uo(),this.mc=gs(e),this.gc=new el(this.mc)}get yc(){return this.dc}Ic(e,t){const n=t?t.Ec:new tl,i=t?t.gc:this.gc;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a=is(this.query)&&i.size===this.query.limit?i.last():null,c=rs(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const l=i.get(e),h=ps(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;l&&h?l.data.isEqual(h.data)?u!==d&&(n.track({type:3,doc:h}),f=!0):this.Tc(l,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.mc(h,a)>0||c&&this.mc(h,c)<0)&&(o=!0)):!l&&h?(n.track({type:0,doc:h}),f=!0):l&&!h&&(n.track({type:1,doc:l}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))})),is(this.query)||rs(this.query))for(;s.size>this.query.limit;){const e=is(this.query)?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{gc:s,Ec:n,ks:o,mutatedKeys:r}}Tc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;const r=e.Ec.Yo();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ni()}};return n(e)-n(t)}(e.type,t.type)||this.mc(e.doc,t.doc))),this.Ac(n);const s=t?this.Rc():[],o=0===this.wc.size&&this.current?1:0,a=o!==this._c;return this._c=o,0!==r.length||a?{snapshot:new nl(this.query,e.gc,i,r,e.mutatedKeys,0===o,a,!1),Pc:s}:{Pc:s}}tc(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new tl,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}Ac(e){e&&(e.addedDocuments.forEach((e=>this.dc=this.dc.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.dc=this.dc.delete(e))),this.current=e.current)}Rc(){if(!this.current)return[];const e=this.wc;this.wc=uo(),this.gc.forEach((e=>{this.bc(e.key)&&(this.wc=this.wc.add(e.key))}));const t=[];return e.forEach((e=>{this.wc.has(e)||t.push(new dl(e))})),this.wc.forEach((n=>{e.has(n)||t.push(new ul(n))})),t}vc(e){this.dc=e.Ks,this.wc=uo();const t=this.Ic(e.documents);return this.applyChanges(t,!0)}Vc(){return nl.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class pl{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class gl{constructor(e){this.key=e,this.Sc=!1}}class ml{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Dc={},this.Cc=new Fa((e=>ds(e)),us),this.Nc=new Map,this.xc=new Set,this.kc=new eo(gr.comparator),this.Oc=new Map,this.Mc=new Za,this.$c={},this.Fc=new Map,this.Bc=Ma.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function yl(e,t){const n=Ml(e);let i,r;const s=n.Cc.get(t);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.Vc();else{const e=await Ha(n.localStore,ls(t));n.isPrimaryClient&&kc(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,r=await _l(n,t,i,"current"===s)}return r}async function _l(e,t,n,i){e.Uc=(t,n,i)=>async function(e,t,n,i){let r=t.view.Ic(n);r.ks&&(r=await Xa(e.localStore,t.query,!1).then((({documents:e})=>t.view.Ic(e,r))));const s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return Al(e,t.targetId,o.Pc),o.snapshot}(e,t,n,i);const r=await Xa(e.localStore,t,!0),s=new fl(t,r.Ks),o=s.Ic(r.documents),a=mo.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Al(e,n,c.Pc);const l=new pl(t,n,s);return e.Cc.set(t,l),e.Nc.has(n)?e.Nc.get(n).push(t):e.Nc.set(n,[t]),c.snapshot}async function vl(e,t){const n=Ri(e),i=n.Cc.get(t),r=n.Nc.get(i.targetId);if(r.length>1)return n.Nc.set(i.targetId,r.filter((e=>!us(e,t)))),void n.Cc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Ya(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Sc(n.remoteStore,i.targetId),Sl(n,i.targetId)})).catch(La)):(Sl(n,i.targetId),await Ya(n.localStore,i.targetId,!0))}async function wl(e,t){const n=Ri(e);try{const e=await function(e,t){const n=Ri(e),i=t.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Bs.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];t.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.Un.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Un.addMatchingKeys(e,s.addedDocuments,a))));let l=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?l=l.withResumeToken(nr.EMPTY_BYTE_STRING,Wi.min()).withLastLimboFreeSnapshotVersion(Wi.min()):s.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(s.resumeToken,i)),r=r.insert(a,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,s)&&o.push(n.Un.updateTargetData(e,l))}));let a=oo();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(Ka(e,s,t.documentUpdates).next((e=>{a=e}))),!i.isEqual(Wi.min())){const t=n.Un.getLastRemoteSnapshotVersion(e).next((t=>n.Un.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return Ia.waitFor(o).next((()=>s.apply(e))).next((()=>n.Us.Ts(e,a))).next((()=>a))})).then((e=>(n.Ms=r,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.Oc.get(t);i&&(Ai(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.Sc=!0:e.modifiedDocuments.size>0?Ai(i.Sc):e.removedDocuments.size>0&&(Ai(i.Sc),i.Sc=!1))})),await xl(n,e,t)}catch(e){await La(e)}}function bl(e,t,n){const i=Ri(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Cc.forEach(((n,i)=>{const r=i.view.tc(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=Ri(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const r of n.listeners)r.tc(t)&&(i=!0)})),i&&ll(n)}(i.eventManager,t),e.length&&i.Dc.To(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Tl(e,t,n){const i=Ri(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.Oc.get(t),s=r&&r.key;if(s){let e=new eo(gr.comparator);e=e.insert(s,Dr.newNoDocument(s,Wi.min()));const n=uo().add(s),r=new go(Wi.min(),new Map,new io(Bi),e,n);await wl(i,r),i.kc=i.kc.remove(s),i.Oc.delete(t),Pl(i)}else await Ya(i.localStore,t,!1).then((()=>Sl(i,t,n))).catch(La)}async function Il(e,t){const n=Ri(e),i=t.batch.batchId;try{const e=await function(e,t){const n=Ri(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),r=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,s=r.keys();let o=Ia.resolve();return s.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Ai(null!==s),t.version.compareTo(s)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.gs.removeMutationBatch(t,r)))}(n,e,t,r).next((()=>r.apply(e))).next((()=>n.gs.performConsistencyCheck(e))).next((()=>n.Us.Es(e,i)))}))}(n.localStore,t);kl(n,i,null),Cl(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await xl(n,e)}catch(e){await La(e)}}async function El(e,t,n){const i=Ri(e);try{const e=await function(e,t){const n=Ri(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.gs.lookupMutationBatch(e,t).next((t=>(Ai(null!==t),i=t.keys(),n.gs.removeMutationBatch(e,t)))).next((()=>n.gs.performConsistencyCheck(e))).next((()=>n.Us.Es(e,i)))}))}(i.localStore,t);kl(i,t,n),Cl(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await xl(i,e)}catch(n){await La(n)}}function Cl(e,t){(e.Fc.get(t)||[]).forEach((e=>{e.resolve()})),e.Fc.delete(t)}function kl(e,t,n){const i=Ri(e);let r=i.$c[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.$c[i.currentUser.toKey()]=r}}function Sl(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Nc.get(t))e.Cc.delete(i),n&&e.Dc.qc(i,n);e.Nc.delete(t),e.isPrimaryClient&&e.Mc.si(t).forEach((t=>{e.Mc.containsKey(t)||Nl(e,t)}))}function Nl(e,t){e.xc.delete(t.path.canonicalString());const n=e.kc.get(t);null!==n&&(Sc(e.remoteStore,n),e.kc=e.kc.remove(t),e.Oc.delete(n),Pl(e))}function Al(e,t,n){for(const i of n)i instanceof ul?(e.Mc.addReference(i.key,t),Rl(e,i)):i instanceof dl?(Ei("SyncEngine","Document no longer in limbo: "+i.key),e.Mc.removeReference(i.key,t),e.Mc.containsKey(i.key)||Nl(e,i.key)):Ni()}function Rl(e,t){const n=t.key,i=n.path.canonicalString();e.kc.get(n)||e.xc.has(i)||(Ei("SyncEngine","New document in limbo: "+n),e.xc.add(i),Pl(e))}function Pl(e){for(;e.xc.size>0&&e.kc.size<e.maxConcurrentLimboResolutions;){const t=e.xc.values().next().value;e.xc.delete(t);const n=new gr(Ji.fromString(t)),i=e.Bc.next();e.Oc.set(i,new gl(n)),e.kc=e.kc.insert(n,i),kc(e.remoteStore,new Na(ls(ns(n.path)),i,2,ji.A))}}async function xl(e,t,n){const i=Ri(e),r=[],s=[],o=[];i.Cc.isEmpty()||(i.Cc.forEach(((e,a)=>{o.push(i.Uc(a,t,n).then((e=>{if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),r.push(e);const t=qa.Ss(a.targetId,e);s.push(t)}})))})),await Promise.all(o),i.Dc.To(r),await async function(e,t){const n=Ri(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ia.forEach(t,(t=>Ia.forEach(t.vs,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>Ia.forEach(t.Vs,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!Ea(e))throw e;Ei("LocalStore","Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.Ms.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(e,r)}}}(i.localStore,s))}async function Dl(e,t){const n=Ri(e);if(!n.currentUser.isEqual(t)){Ei("SyncEngine","User change. New user:",t.toKey());const e=await Ba(n.localStore,t);n.currentUser=t,function(e,t){e.Fc.forEach((e=>{e.forEach((e=>{e.reject(new xi(Pi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Fc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await xl(n,e.qs)}}function Ol(e,t){const n=Ri(e),i=n.Oc.get(t);if(i&&i.Sc)return uo().add(i.key);{let e=uo();const i=n.Nc.get(t);if(!i)return e;for(const t of i){const i=n.Cc.get(t);e=e.unionWith(i.view.yc)}return e}}function Ml(e){const t=Ri(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=wl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ol.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Tl.bind(null,t),t.Dc.To=al.bind(null,t.eventManager),t.Dc.qc=cl.bind(null,t.eventManager),t}function Ll(e){const t=Ri(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Il.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=El.bind(null,t),t}class Fl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.O=mc(e.databaseInfo.databaseId),this.sharedClientState=this.Gc(e),this.persistence=this.jc(e),await this.persistence.start(),this.gcScheduler=this.Qc(e),this.localStore=this.Wc(e)}Qc(e){return null}Wc(e){return Ga(this.persistence,new ja,e.initialUser,this.O)}jc(e){return new sc(ac.bi,this.O)}Gc(e){return new lc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ul{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>bl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Dl.bind(null,this.syncEngine),await Yc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new rl}createDatastore(e){const t=mc(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new pc(i));var i;return function(e,t,n,i){return new bc(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>bl(this.syncEngine,e,0),s=uc.Vt()?new uc:new hc,new Ic(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new ml(e,t,n,i,r,s);return o&&(a.Lc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Ri(e);Ei("RemoteStore","RemoteStore shutting down."),t.Ko.add(5),await Cc(t),t.jo.shutdown(),t.Qo.set("Unknown")}(this.remoteStore)}}class Vl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Hc(this.observer.next,e)}error(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Jc(){this.muted=!0}Hc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class ql{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=wi.UNAUTHENTICATED,this.clientId=Gi.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Ei("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Ei("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new xi(Pi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Di;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Zc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function jl(e,t){e.asyncQueue.verifyOperationInProgress(),Ei("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await Ba(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function $l(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Gl(e);Ei("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener((e=>Hc(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Hc(t.remoteStore,n))),e.onlineComponents=t}async function Gl(e){return e.offlineComponents||(Ei("FirestoreClient","Using default OfflineComponentProvider"),await jl(e,new Fl)),e.offlineComponents}async function Bl(e){return e.onlineComponents||(Ei("FirestoreClient","Using default OnlineComponentProvider"),await $l(e,new Ul)),e.onlineComponents}function zl(e){return Bl(e).then((e=>e.syncEngine))}async function Kl(e){const t=await Bl(e),n=t.eventManager;return n.onListen=yl.bind(null,t.syncEngine),n.onUnlisten=vl.bind(null,t.syncEngine),n}function Wl(e,t,n={}){const i=new Di;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,r){const s=new Vl({next:s=>{t.enqueueAndForget((()=>ol(e,o)));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new xi(Pi.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&i&&"server"===i.source?r.reject(new xi(Pi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:e=>r.reject(e)}),o=new hl(ns(n.path),s,{includeMetadataChanges:!0,uc:!0});return sl(e,o)}(await Kl(e),e.asyncQueue,t,n,i))),i.promise}const Hl=new Map;function Yl(e,t,n){if(!n)throw new xi(Pi.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Xl(e){if(!gr.isDocumentKey(e))throw new xi(Pi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ql(e){if(gr.isDocumentKey(e))throw new xi(Pi.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Jl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ni()}function Zl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new xi(Pi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Jl(e);throw new xi(Pi.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class eh{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new xi(Pi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new xi(Pi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,i){if(!0===t&&!0===i)throw new xi(Pi.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class th{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eh({}),this._settingsFrozen=!1,e instanceof ur?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new xi(Pi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ur(e.options.projectId)}(e))}get app(){if(!this._app)throw new xi(Pi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xi(Pi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Mi;switch(e.type){case"gapi":const t=e.client;return Ai(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Ui(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new xi(Pi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Hl.get(e);t&&(Ei("ComponentProvider","Removing Datastore"),Hl.delete(e),t.terminate())}(this),Promise.resolve()}}class nh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new nh(this.firestore,e,this._key)}}class ih{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ih(this.firestore,e,this._query)}}class rh extends ih{constructor(e,t,n){super(e,t,ns(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new nh(this.firestore,null,new gr(e))}withConverter(e){return new rh(this.firestore,e,this._path)}}function sh(e,t,...n){if(e=(0,a.m9)(e),Yl("collection","path",t),e instanceof th){const i=Ji.fromString(t,...n);return Ql(i),new rh(e,null,i)}{if(!(e instanceof nh||e instanceof rh))throw new xi(Pi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Ji.fromString(t,...n));return Ql(i),new rh(e.firestore,null,i)}}function oh(e,t,...n){if(e=(0,a.m9)(e),1===arguments.length&&(t=Gi.R()),Yl("doc","path",t),e instanceof th){const i=Ji.fromString(t,...n);return Xl(i),new nh(e,null,new gr(i))}{if(!(e instanceof nh||e instanceof rh))throw new xi(Pi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Ji.fromString(t,...n));return Xl(i),new nh(e.firestore,e instanceof rh?e.converter:null,new gr(i))}}class ah{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new yc(this,"async_queue_retry"),this.yu=()=>{const e=gc();e&&Ei("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ro.Yr()};const e=gc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.fu){this.fu=!0,this.mu=e||!1;const t=gc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.yu)}}enqueue(e){if(this.pu(),this.fu)return new Promise((()=>{}));const t=new Di;return this.Iu((()=>this.fu&&this.mu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.lu.push(e),this.Eu())))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(b){if(!Ea(b))throw b;Ei("AsyncQueue","Operation failed with retryable error: "+b)}this.lu.length>0&&this.ro.Hr((()=>this.Eu()))}}Iu(e){const t=this.hu.then((()=>(this.wu=!0,e().catch((e=>{this._u=e,this.wu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Ci("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.wu=!1,e))))));return this.hu=t,t}enqueueAfterDelay(e,t,n){this.pu(),this.gu.indexOf(e)>-1&&(t=0);const i=Jc.createAndSchedule(this,e,t,n,(e=>this.Tu(e)));return this.du.push(i),i}pu(){this._u&&Ni()}verifyOperationInProgress(){}async Au(){let e;do{e=this.hu,await e}while(e!==this.hu)}Ru(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}Pu(e){return this.Au().then((()=>{this.du.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.du)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Au()}))}bu(e){this.gu.push(e)}Tu(e){const t=this.du.indexOf(e);this.du.splice(t,1)}}function ch(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const i of["next","error","complete"])if(i in n&&"function"==typeof n[i])return!0;return!1}(e)}class lh extends th{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new ah,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||dh(this),this._firestoreClient.terminate()}}function hh(e=(0,r.Mq)()){return(0,r.qX)(e,"firestore").getImmediate()}function uh(e){return e._firestoreClient||dh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function dh(e){var t;const n=e._freezeSettings(),i=function(e,t,n,i){return new hr(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new ql(e._authCredentials,e._appCheckCredentials,e._queue,i)}class fh{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xi(Pi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new er(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ph{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ph(nr.fromBase64String(e))}catch(e){throw new xi(Pi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ph(nr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gh{constructor(e){this._methodName=e}}class mh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xi(Pi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xi(Pi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Bi(this._lat,e._lat)||Bi(this._long,e._long)}}const yh=/^__.*__$/;class _h{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms):new $s(e,this.data,t,this.fieldTransforms)}}class vh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ni()}}class bh{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.O=n,this.ignoreUndefinedProperties=i,void 0===r&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(e){return new bh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Cu:!1});return i.Nu(e),i}xu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Su({path:n,Cu:!1});return i.vu(),i}ku(e){return this.Su({path:void 0,Cu:!0})}Ou(e){return Fh(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}Nu(e){if(0===e.length)throw this.Ou("Document fields must not be empty");if(wh(this.Vu)&&yh.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}class Th{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=n||mc(e)}Fu(e,t,n,i=!1){return new bh({Vu:e,methodName:t,$u:n,path:er.emptyPath(),Cu:!1,Mu:i},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function Ih(e){const t=e._freezeSettings(),n=mc(e._databaseId);return new Th(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Eh(e,t,n,i,r,s={}){const o=e.Fu(s.merge||s.mergeFields?2:0,t,n,r);Dh("Data must be an object, but it was:",o,i);const a=Ph(i,o);let c,l;if(s.merge)c=new tr(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const i of s.mergeFields){const r=Oh(t,i,n);if(!o.contains(r))throw new xi(Pi.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Uh(e,r)||e.push(r)}c=new tr(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new _h(new Pr(a),c,l)}class Ch extends gh{_toFieldTransform(e){if(2!==e.Vu)throw 1===e.Vu?e.Ou(`${this._methodName}() can only appear at the top level of your update data`):e.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ch}}class kh extends gh{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){const t=new As(e.O,vs(e.O,this.Lu));return new xs(e.path,t)}isEqual(e){return this===e}}function Sh(e,t,n,i){const r=e.Fu(1,t,n);Dh("Data must be an object, but it was:",r,i);const s=[],o=Pr.empty();Yi(i,((e,i)=>{const c=Lh(t,e,n);i=(0,a.m9)(i);const l=r.xu(c);if(i instanceof Ch)s.push(c);else{const e=Rh(i,l);null!=e&&(s.push(c),o.set(c,e))}}));const c=new tr(s);return new vh(o,c,r.fieldTransforms)}function Nh(e,t,n,i,r,s){const o=e.Fu(1,t,n),c=[Oh(t,i,n)],l=[r];if(s.length%2!=0)throw new xi(Pi.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<s.length;a+=2)c.push(Oh(t,s[a])),l.push(s[a+1]);const h=[],u=Pr.empty();for(let f=c.length-1;f>=0;--f)if(!Uh(h,c[f])){const e=c[f];let t=l[f];t=(0,a.m9)(t);const n=o.xu(e);if(t instanceof Ch)h.push(e);else{const i=Rh(t,n);null!=i&&(h.push(e),u.set(e,i))}}const d=new tr(h);return new vh(u,d,o.fieldTransforms)}function Ah(e,t,n,i=!1){return Rh(n,e.Fu(i?4:3,t))}function Rh(e,t){if(xh(e=(0,a.m9)(e)))return Dh("Unsupported field value:",t,e),Ph(e,t);if(e instanceof gh)return function(e,t){if(!wh(t.Vu))throw t.Ou(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Ou(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Cu&&4!==t.Vu)throw t.Ou("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=Rh(r,t.ku(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,a.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vs(t.O,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Ki.fromDate(e);return{timestampValue:So(t.O,n)}}if(e instanceof Ki){const n=new Ki(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:So(t.O,n)}}if(e instanceof mh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ph)return{bytesValue:No(t.O,e._byteString)};if(e instanceof nh){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Ou(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Po(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ou(`Unsupported field value: ${Jl(e)}`)}(e,t)}function Ph(e,t){const n={};return Xi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Yi(e,((e,i)=>{const r=Rh(i,t.Du(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}function xh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Ki||e instanceof mh||e instanceof ph||e instanceof nh||e instanceof gh)}function Dh(e,t,n){if(!xh(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=Jl(n);throw"an object"===i?t.Ou(e+" a custom object"):t.Ou(e+" "+i)}}function Oh(e,t,n){if((t=(0,a.m9)(t))instanceof fh)return t._internalPath;if("string"==typeof t)return Lh(e,t);throw Fh("Field path arguments must be of type string or ",e,!1,void 0,n)}const Mh=new RegExp("[~\\*/\\[\\]]");function Lh(e,t,n){if(t.search(Mh)>=0)throw Fh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new fh(...t.split("."))._internalPath}catch(i){throw Fh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Fh(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new xi(Pi.INVALID_ARGUMENT,a+e+c)}function Uh(e,t){return e.some((e=>e.isEqual(t)))}class Vh{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new nh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new qh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(jh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class qh extends Vh{data(){return super.data()}}function jh(e,t){return"string"==typeof t?Lh(e,t):t instanceof fh?t._internalPath:t._delegate._internalPath}class $h{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Gh extends Vh{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(jh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Bh extends Gh{data(e={}){return super.data(e)}}class zh{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new $h(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Bh(this._firestore,this._userDataWriter,n.key,n,new $h(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xi(Pi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new Bh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new $h(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new Bh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new $h(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Kh(t.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Kh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ni()}}function Wh(e){if(rs(e)&&0===e.explicitOrderBy.length)throw new xi(Pi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hh{}function Yh(e,...t){for(const n of t)e=n._apply(e);return e}class Xh extends Hh{constructor(e,t,n){super(),this.Uu=e,this.qu=t,this.Ku=n,this.type="where"}_apply(e){const t=Ih(e.firestore),n=function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new xi(Pi.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){tu(o,s);const t=[];for(const n of o)t.push(eu(i,e,n));a={arrayValue:{values:t}}}else a=eu(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||tu(o,s),a=Ah(n,"where",o,"in"===s||"not-in"===s);const c=qr.create(r,s,a);return function(e,t){if(t.S()){const n=os(e);if(null!==n&&!n.isEqual(t.field))throw new xi(Pi.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const i=ss(e);null!==i&&nu(e,t.field,i)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new xi(Pi.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new xi(Pi.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new ih(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new es(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function Qh(e,t,n){const i=t,r=jh("where",e);return new Xh(r,i,n)}class Jh extends Hh{constructor(e,t){super(),this.Uu=e,this.Gu=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new xi(Pi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new xi(Pi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new Xr(t,n);return function(e,t){if(null===ss(e)){const n=os(e);null!==n&&nu(e,n,t.field)}}(e,i),i}(e._query,this.Uu,this.Gu);return new ih(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new es(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Zh(e,t="asc"){const n=t,i=jh("orderBy",e);return new Jh(i,n)}function eu(e,t,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new xi(Pi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!as(t)&&-1!==n.indexOf("/"))throw new xi(Pi.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(Ji.fromString(n));if(!gr.isDocumentKey(i))throw new xi(Pi.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Er(e,new gr(i))}if(n instanceof nh)return Er(e,n._key);throw new xi(Pi.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Jl(n)}.`)}function tu(e,t){if(!Array.isArray(e)||0===e.length)throw new xi(Pi.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new xi(Pi.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function nu(e,t,n){if(!n.isEqual(t))throw new xi(Pi.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class iu{convertValue(e,t="none"){switch(yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(or(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ni()}}convertObject(e,t){const n={};return Yi(e.fields,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertGeoPoint(e){return new mh(sr(e.latitude),sr(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=cr(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(lr(e));default:return null}}convertTimestamp(e){const t=rr(e);return new Ki(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ji.fromString(e);Ai(Jo(n));const i=new ur(n.get(1),n.get(3)),r=new gr(n.popFirst(5));return i.isEqual(t)||Ci(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function ru(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}function su(e){e=Zl(e,nh);const t=Zl(e.firestore,lh);return Wl(uh(t),e._key).then((n=>du(t,e,n)))}class ou extends iu{constructor(e){super(),this.firestore=e}convertBytes(e){return new ph(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new nh(this.firestore,null,t)}}function au(e,t,n){e=Zl(e,nh);const i=Zl(e.firestore,lh),r=ru(e.converter,t,n);return uu(i,[Eh(Ih(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Os.none())])}function cu(e,t,n,...i){e=Zl(e,nh);const r=Zl(e.firestore,lh),s=Ih(r);let o;return o="string"==typeof(t=(0,a.m9)(t))||t instanceof fh?Nh(s,"updateDoc",e._key,t,n,i):Sh(s,"updateDoc",e._key,t),uu(r,[o.toMutation(e._key,Os.exists(!0))])}function lu(e,t){const n=Zl(e.firestore,lh),i=oh(e),r=ru(e.converter,t);return uu(n,[Eh(Ih(e.firestore),"addDoc",i._key,r,null!==e.converter,{}).toMutation(i._key,Os.exists(!1))]).then((()=>i))}function hu(e,...t){var n,i,r;e=(0,a.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||ch(t[o])||(s=t[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges};if(ch(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[o+2]=null===(r=e.complete)||void 0===r?void 0:r.bind(e)}let l,h,u;if(e instanceof nh)h=Zl(e.firestore,lh),u=ns(e._key.path),l={next:n=>{t[o]&&t[o](du(h,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Zl(e,ih);h=Zl(n.firestore,lh),u=n._query;const i=new ou(h);l={next:e=>{t[o]&&t[o](new zh(h,i,n,e))},error:t[o+1],complete:t[o+2]},Wh(e._query)}return function(e,t,n,i){const r=new Vl(i),s=new hl(t,r,n);return e.asyncQueue.enqueueAndForget((async()=>sl(await Kl(e),s))),()=>{r.Jc(),e.asyncQueue.enqueueAndForget((async()=>ol(await Kl(e),s)))}}(uh(h),u,c,l)}function uu(e,t){return function(e,t){const n=new Di;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=Ll(e);try{const e=await function(e,t){const n=Ri(e),i=Ki.now(),r=t.reduce(((e,t)=>e.add(t.key)),uo());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.Us.Es(e,r).next((r=>{s=r;const o=[];for(const e of t){const t=Vs(e,s.get(e.key));null!=t&&o.push(new Gs(e.key,t,xr(t.value.mapValue),Os.exists(!0)))}return n.gs.addMutationBatch(e,i,o,t)})))).then((e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.$c[e.currentUser.toKey()];i||(i=new eo(Bi)),i=i.insert(t,n),e.$c[e.currentUser.toKey()]=i}(i,e.batchId,n),await xl(i,e.changes),await Vc(i.remoteStore)}catch(e){const t=Zc(e,"Failed to persist write");n.reject(t)}}(await zl(e),t,n))),n.promise}(uh(e),t)}function du(e,t,n){const i=n.docs.get(t._key),r=new ou(e);return new Gh(e,r,t._key,i,new $h(n.hasPendingWrites,n.fromCache),t.converter)}function fu(e){return new kh("increment",e)}!function(e,t=!0){!function(e){bi=e}(r.Jn),(0,r.Xd)(new s.wA("firestore",((e,{options:n})=>{const i=e.getProvider("app").getImmediate(),r=new lh(i,new Li(e.getProvider("auth-internal")),new qi(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),r._setSettings(n),r}),"PUBLIC")),(0,r.KN)(vi,"3.4.5",e),(0,r.KN)(vi,"3.4.5","esm2017")}()},4444:function(e,t,n){"use strict";n.d(t,{BH:function(){return p},LL:function(){return S},ZR:function(){return k},gQ:function(){return G},zI:function(){return C},hu:function(){return o},g5:function(){return a},US:function(){return l},tV:function(){return u},h$:function(){return h},$s:function(){return X},r3:function(){return O},ne:function(){return B},p$:function(){return d},vZ:function(){return U},gK:function(){return W},pd:function(){return $},m9:function(){return Q},z$:function(){return g},GJ:function(){return D},ru:function(){return y},d:function(){return v},xb:function(){return L},w1:function(){return w},hl:function(){return I},uI:function(){return m},Yr:function(){return T},b$:function(){return _},Mn:function(){return b},w9:function(){return x},cI:function(){return A},UI:function(){return F},xO:function(){return q},zd:function(){return j},DV:function(){return M},ug:function(){return Y},dS:function(){return H},Pz:function(){return R},eu:function(){return E}});const i=!1,r=!1,s="${JSCORE_VERSION}",o=function(e,t){if(!e)throw a(t)},a=function(e){return new Error("Firebase Database ("+s+") INTERNAL ASSERT FAILED: "+e)},c=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<e.length;r+=3){const t=e[r],s=r+1<e.length,o=s?e[r+1]:0,a=r+2<e.length,c=a?e[r+2]:0,l=t>>2,h=(3&t)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(c(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],s=r<e.length?n[e.charAt(r)]:0;++r;const o=r<e.length?n[e.charAt(r)]:64;++r;const a=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==s||null==o||null==a)throw Error();const c=t<<2|s>>4;if(i.push(c),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},h=function(e){const t=c(e);return l.encodeByteArray(t,!0)},u=function(e){try{return l.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function d(e){return f(void 0,e)}function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=f(e[n],t[n]));return e}class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function g(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function m(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function y(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function _(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function v(){return g().indexOf("Electron/")>=0}function w(){const e=g();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function b(){return g().indexOf("MSAppHost/")>=0}function T(){return!0===i||!0===r}function I(){return"object"===typeof indexedDB}function E(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}))}function C(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}class k extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(N,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new k(i,o,n)}}const N=/\{\$([^}]+)}/g;function A(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}const P=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=A(u(s[0])||""),n=A(u(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(s){}return{header:t,claims:n,data:i,signature:r}},x=function(e){const t=P(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")},D=function(e){const t=P(e).claims;return"object"===typeof t&&!0===t.admin};function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function L(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function F(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function U(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(V(n)&&V(s)){if(!U(n,s))return!1}else if(n!==s)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function V(e){return null!==e&&"object"===typeof e}function q(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function j(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function $(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class G{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let h=0;h<16;h++)n[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)n[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const e=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=4294967295&(e<<1|e>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):h<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const e=(s<<5|s>>>27)+i+l+r+n[h]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"===typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}function B(e,t){const n=new z(e,t);return n.subscribe.bind(n)}class z{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=K),void 0===i.error&&(i.error=K),void 0===i.complete&&(i.complete=K);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function K(){}function W(e,t){return`${e} failed: ${t} argument `}const H=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){const t=r-55296;i++,o(i<e.length,"Surrogate pair missing trail surrogate.");r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):r<65536?(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Y=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function X(e,t=1e3,n=2){const i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function Q(e){return e&&e._delegate?e._delegate:e}},6256:function(e,t,n){"use strict";n.d(t,{N8:function(){return qr},ae:function(){return Ar},jM:function(){return Mr},VF:function(){return Rr},iH:function(){return Sr},t8:function(){return Pr}});var i=n(2238),r=n(8463),s=n(4444),o=n(3333),a=n(3454);const c="@firebase/database",l="0.12.5";let h="";class u{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,s.Pz)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,s.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class d{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,s.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const f=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new u(t)}}catch(t){}return new d},p=f("localStorage"),g=f("sessionStorage"),m=new o.Yd("@firebase/database"),y=function(){let e=1;return function(){return e++}}(),_=function(e){const t=(0,s.dS)(e),n=new s.gQ;n.update(t);const i=n.digest();return s.US.encodeByteArray(i)},v=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?t+=v.apply(null,i):t+="object"===typeof i?(0,s.Pz)(i):i,t+=" "}return t};let w=null,b=!0;const T=function(e,t){(0,s.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(m.logLevel=o.in.VERBOSE,w=m.log.bind(m),t&&g.set("logging_enabled",!0)):"function"===typeof e?w=e:(w=null,g.remove("logging_enabled"))},I=function(...e){if(!0===b&&(b=!1,null===w&&!0===g.get("logging_enabled")&&T(!0)),w){const t=v.apply(null,e);w(t)}},E=function(e){return function(...t){I(e,...t)}},C=function(...e){const t="FIREBASE INTERNAL ERROR: "+v(...e);m.error(t)},k=function(...e){const t=`FIREBASE FATAL ERROR: ${v(...e)}`;throw m.error(t),new Error(t)},S=function(...e){const t="FIREBASE WARNING: "+v(...e);m.warn(t)},N=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},A="[MIN_NAME]",R="[MAX_NAME]",P=function(e,t){if(e===t)return 0;if(e===A||t===R)return-1;if(t===A||e===R)return 1;{const n=j(e),i=j(t);return null!==n?null!==i?n-i===0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},x=function(e,t){return e===t?0:e<t?-1:1},D=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,s.Pz)(t))},O=function(e){if("object"!==typeof e||null===e)return(0,s.Pz)(e);const t=[];for(const i in e)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=(0,s.Pz)(t[i]),n+=":",n+=O(e[t[i]]);return n+="}",n},M=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function L(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const F=function(e){(0,s.hu)(!N(e),"Invalid JSON number");const t=1023;let n,i,r,o,a;0===e?(i=0,r=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),i=o+t,r=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(i=0,r=Math.round(e/Math.pow(2,-1074))));const c=[];for(a=52;a;a-=1)c.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)c.push(i%2?1:0),i=Math.floor(i/2);c.push(n?1:0),c.reverse();const l=c.join("");let h="";for(a=0;a<64;a+=8){let e=parseInt(l.substr(a,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()};const U=new RegExp("^-?(0*)\\d{1,10}$"),V=-2147483648,q=2147483647,j=function(e){if(U.test(e)){const t=Number(e);if(t>=V&&t<=q)return t}return null},$=function(e){try{e()}catch(t){setTimeout((()=>{const e=t.stack||"";throw S("Exception was thrown by user callback.",e),t}),Math.floor(0))}},G=function(e,t){const n=setTimeout(e,t);return"object"===typeof n&&n.unref&&n.unref(),n};class B{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){S(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class z{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(I("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',S(e)}}class K{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}K.OWNER="owner";const W="5",H=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Y="websocket",X="long_polling";class Q{constructor(e,t,n,i,r=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function J(e,t,n){let i;if((0,s.hu)("string"===typeof t,"typeof type must == string"),(0,s.hu)("object"===typeof n,"typeof params must == object"),t===Y)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==X)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return L(n,((e,t)=>{r.push(e+"="+t)})),i+r.join("&")}class Z{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,s.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,s.p$)(this.counters_)}}const ee={},te={};function ne(e){const t=e.toString();return ee[t]||(ee[t]=new Z),ee[t]}class ie{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&$((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const re="start";class se{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=ne(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),J(t,X,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ie(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,s.Yr)()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new oe(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===re)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={start:"t"};e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=W,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&H.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){se.forceAllow_=!0}static forceDisallow(){se.forceDisallow_=!0}static isAvailable(){return!(0,s.Yr)()&&(!!se.forceAllow_||!se.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,s.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=(0,s.h$)(t),i=M(n,1840);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,s.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,s.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class oe{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,s.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=y(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=oe.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){I("frame writing exception"),r.stack&&I(r.stack),I(r)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||I("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){(0,s.Yr)()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{I("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}}),Math.floor(1))}}let ae=null;"undefined"!==typeof MozWebSocket?ae=MozWebSocket:"undefined"!==typeof WebSocket&&(ae=WebSocket);class ce{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=ne(t),this.connURL=ce.connectionURL_(t,s,o,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i){const r={};return r.v=W,!(0,s.Yr)()&&"undefined"!==typeof location&&location.hostname&&H.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r.ac=i),J(e,Y,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{if((0,s.Yr)()){const e=this.nodeAdmin?"AdminNode":"Node",t={headers:{"User-Agent":`Firebase/5/${h}/${a.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=a.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(t.proxy={origin:i}),this.mySock=new ae(this.connURL,[],t)}else{const e={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new ae(this.connURL,[],e)}}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ce.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ae&&!ce.forceDisallow_}static previouslyFailed(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")}markConnectionHealthy(){p.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=(0,s.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,s.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=(0,s.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=M(t,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ce.responsesRequiredToBeHealthy=2,ce.healthyTimeout=3e4;class le{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[se,ce]}initTransports_(e){const t=ce&&ce.isAvailable();let n=t&&!ce.previouslyFailed();if(e.webSocketOnly&&(t||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ce];else{const e=this.transports_=[];for(const t of le.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class he{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new le(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=G((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=D("t",e),n=D("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=D("t",e),n=D("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=D("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?C("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):C("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),W!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),G((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):G((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ue{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class de{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,s.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!n||n===i[r].context))return void i.splice(r,1)}validateEventType_(e){(0,s.hu)(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class fe extends de{constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||(0,s.uI)()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new fe}getInitialEvent(e){return(0,s.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class pe{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ge(){return new pe("")}function me(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ye(e){return e.pieces_.length-e.pieceNum_}function _e(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new pe(e.pieces_,t)}function ve(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function we(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function be(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new pe(t,0)}function Te(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof pe)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new pe(n,0)}function Ie(e){return e.pieceNum_>=e.pieces_.length}function Ee(e,t){const n=me(e),i=me(t);if(null===n)return t;if(n===i)return Ee(_e(e),_e(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ce(e,t){const n=we(e,0),i=we(t,0);for(let r=0;r<n.length&&r<i.length;r++){const e=P(n[r],i[r]);if(0!==e)return e}return n.length===i.length?0:n.length<i.length?-1:1}function ke(e,t){if(ye(e)!==ye(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Se(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(ye(e)>ye(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Ne{constructor(e,t){this.errorPrefix_=t,this.parts_=we(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=(0,s.ug)(this.parts_[n]);Ae(this)}}function Ae(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Re(e))}function Re(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Pe extends de{constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Pe}getInitialEvent(e){return(0,s.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const xe=1e3;class De extends ue{constructor(e,t,n,i,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=De.nextPersistentConnectionId_++,this.log_=E("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xe,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!(0,s.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pe.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&fe.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_((0,s.Pz)(r)),(0,s.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new s.BH,n={p:e._path.toString(),q:e._queryObject},i={action:"g",request:n,onComplete:e=>{const i=e.d;"ok"===e.s?(this.onDataUpdate_(n.p,i,!1,null),t.resolve(i)):t.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_||setTimeout((()=>{const e=this.outstandingGets_[r];void 0!==e&&i===e&&(delete this.outstandingGets_[r],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+r+" timed out on connection"),t.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),(0,s.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,s.hu)(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;De.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&(0,s.r3)(e,"w")){const n=(0,s.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();S(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,s.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=(0,s.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,s.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,s.Pz)(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):C("Unrecognized action received from server: "+(0,s.Pz)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,s.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=xe),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+De.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){(0,s.hu)(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[s,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?I("getToken() completed but was canceled"):(I("getToken() completed. Creating connection."),this.authToken_=s&&s.accessToken,this.appCheckToken_=c&&c.token,a=new he(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{S(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(C){this.log_("Failed to get token: "+C),o||(this.repoInfo_.nodeAdmin&&S(C),c())}}}interrupt(e){I("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){I("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,s.xb)(this.interruptReasons_)&&(this.reconnectDelay_=xe,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>O(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new pe(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){I("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){I("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";(0,s.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+h.replace(/\./g,"-")]=1,(0,s.uI)()?e["framework.cordova"]=1:(0,s.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=fe.getInstance().currentlyOnline();return(0,s.xb)(this.interruptReasons_)&&e}}De.nextPersistentConnectionId_=0,De.nextConnectionId_=0;class Oe{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Oe(e,t)}}class Me{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Oe(A,e),i=new Oe(A,t);return 0!==this.compare(n,i)}minPost(){return Oe.MIN}}let Le;class Fe extends Me{static get __EMPTY_NODE(){return Le}static set __EMPTY_NODE(e){Le=e}compare(e,t){return P(e.name,t.name)}isDefinedOn(e){throw(0,s.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Oe.MIN}maxPost(){return new Oe(R,Le)}makePost(e,t){return(0,s.hu)("string"===typeof e,"KeyIndex indexValue must always be a string."),new Oe(e,Le)}toString(){return".key"}}const Ue=new Fe;class Ve{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class qe{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:qe.RED,this.left=null!=i?i:je.EMPTY_NODE,this.right=null!=r?r:je.EMPTY_NODE}copy(e,t,n,i,r){return new qe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return je.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return je.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}qe.RED=!0,qe.BLACK=!1;class je{constructor(e,t=je.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new je(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,qe.BLACK,null,null))}remove(e){return new je(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,qe.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ve(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ve(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ve(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ve(this.root_,null,this.comparator_,!0,e)}}function $e(e,t){return P(e.name,t.name)}function Ge(e,t){return P(e,t)}let Be;je.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new qe(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const ze=function(e){return"number"===typeof e?"number:"+F(e):"string:"+e},Ke=function(e){if(e.isLeafNode()){const t=e.val();(0,s.hu)("string"===typeof t||"number"===typeof t||"object"===typeof t&&(0,s.r3)(t,".sv"),"Priority must be a string or number.")}else(0,s.hu)(e===Be||e.isEmpty(),"priority of unexpected type.");(0,s.hu)(e===Be||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let We,He,Ye;class Xe{constructor(e,t=Xe.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,s.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ke(this.priorityNode_)}static set __childrenNodeConstructor(e){We=e}static get __childrenNodeConstructor(){return We}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Xe(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Xe.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ie(e)?this:".priority"===me(e)?this.priorityNode_:Xe.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Xe.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=me(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,s.hu)(".priority"!==n||1===ye(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Xe.__childrenNodeConstructor.EMPTY_NODE.updateChild(_e(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ze(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?F(this.value_):this.value_,this.lazyHash_=_(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Xe.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Xe.__childrenNodeConstructor?-1:((0,s.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=Xe.VALUE_TYPE_ORDER.indexOf(t),r=Xe.VALUE_TYPE_ORDER.indexOf(n);return(0,s.hu)(i>=0,"Unknown leaf type: "+t),(0,s.hu)(r>=0,"Unknown leaf type: "+n),i===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Xe.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Qe=new class extends Me{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?P(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Oe.MIN}maxPost(){return new Oe(R,new Xe("[PRIORITY-POST]",Ye))}makePost(e,t){const n=He(e);return new Oe(t,new Xe("[PRIORITY-POST]",n))}toString(){return".priority"}},Je=Math.log(2);class Ze{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Je,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const et=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new qe(a,o.node,qe.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new qe(a,o.node,qe.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],u=n?n(h):h;c(new qe(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,qe.BLACK):(a(i,qe.BLACK),a(i,qe.RED))}return s}(new Ze(e.length));return new je(i||t,s)};let tt;const nt={};class it{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,s.hu)(nt&&Qe,"ChildrenNode.ts has not been loaded"),tt=tt||new it({".priority":nt},{".priority":Qe}),tt}get(e){const t=(0,s.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof je?t:null}hasIndex(e){return(0,s.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,s.hu)(e!==Ue,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=t.getIterator(Oe.Wrap);let o,a=r.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=r.getNext();o=i?et(n,e.getCompare()):nt;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new it(h,l)}addToIndexes(e,t){const n=(0,s.UI)(this.indexes_,((n,i)=>{const r=(0,s.DV)(this.indexSet_,i);if((0,s.hu)(r,"Missing index implementation for "+i),n===nt){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(Oe.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),et(n,r.getCompare())}return nt}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new Oe(e.name,i))),r.insert(e,e.node)}}));return new it(n,this.indexSet_)}removeFromIndexes(e,t){const n=(0,s.UI)(this.indexes_,(n=>{if(n===nt)return n;{const i=t.get(e.name);return i?n.remove(new Oe(e.name,i)):n}}));return new it(n,this.indexSet_)}}let rt;class st{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ke(this.priorityNode_),this.children_.isEmpty()&&(0,s.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return rt||(rt=new st(new je(Ge),null,it.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||rt}updatePriority(e){return this.children_.isEmpty()?this:new st(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?rt:t}}getChild(e){const t=me(e);return null===t?this:this.getImmediateChild(t).getChild(_e(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,s.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Oe(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?rt:this.priorityNode_;return new st(i,s,r)}}updateChild(e,t){const n=me(e);if(null===n)return t;{(0,s.hu)(".priority"!==me(e)||1===ye(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(_e(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(Qe,((s,o)=>{t[s]=o.val(e),n++,r&&st.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+ze(this.getPriority().val())+":"),this.forEachChild(Qe,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":_(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Oe(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Oe(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Oe(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Oe.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Oe.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ot?-1:0}withIndex(e){if(e===Ue||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new st(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ue||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Qe),n=t.getIterator(Qe);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===Ue?null:this.indexMap_.get(e.toString())}}st.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ot=new class extends st{constructor(){super(new je(Ge),st.EMPTY_NODE,it.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return st.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Oe,{MIN:{value:new Oe(A,st.EMPTY_NODE)},MAX:{value:new Oe(R,ot)}}),Fe.__EMPTY_NODE=st.EMPTY_NODE,Xe.__childrenNodeConstructor=st,Be=ot,function(e){Ye=e}(ot);function at(e,t=null){if(null===e)return st.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),(0,s.hu)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new Xe(e,at(t))}if(e instanceof Array){let n=st.EMPTY_NODE;return L(e,((t,i)=>{if((0,s.r3)(e,t)&&"."!==t.substring(0,1)){const e=at(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(at(t))}{const n=[];let i=!1;if(L(e,((e,t)=>{if("."!==e.substring(0,1)){const r=at(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new Oe(e,r)))}})),0===n.length)return st.EMPTY_NODE;const r=et(n,$e,(e=>e.name),Ge);if(i){const e=et(n,Qe.getCompare());return new st(r,at(t),new it({".priority":e},{".priority":Qe}))}return new st(r,at(t),it.Default)}}!function(e){He=e}(at);class ct extends Me{constructor(e){super(),this.indexPath_=e,(0,s.hu)(!Ie(e)&&".priority"!==me(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?P(e.name,t.name):r}makePost(e,t){const n=at(e),i=st.EMPTY_NODE.updateChild(this.indexPath_,n);return new Oe(t,i)}maxPost(){const e=st.EMPTY_NODE.updateChild(this.indexPath_,ot);return new Oe(R,e)}toString(){return we(this.indexPath_,0).join("/")}}const lt=new class extends Me{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?P(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Oe.MIN}maxPost(){return Oe.MAX}makePost(e,t){const n=at(e);return new Oe(t,n)}toString(){return".value"}},ht="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ut=function(){let e=0;const t=[];return function(n){const i=n===e;let r;e=n;const o=new Array(8);for(r=7;r>=0;r--)o[r]=ht.charAt(n%64),n=Math.floor(n/64);(0,s.hu)(0===n,"Cannot push at time == 0");let a=o.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)a+=ht.charAt(t[r]);return(0,s.hu)(20===a.length,"nextPushId: Length should be 20."),a}}();function dt(e){return{type:"value",snapshotNode:e}}function ft(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function pt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function gt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class mt{constructor(e){this.index_=e}updateChild(e,t,n,i,r,o){(0,s.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(pt(t,a)):(0,s.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ft(t,n)):o.trackChildChange(gt(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Qe,((e,i)=>{t.hasChild(e)||n.trackChildChange(pt(e,i))})),t.isLeafNode()||t.forEachChild(Qe,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(gt(t,i,r))}else n.trackChildChange(ft(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?st.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class yt{constructor(e){this.indexedFilter_=new mt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=yt.getStartPost_(e),this.endPost_=yt.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,i,r,s){return this.matches(new Oe(t,n))||(n=st.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=st.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(st.EMPTY_NODE);const r=this;return t.forEachChild(Qe,((e,t)=>{r.matches(new Oe(e,t))||(i=i.updateImmediateChild(e,st.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class _t{constructor(e){this.rangedFilter_=new yt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new Oe(t,n))||(n=st.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=st.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=st.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();let r;if(r=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),t)<=0:this.index_.compare(t,this.rangedFilter_.getEndPost())<=0,!r)break;i=i.updateImmediateChild(t.name,t.node),n++}}else{let e,n,r,s;if(i=t.withIndex(this.index_),i=i.updatePriority(st.EMPTY_NODE),this.reverse_){s=i.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),n=this.rangedFilter_.getStartPost();const t=this.index_.getCompare();r=(e,n)=>t(n,e)}else s=i.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),n=this.rangedFilter_.getEndPost(),r=this.index_.getCompare();let o=0,a=!1;for(;s.hasNext();){const t=s.getNext();!a&&r(e,t)<=0&&(a=!0);a&&o<this.limit_&&r(t,n)<=0?o++:i=i.updateImmediateChild(t.name,st.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;(0,s.hu)(a.numChildren()===this.limit_,"");const c=new Oe(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let s=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=s&&(s.name===t||a.hasChild(s.name));)s=i.getChildAfterChild(this.index_,s,this.reverse_);const u=null==s?1:o(s,c);if(h&&!n.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(gt(t,n,e)),a.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(pt(t,e));const n=a.updateImmediateChild(t,st.EMPTY_NODE);return null!=s&&this.rangedFilter_.matches(s)?(null!=r&&r.trackChildChange(ft(s.name,s.node)),n.updateImmediateChild(s.name,s.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=r&&(r.trackChildChange(pt(l.name,l.node)),r.trackChildChange(ft(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,st.EMPTY_NODE)):e}}class vt{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Qe}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,s.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,s.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:A}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,s.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,s.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:R}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,s.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Qe}copy(){const e=new vt;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function wt(e){const t={};if(e.isDefault())return t;let n;return e.index_===Qe?n="$priority":e.index_===lt?n="$value":e.index_===Ue?n="$key":((0,s.hu)(e.index_ instanceof ct,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=(0,s.Pz)(n),e.startSet_&&(t.startAt=(0,s.Pz)(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+(0,s.Pz)(e.indexStartName_))),e.endSet_&&(t.endAt=(0,s.Pz)(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+(0,s.Pz)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function bt(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Qe&&(t.i=e.index_.toString()),t}class Tt extends ue{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=E("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,s.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Tt.getListenId_(e,n),a={};this.listens_[o]=a;const c=wt(e._queryParams);this.restRequest_(r+".json",c,((e,t)=>{let c=t;if(404===e&&(c=null,e=null),null===e&&this.onDataUpdate_(r,c,!1,n),(0,s.DV)(this.listens_,o)===a){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=Tt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=wt(e._queryParams),n=e._path.toString(),i=new s.BH;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,s.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=(0,s.cI)(a.responseText)}catch(e){S("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&S("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()}))}}class It{constructor(){this.rootNode_=st.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Et(){return{value:null,children:new Map}}function Ct(e,t,n){if(Ie(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=me(t);e.children.has(i)||e.children.set(i,Et());Ct(e.children.get(i),t=_e(t),n)}}function kt(e,t){if(Ie(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Qe,((t,n)=>{Ct(e,new pe(t),n)})),kt(e,t)}}if(e.children.size>0){const n=me(t);if(t=_e(t),e.children.has(n)){kt(e.children.get(n),t)&&e.children.delete(n)}return 0===e.children.size}return!0}function St(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{St(i,new pe(t.toString()+"/"+e),n)}))}class Nt{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&L(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class At{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Nt(e);const n=1e4+2e4*Math.random();G(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;L(e,((e,i)=>{i>0&&(0,s.r3)(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),G(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Rt;function Pt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Rt||(Rt={}));class xt{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Rt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Ie(this.path)){if(null!=this.affectedTree.value)return(0,s.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new pe(e));return new xt(ge(),t,this.revert)}}return(0,s.hu)(me(this.path)===e,"operationForChild called for unrelated child."),new xt(_e(this.path),this.affectedTree,this.revert)}}class Dt{constructor(e,t){this.source=e,this.path=t,this.type=Rt.LISTEN_COMPLETE}operationForChild(e){return Ie(this.path)?new Dt(this.source,ge()):new Dt(this.source,_e(this.path))}}class Ot{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Rt.OVERWRITE}operationForChild(e){return Ie(this.path)?new Ot(this.source,ge(),this.snap.getImmediateChild(e)):new Ot(this.source,_e(this.path),this.snap)}}class Mt{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Rt.MERGE}operationForChild(e){if(Ie(this.path)){const t=this.children.subtree(new pe(e));return t.isEmpty()?null:t.value?new Ot(this.source,ge(),t.value):new Mt(this.source,ge(),t)}return(0,s.hu)(me(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Mt(this.source,_e(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Lt{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ie(e))return this.isFullyInitialized()&&!this.filtered_;const t=me(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ft{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ut(e,t,n,i,r,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw(0,s.g5)("Should only compare child_ events.");const i=new Oe(t.childName,t.snapshotNode),r=new Oe(n.childName,n.snapshotNode);return e.index_.compare(i,r)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function Vt(e,t){return{eventCache:e,serverCache:t}}function qt(e,t,n,i){return Vt(new Lt(t,n,i),e.serverCache)}function jt(e,t,n,i){return Vt(e.eventCache,new Lt(t,n,i))}function $t(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Gt(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Bt;class zt{constructor(e,t=(()=>(Bt||(Bt=new je(x)),Bt))()){this.value=e,this.children=t}static fromObject(e){let t=new zt(null);return L(e,((e,n)=>{t=t.set(new pe(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ge(),value:this.value};if(Ie(e))return null;{const n=me(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(_e(e),t);if(null!=r){return{path:Te(new pe(n),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Ie(e))return this;{const t=me(e),n=this.children.get(t);return null!==n?n.subtree(_e(e)):new zt(null)}}set(e,t){if(Ie(e))return new zt(t,this.children);{const n=me(e),i=(this.children.get(n)||new zt(null)).set(_e(e),t),r=this.children.insert(n,i);return new zt(this.value,r)}}remove(e){if(Ie(e))return this.children.isEmpty()?new zt(null):new zt(null,this.children);{const t=me(e),n=this.children.get(t);if(n){const i=n.remove(_e(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new zt(null):new zt(this.value,r)}return this}}get(e){if(Ie(e))return this.value;{const t=me(e),n=this.children.get(t);return n?n.get(_e(e)):null}}setTree(e,t){if(Ie(e))return t;{const n=me(e),i=(this.children.get(n)||new zt(null)).setTree(_e(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new zt(this.value,r)}}fold(e){return this.fold_(ge(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(Te(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,ge(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Ie(e))return null;{const i=me(e),r=this.children.get(i);return r?r.findOnPath_(_e(e),Te(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ge(),t)}foreachOnPath_(e,t,n){if(Ie(e))return this;{this.value&&n(t,this.value);const i=me(e),r=this.children.get(i);return r?r.foreachOnPath_(_e(e),Te(t,i),n):new zt(null)}}foreach(e){this.foreach_(ge(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(Te(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Kt{constructor(e){this.writeTree_=e}static empty(){return new Kt(new zt(null))}}function Wt(e,t,n){if(Ie(t))return new Kt(new zt(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=Ee(r,t);return s=s.updateChild(o,n),new Kt(e.writeTree_.set(r,s))}{const i=new zt(n),r=e.writeTree_.setTree(t,i);return new Kt(r)}}}function Ht(e,t,n){let i=e;return L(n,((e,n)=>{i=Wt(i,Te(t,e),n)})),i}function Yt(e,t){if(Ie(t))return Kt.empty();{const n=e.writeTree_.setTree(t,new zt(null));return new Kt(n)}}function Xt(e,t){return null!=Qt(e,t)}function Qt(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ee(n.path,t)):null}function Jt(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Qe,((e,n)=>{t.push(new Oe(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Oe(e,n.value))})),t}function Zt(e,t){if(Ie(t))return e;{const n=Qt(e,t);return new Kt(null!=n?new zt(n):e.writeTree_.subtree(t))}}function en(e){return e.writeTree_.isEmpty()}function tn(e,t){return nn(ge(),e.writeTree_,t)}function nn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?((0,s.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):n=nn(Te(e,t),r,n)})),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(Te(e,".priority"),i)),n}}function rn(e,t){return yn(t,e)}function sn(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));(0,s.hu)(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&on(t,i.path)?r=!1:Se(i.path,t.path)&&(o=!0)),a--}if(r){if(o)return function(e){e.visibleWrites=cn(e.allWrites,an,ge()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(i.snap)e.visibleWrites=Yt(e.visibleWrites,i.path);else{L(i.children,(t=>{e.visibleWrites=Yt(e.visibleWrites,Te(i.path,t))}))}return!0}return!1}function on(e,t){if(e.snap)return Se(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Se(Te(e.path,n),t))return!0;return!1}function an(e){return e.visible}function cn(e,t,n){let i=Kt.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)Se(n,e)?(t=Ee(n,e),i=Wt(i,t,o.snap)):Se(e,n)&&(t=Ee(e,n),i=Wt(i,ge(),o.snap.getChild(t)));else{if(!o.children)throw(0,s.g5)("WriteRecord should have .snap or .children");if(Se(n,e))t=Ee(n,e),i=Ht(i,t,o.children);else if(Se(e,n))if(t=Ee(e,n),Ie(t))i=Ht(i,ge(),o.children);else{const e=(0,s.DV)(o.children,me(t));if(e){const n=e.getChild(_e(t));i=Wt(i,ge(),n)}}}}}return i}function ln(e,t,n,i,r){if(i||r){const s=Zt(e.visibleWrites,t);if(!r&&en(s))return n;if(r||null!=n||Xt(s,ge())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(Se(e.path,t)||Se(t,e.path))};return tn(cn(e.allWrites,s,t),n||st.EMPTY_NODE)}return null}{const i=Qt(e.visibleWrites,t);if(null!=i)return i;{const i=Zt(e.visibleWrites,t);if(en(i))return n;if(null!=n||Xt(i,ge())){return tn(i,n||st.EMPTY_NODE)}return null}}}function hn(e,t,n,i){return ln(e.writeTree,e.treePath,t,n,i)}function un(e,t){return function(e,t,n){let i=st.EMPTY_NODE;const r=Qt(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Qe,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=Zt(e.visibleWrites,t);return n.forEachChild(Qe,((e,t)=>{const n=tn(Zt(r,new pe(e)),t);i=i.updateImmediateChild(e,n)})),Jt(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Jt(Zt(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function dn(e,t,n,i){return function(e,t,n,i,r){(0,s.hu)(i||r,"Either existingEventSnap or existingServerSnap must exist");const o=Te(t,n);if(Xt(e.visibleWrites,o))return null;{const t=Zt(e.visibleWrites,o);return en(t)?r.getChild(n):tn(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function fn(e,t){return function(e,t){return Qt(e.visibleWrites,t)}(e.writeTree,Te(e.treePath,t))}function pn(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=Zt(e.visibleWrites,t),l=Qt(c,ge());if(null!=l)a=l;else{if(null==n)return[];a=tn(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}function gn(e,t,n){return function(e,t,n,i){const r=Te(t,n),s=Qt(e.visibleWrites,r);if(null!=s)return s;if(i.isCompleteForChild(n))return tn(Zt(e.visibleWrites,r),i.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function mn(e,t){return yn(Te(e.treePath,t),e.writeTree)}function yn(e,t){return{treePath:e,writeTree:t}}class _n{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;(0,s.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,s.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,gt(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,pt(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,ft(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,s.g5)("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,gt(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const vn=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class wn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Lt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return gn(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Gt(this.viewCache_),r=pn(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function bn(e,t,n,i,r){const o=new _n;let a,c;if(n.type===Rt.OVERWRITE){const l=n;l.source.fromUser?a=En(e,t,l.path,l.snap,i,r,o):((0,s.hu)(l.source.fromServer,"Unknown source."),c=l.source.tagged||t.serverCache.isFiltered()&&!Ie(l.path),a=In(e,t,l.path,l.snap,i,r,c,o))}else if(n.type===Rt.MERGE){const l=n;l.source.fromUser?a=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=Te(n,i);Cn(t,me(l))&&(a=En(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=Te(n,i);Cn(t,me(l))||(a=En(e,a,l,c,r,s,o))})),a}(e,t,l.path,l.children,i,r,o):((0,s.hu)(l.source.fromServer,"Unknown source."),c=l.source.tagged||t.serverCache.isFiltered(),a=Sn(e,t,l.path,l.children,i,r,c,o))}else if(n.type===Rt.ACK_USER_WRITE){const c=n;a=c.revert?function(e,t,n,i,r,o){let a;if(null!=fn(i,n))return t;{const c=new wn(i,t,r),l=t.eventCache.getNode();let h;if(Ie(n)||".priority"===me(n)){let n;if(t.serverCache.isFullyInitialized())n=hn(i,Gt(t));else{const e=t.serverCache.getNode();(0,s.hu)(e instanceof st,"serverChildren would be complete if leaf node"),n=un(i,e)}n=n,h=e.filter.updateFullNode(l,n,o)}else{const r=me(n);let s=gn(i,r,t.serverCache);null==s&&t.serverCache.isCompleteForChild(r)&&(s=l.getImmediateChild(r)),h=null!=s?e.filter.updateChild(l,r,s,_e(n),c,o):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(l,r,st.EMPTY_NODE,_e(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=hn(i,Gt(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=fn(i,ge()),qt(t,h,a,e.filter.filtersNodes())}}(e,t,c.path,i,r,o):function(e,t,n,i,r,s,o){if(null!=fn(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(Ie(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return In(e,t,n,c.getNode().getChild(n),r,s,a,o);if(Ie(n)){let i=new zt(null);return c.getNode().forEachChild(Ue,((e,t)=>{i=i.set(new pe(e),t)})),Sn(e,t,n,i,r,s,a,o)}return t}{let l=new zt(null);return i.foreach(((e,t)=>{const i=Te(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),Sn(e,t,n,l,r,s,a,o)}}(e,t,c.path,c.affectedTree,i,r,o)}else{if(n.type!==Rt.LISTEN_COMPLETE)throw(0,s.g5)("Unknown operation type: "+n.type);a=function(e,t,n,i,r){const s=t.serverCache,o=jt(t,s.getNode(),s.isFullyInitialized()||Ie(n),s.isFiltered());return Tn(e,o,n,i,vn,r)}(e,t,n.path,i,o)}const l=o.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=$t(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(dt($t(t)))}}(t,a,l),{viewCache:a,changes:l}}function Tn(e,t,n,i,r,o){const a=t.eventCache;if(null!=fn(i,n))return t;{let c,l;if(Ie(n))if((0,s.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Gt(t),r=un(i,n instanceof st?n:st.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),r,o)}else{const n=hn(i,Gt(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=me(n);if(".priority"===h){(0,s.hu)(1===ye(n),"Can't have a priority with additional path components");const r=a.getNode();l=t.serverCache.getNode();const o=dn(i,n,r,l);c=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const s=_e(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=dn(i,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(s,e):a.getNode().getImmediateChild(h)}else u=gn(i,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,s,r,o):a.getNode()}}return qt(t,c,a.isFullyInitialized()||Ie(n),e.filter.filtersNodes())}}function In(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(Ie(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=me(n);if(!c.isCompleteForPath(n)&&ye(n)>1)return t;const r=_e(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,vn,null)}const u=jt(t,l,c.isFullyInitialized()||Ie(n),h.filtersNodes());return Tn(e,u,n,r,new wn(r,u,s),a)}function En(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new wn(r,t,s);if(Ie(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=qt(t,l,!0,e.filter.filtersNodes());else{const r=me(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=qt(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=_e(n),l=a.getNode().getImmediateChild(r);let u;if(Ie(s))u=i;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===ve(s)&&e.getChild(be(s)).isEmpty()?e:e.updateChild(s,i):st.EMPTY_NODE}if(l.equals(u))c=t;else{c=qt(t,e.filter.updateChild(a.getNode(),r,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function Cn(e,t){return e.eventCache.isCompleteForChild(t)}function kn(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Sn(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Ie(n)?i:new zt(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=kn(0,t.serverCache.getNode().getImmediateChild(n),i);l=In(e,l,new pe(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&void 0===i.value;if(!h.hasChild(n)&&!c){const c=kn(0,t.serverCache.getNode().getImmediateChild(n),i);l=In(e,l,new pe(n),c,r,s,o,a)}})),l}class Nn{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new mt(n.getIndex()),r=(s=n).loadsAllData()?new mt(s.getIndex()):s.hasLimit()?new _t(s):new yt(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(st.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(st.EMPTY_NODE,a.getNode(),null),h=new Lt(c,o.isFullyInitialized(),i.filtersNodes()),u=new Lt(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Vt(u,h),this.eventGenerator_=new Ft(this.query_)}get query(){return this.query_}}function An(e,t){const n=Gt(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Ie(t)&&!n.getImmediateChild(me(t)).isEmpty())?n.getChild(t):null}function Rn(e){return 0===e.eventRegistrations_.length}function Pn(e,t,n){const i=[];if(n){(0,s.hu)(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,r);t&&i.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function xn(e,t,n,i){t.type===Rt.MERGE&&null!==t.source.queryId&&((0,s.hu)(Gt(e.viewCache_),"We should always have a full cache before handling merges"),(0,s.hu)($t(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,o=bn(e.processor_,r,t,n,i);var a,c;return a=e.processor_,c=o.viewCache,(0,s.hu)(c.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),(0,s.hu)(c.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),(0,s.hu)(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Dn(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Dn(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Ut(e,r,"child_removed",t,i,n),Ut(e,r,"child_added",t,i,n),Ut(e,r,"child_moved",s,i,n),Ut(e,r,"child_changed",t,i,n),Ut(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let On,Mn;class Ln{constructor(){this.views=new Map}}function Fn(e,t,n,i){const r=t.source.queryId;if(null!==r){const o=e.views.get(r);return(0,s.hu)(null!=o,"SyncTree gave us an op for an invalid query."),xn(o,t,n,i)}{let r=[];for(const s of e.views.values())r=r.concat(xn(s,t,n,i));return r}}function Un(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=hn(n,r?i:null),s=!1;e?s=!0:i instanceof st?(e=un(n,i),s=!1):(e=st.EMPTY_NODE,s=!1);const o=Vt(new Lt(e,s,!1),new Lt(i,r,!1));return new Nn(t,o)}return o}function Vn(e,t,n,i,r,s){const o=Un(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Qe,((e,t)=>{i.push(ft(e,t))}));return n.isFullyInitialized()&&i.push(dt(n.getNode())),Dn(e,i,n.getNode(),t)}(o,n)}function qn(e,t,n,i){const r=t._queryIdentifier,o=[];let a=[];const c=zn(e);if("default"===r)for(const[s,l]of e.views.entries())a=a.concat(Pn(l,n,i)),Rn(l)&&(e.views.delete(s),l.query._queryParams.loadsAllData()||o.push(l.query));else{const t=e.views.get(r);t&&(a=a.concat(Pn(t,n,i)),Rn(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!zn(e)&&o.push(new((0,s.hu)(On,"Reference.ts has not been loaded"),On)(t._repo,t._path)),{removed:o,events:a}}function jn(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function $n(e,t){let n=null;for(const i of e.views.values())n=n||An(i,t);return n}function Gn(e,t){if(t._queryParams.loadsAllData())return Kn(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Bn(e,t){return null!=Gn(e,t)}function zn(e){return null!=Kn(e)}function Kn(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Wn=1;class Hn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new zt(null),this.pendingWriteTree_={visibleWrites:Kt.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Yn(e,t,n,i,r){return function(e,t,n,i,r){(0,s.hu)(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:r}),r&&(e.visibleWrites=Wt(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,r),r?ti(e,new Ot({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Xn(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(sn(e.pendingWriteTree_,t)){let t=new zt(null);return null!=i.snap?t=t.set(ge(),!0):L(i.children,(e=>{t=t.set(new pe(e),!0)})),ti(e,new xt(i.path,t,n))}return[]}function Qn(e,t,n){return ti(e,new Ot({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Jn(e,t,n,i){const r=t._path,s=e.syncPointTree_.get(r);let o=[];if(s&&("default"===t._queryIdentifier||Bn(s,t))){const a=qn(s,t,n,i);0===s.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(r));const c=a.removed;o=a.events;const l=-1!==c.findIndex((e=>e._queryParams.loadsAllData())),h=e.syncPointTree_.findOnPath(r,((e,t)=>zn(t)));if(l&&!h){const t=e.syncPointTree_.subtree(r);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&zn(t)){return[Kn(t)]}{let e=[];return t&&(e=jn(t)),L(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=ri(e,i);e.listenProvider_.startListening(hi(r),si(e,r),s.hashFn,s.onComplete)}}}if(!h&&c.length>0&&!i)if(l){const n=null;e.listenProvider_.stopListening(hi(t),n)}else c.forEach((t=>{const n=e.queryToTagMap.get(oi(t));e.listenProvider_.stopListening(hi(t),n)}));!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=oi(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return o}function Zn(e,t,n){const i=t._path;let r=null,o=!1;e.syncPointTree_.foreachOnPath(i,((e,t)=>{const n=Ee(e,i);r=r||$n(t,n),o=o||zn(t)}));let a,c=e.syncPointTree_.get(i);if(c?(o=o||zn(c),r=r||$n(c,ge())):(c=new Ln,e.syncPointTree_=e.syncPointTree_.set(i,c)),null!=r)a=!0;else{a=!1,r=st.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild(((e,t)=>{const n=$n(t,ge());n&&(r=r.updateImmediateChild(e,n))}))}const l=Bn(c,t);if(!l&&!t._queryParams.loadsAllData()){const n=oi(t);(0,s.hu)(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=Wn++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let h=Vn(c,t,n,rn(e.pendingWriteTree_,i),r,a);if(!l&&!o){const n=Gn(c,t);h=h.concat(function(e,t,n){const i=t._path,r=si(e,t),o=ri(e,n),a=e.listenProvider_.startListening(hi(t),r,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(i);if(r)(0,s.hu)(!zn(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!Ie(e)&&t&&zn(t))return[Kn(t).query];{let e=[];return t&&(e=e.concat(jn(t).map((e=>e.query)))),L(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(hi(i),si(e,i))}}return a}(e,t,n))}return h}function ei(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=$n(n,Ee(e,t));if(i)return i}));return ln(i,t,r,n,!0)}function ti(e,t){return ni(t,e.syncPointTree_,null,rn(e.pendingWriteTree_,ge()))}function ni(e,t,n,i){if(Ie(e.path))return ii(e,t,n,i);{const r=t.get(ge());null==n&&null!=r&&(n=$n(r,ge()));let s=[];const o=me(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=mn(i,o);s=s.concat(ni(a,c,e,t))}return r&&(s=s.concat(Fn(r,e,i,n))),s}}function ii(e,t,n,i){const r=t.get(ge());null==n&&null!=r&&(n=$n(r,ge()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=mn(i,t),c=e.operationForChild(t);c&&(s=s.concat(ii(c,r,o,a)))})),r&&(s=s.concat(Fn(r,e,i,n))),s}function ri(e,t){const n=t.query,i=si(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||st.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=ai(e,n);if(i){const n=ci(i),r=n.path,s=n.queryId,o=Ee(r,t);return li(e,r,new Dt(Pt(s),o))}return[]}(e,n._path,i):function(e,t){return ti(e,new Dt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Jn(e,n,null,i)}}}}function si(e,t){const n=oi(t);return e.queryToTagMap.get(n)}function oi(e){return e._path.toString()+"$"+e._queryIdentifier}function ai(e,t){return e.tagToQueryMap.get(t)}function ci(e){const t=e.indexOf("$");return(0,s.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new pe(e.substr(0,t))}}function li(e,t,n){const i=e.syncPointTree_.get(t);(0,s.hu)(i,"Missing sync point for query tag that we're tracking");return Fn(i,n,rn(e.pendingWriteTree_,t),null)}function hi(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,s.hu)(Mn,"Reference.ts has not been loaded"),Mn)(e._repo,e._path):e}class ui{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ui(t)}node(){return this.node_}}class di{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Te(this.path_,e);return new di(this.syncTree_,t)}node(){return ei(this.syncTree_,this.path_)}}const fi=function(e,t,n){return e&&"object"===typeof e?((0,s.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?pi(e[".sv"],t,n):"object"===typeof e[".sv"]?gi(e[".sv"],t):void(0,s.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},pi=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,s.hu)(!1,"Unexpected server value: "+e)},gi=function(e,t,n){e.hasOwnProperty("increment")||(0,s.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!==typeof i&&(0,s.hu)(!1,"Unexpected increment value: "+i);const r=t.node();if((0,s.hu)(null!==r&&"undefined"!==typeof r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return"number"!==typeof o?i:o+i},mi=function(e,t,n,i){return _i(t,new di(n,e),i)},yi=function(e,t,n){return _i(e,new ui(t),n)};function _i(e,t,n){const i=e.getPriority().val(),r=fi(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=fi(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new Xe(s,at(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new Xe(r))),i.forEachChild(Qe,((e,i)=>{const r=_i(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class vi{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function wi(e,t){let n=t instanceof pe?t:new pe(t),i=e,r=me(n);for(;null!==r;){const e=(0,s.DV)(i.node.children,r)||{children:{},childCount:0};i=new vi(r,i,e),n=_e(n),r=me(n)}return i}function bi(e){return e.node.value}function Ti(e,t){e.node.value=t,Si(e)}function Ii(e){return e.node.childCount>0}function Ei(e,t){L(e.node.children,((n,i)=>{t(new vi(n,e,i))}))}function Ci(e,t,n,i){n&&!i&&t(e),Ei(e,(e=>{Ci(e,t,!0,i)})),n&&i&&t(e)}function ki(e){return new pe(null===e.parent?e.name:ki(e.parent)+"/"+e.name)}function Si(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===bi(e)&&!Ii(e)}(n),r=(0,s.r3)(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Si(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Si(e))}(e.parent,e.name,e)}const Ni=/[\[\].#$\/\u0000-\u001F\u007F]/,Ai=/[\[\].#$\u0000-\u001F\u007F]/,Ri=10485760,Pi=function(e){return"string"===typeof e&&0!==e.length&&!Ni.test(e)},xi=function(e){return"string"===typeof e&&0!==e.length&&!Ai.test(e)},Di=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!N(e)||e&&"object"===typeof e&&(0,s.r3)(e,".sv")},Oi=function(e,t,n,i){i&&void 0===t||Mi((0,s.gK)(e,"value"),t,n)},Mi=function(e,t,n){const i=n instanceof pe?new Ne(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Re(i));if("function"===typeof t)throw new Error(e+"contains a function "+Re(i)+" with contents = "+t.toString());if(N(t))throw new Error(e+"contains "+t.toString()+" "+Re(i));if("string"===typeof t&&t.length>Ri/3&&(0,s.ug)(t)>Ri)throw new Error(e+"contains a string greater than "+"10485760 utf8 bytes "+Re(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,r=!1;if(L(t,((t,o)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Pi(t)))throw new Error(e+" contains an invalid key ("+t+") "+Re(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,s.ug)(t),Ae(e)}(i,t),Mi(e,o,i),function(e){const t=e.parts_.pop();e.byteLength_-=(0,s.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Re(i)+" in addition to actual children.")}},Li=function(e,t,n,i){if(i&&void 0===t)return;const r=(0,s.gK)(e,"values");if(!t||"object"!==typeof t||Array.isArray(t))throw new Error(r+" must be an object containing the children to replace.");const o=[];L(t,((e,t)=>{const i=new pe(e);if(Mi(r,t,Te(n,i)),".priority"===ve(i)&&!Di(t))throw new Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(i)})),function(e,t){let n,i;for(n=0;n<t.length;n++){i=t[n];const r=we(i);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Pi(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Ce);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&Se(r,i))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}}(r,o)},Fi=function(e,t,n){if(!n||void 0!==t){if(N(t))throw new Error((0,s.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Di(t))throw new Error((0,s.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ui=function(e,t,n,i){if((!i||void 0!==n)&&!xi(n))throw new Error((0,s.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Vi=function(e,t){if(".info"===me(t))throw new Error(e+" failed = Can't modify data under /.info/")},qi=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!Pi(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),xi(e)}(n))throw new Error((0,s.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ji{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function $i(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||ke(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Gi(e,t,n){$i(e,n),zi(e,(e=>ke(e,t)))}function Bi(e,t,n){$i(e,n),zi(e,(e=>Se(e,t)||Se(t,e)))}function zi(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(Ki(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function Ki(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();w&&I("event: "+n.toString()),$(i)}}}const Wi="repo_interrupt";class Hi{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ji,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Et(),this.transactionQueueTree_=new vi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Yi(e,t,n){if(e.stats_=ne(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Tt(e.repoInfo_,((t,n,i,r)=>{Ji(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Zi(e,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,s.Pz)(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new De(e.repoInfo_,t,((t,n,i,r)=>{Ji(e,t,n,i,r)}),(t=>{Zi(e,t)}),(t=>{!function(e,t){L(t,((t,n)=>{er(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return te[n]||(te[n]=t()),te[n]}(e.repoInfo_,(()=>new At(e.stats_,e.server_))),e.infoData_=new It,e.infoSyncTree_=new Hn({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Qn(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),er(e,"connected",!1),e.serverSyncTree_=new Hn({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);Bi(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Xi(e){const t=e.infoData_.getNode(new pe(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Qi(e){return(t=(t={timestamp:Xi(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Ji(e,t,n,i,r){e.dataUpdateCount++;const o=new pe(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(r)if(i){const t=(0,s.UI)(n,(e=>at(e)));a=function(e,t,n,i){const r=ai(e,i);if(r){const i=ci(r),s=i.path,o=i.queryId,a=Ee(s,t),c=zt.fromObject(n);return li(e,s,new Mt(Pt(o),a,c))}return[]}(e.serverSyncTree_,o,t,r)}else{const t=at(n);a=function(e,t,n,i){const r=ai(e,i);if(null!=r){const i=ci(r),s=i.path,o=i.queryId,a=Ee(s,t);return li(e,s,new Ot(Pt(o),a,n))}return[]}(e.serverSyncTree_,o,t,r)}else if(i){const t=(0,s.UI)(n,(e=>at(e)));a=function(e,t,n){const i=zt.fromObject(n);return ti(e,new Mt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,o,t)}else{const t=at(n);a=Qn(e.serverSyncTree_,o,t)}let c=o;a.length>0&&(c=ur(e,o)),Bi(e.eventQueue_,c,a)}function Zi(e,t){er(e,"connected",t),!1===t&&function(e){ar(e,"onDisconnectEvents");const t=Qi(e),n=Et();St(e.onDisconnect_,ge(),((i,r)=>{const s=mi(i,r,e.serverSyncTree_,t);Ct(n,i,s)}));let i=[];St(n,ge(),((t,n)=>{i=i.concat(Qn(e.serverSyncTree_,t,n));const r=mr(e,t);ur(e,r)})),e.onDisconnect_=Et(),Bi(e.eventQueue_,ge(),i)}(e)}function er(e,t,n){const i=new pe("/.info/"+t),r=at(n);e.infoData_.updateSnapshot(i,r);const s=Qn(e.infoSyncTree_,i,r);Bi(e.eventQueue_,i,s)}function tr(e){return e.nextWriteId_++}function nr(e,t,n,i,r){ar(e,"set",{path:t.toString(),value:n,priority:i});const s=Qi(e),o=at(n,i),a=ei(e.serverSyncTree_,t),c=yi(o,a,s),l=tr(e),h=Yn(e.serverSyncTree_,t,c,l,!0);$i(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const s="ok"===n;s||S("set at "+t+" failed: "+n);const o=Xn(e.serverSyncTree_,l,!s);Bi(e.eventQueue_,t,o),cr(e,r,n,i)}));const u=mr(e,t);ur(e,u),Bi(e.eventQueue_,u,[])}function ir(e,t,n){e.server_.onDisconnectCancel(t.toString(),((i,r)=>{"ok"===i&&kt(e.onDisconnect_,t),cr(e,n,i,r)}))}function rr(e,t,n,i){const r=at(n);e.server_.onDisconnectPut(t.toString(),r.val(!0),((n,s)=>{"ok"===n&&Ct(e.onDisconnect_,t,r),cr(e,i,n,s)}))}function sr(e,t,n){let i;i=".info"===me(t._path)?Jn(e.infoSyncTree_,t,n):Jn(e.serverSyncTree_,t,n),Gi(e.eventQueue_,t._path,i)}function or(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Wi)}function ar(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),I(n,...t)}function cr(e,t,n,i){t&&$((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}function lr(e,t,n){return ei(e.serverSyncTree_,t,n)||st.EMPTY_NODE}function hr(e,t=e.transactionQueueTree_){if(t||gr(e,t),bi(t)){const n=fr(e,t);(0,s.hu)(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const i=n.map((e=>e.currentWriteId)),r=lr(e,t,i);let o=r;const a=r.hash();for(let h=0;h<n.length;h++){const e=n[h];(0,s.hu)(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const i=Ee(t,e.path);o=o.updateChild(i,e.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{ar(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Xn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();gr(e,wi(e.transactionQueueTree_,t)),hr(e,e.transactionQueueTree_),Bi(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)$(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{S("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}ur(e,t)}}),a)}(e,ki(t),n)}else Ii(t)&&Ei(t,(t=>{hr(e,t)}))}function ur(e,t){const n=dr(e,t),i=ki(n);return function(e,t,n){if(0===t.length)return;const i=[];let r=[];const o=t.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<t.length;c++){const l=t[c],h=Ee(n,l.path);let u,d=!1;if((0,s.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0));else{const n=lr(e,l.path,o);l.currentInputSnapshot=n;const i=t[c].update(n.val());if(void 0!==i){Mi("transaction failed: Data returned ",i,l.path);let t=at(i);"object"===typeof i&&null!=i&&(0,s.r3)(i,".priority")||(t=t.updatePriority(n.getPriority()));const a=l.currentWriteId,c=Qi(e),h=yi(t,n,c);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=h,l.currentWriteId=tr(e),o.splice(o.indexOf(a),1),r=r.concat(Yn(e.serverSyncTree_,l.path,h,l.currentWriteId,l.applyLocally)),r=r.concat(Xn(e.serverSyncTree_,a,!0))}else d=!0,u="nodata",r=r.concat(Xn(e.serverSyncTree_,l.currentWriteId,!0))}Bi(e.eventQueue_,n,r),r=[],d&&(t[c].status=2,a=t[c].unwatcher,setTimeout(a,Math.floor(0)),t[c].onComplete&&("nodata"===u?i.push((()=>t[c].onComplete(null,!1,t[c].currentInputSnapshot))):i.push((()=>t[c].onComplete(new Error(u),!1,null)))))}var a;gr(e,e.transactionQueueTree_);for(let s=0;s<i.length;s++)$(i[s]);hr(e,e.transactionQueueTree_)}(e,fr(e,n),i),i}function dr(e,t){let n,i=e.transactionQueueTree_;for(n=me(t);null!==n&&void 0===bi(i);)i=wi(i,n),n=me(t=_e(t));return i}function fr(e,t){const n=[];return pr(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function pr(e,t,n){const i=bi(t);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);Ei(t,(t=>{pr(e,t,n)}))}function gr(e,t){const n=bi(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Ti(t,n.length>0?n:void 0)}Ei(t,(t=>{gr(e,t)}))}function mr(e,t){const n=ki(dr(e,t)),i=wi(e.transactionQueueTree_,t);return function(e,t,n){let i=n?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{yr(e,t)})),yr(e,i),Ci(i,(t=>{yr(e,t)})),n}function yr(e,t){const n=bi(t);if(n){const i=[];let r=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,s.hu)(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):((0,s.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(Xn(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Ti(t,void 0):n.length=o+1,Bi(e.eventQueue_,ki(t),r);for(let e=0;e<i.length;e++)$(i[e])}}const _r=function(e,t){const n=vr(e),i=n.namespace;"firebase.com"===n.domain&&k(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||k("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Q(n.host,n.secure,i,t,r,"",i!==n.subdomain),path:new pe(n.pathString)}},vr=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"===typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(i){}t+="/"+e}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):S(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class wr{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,s.Pz)(this.snapshot.exportVal())}}class br{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Tr{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,s.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Ir{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new s.BH;return ir(this._repo,this._path,e.wrapCallback((()=>{}))),e.promise}remove(){Vi("OnDisconnect.remove",this._path);const e=new s.BH;return rr(this._repo,this._path,null,e.wrapCallback((()=>{}))),e.promise}set(e){Vi("OnDisconnect.set",this._path),Oi("OnDisconnect.set",e,this._path,!1);const t=new s.BH;return rr(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}setWithPriority(e,t){Vi("OnDisconnect.setWithPriority",this._path),Oi("OnDisconnect.setWithPriority",e,this._path,!1),Fi("OnDisconnect.setWithPriority",t,!1);const n=new s.BH;return function(e,t,n,i,r){const s=at(n,i);e.server_.onDisconnectPut(t.toString(),s.val(!0),((n,i)=>{"ok"===n&&Ct(e.onDisconnect_,t,s),cr(0,r,n,i)}))}(this._repo,this._path,e,t,n.wrapCallback((()=>{}))),n.promise}update(e){Vi("OnDisconnect.update",this._path),Li("OnDisconnect.update",e,this._path,!1);const t=new s.BH;return function(e,t,n,i){if((0,s.xb)(n))return I("onDisconnect().update() called with empty data.  Don't do anything."),void cr(0,i,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,((r,s)=>{"ok"===r&&L(n,((n,i)=>{const r=at(i);Ct(e.onDisconnect_,Te(t,n),r)})),cr(0,i,r,s)}))}(this._repo,this._path,e,t.wrapCallback((()=>{}))),t.promise}}class Er{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Ie(this._path)?null:ve(this._path)}get ref(){return new Cr(this._repo,this._path)}get _queryIdentifier(){const e=bt(this._queryParams),t=O(e);return"{}"===t?"default":t}get _queryObject(){return bt(this._queryParams)}isEqual(e){if(!((e=(0,s.m9)(e))instanceof Er))return!1;const t=this._repo===e._repo,n=ke(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Cr extends Er{constructor(e,t){super(e,t,new vt,!1)}get parent(){const e=be(this._path);return null===e?null:new Cr(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class kr{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new pe(e),n=Nr(this.ref,e);return new kr(this._node.getChild(t),n,Qe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new kr(n,Nr(this.ref,t),Qe))))}hasChild(e){const t=new pe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Sr(e,t){return(e=(0,s.m9)(e))._checkNotDeleted("ref"),void 0!==t?Nr(e._root,t):e._root}function Nr(e,t){var n,i,r,o;return null===me((e=(0,s.m9)(e))._path)?(n="child",i="path",o=!1,(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),Ui(n,i,r,o)):Ui("child","path",t,!1),new Cr(e._repo,Te(e._path,t))}function Ar(e){return e=(0,s.m9)(e),new Ir(e._repo,e._path)}function Rr(e,t){e=(0,s.m9)(e),Vi("push",e._path),Oi("push",t,e._path,!0);const n=Xi(e._repo),i=ut(n),r=Nr(e,i),o=Nr(e,i);let a;return a=null!=t?Pr(o,t).then((()=>o)):Promise.resolve(o),r.then=a.then.bind(a),r.catch=a.then.bind(a,void 0),r}function Pr(e,t){e=(0,s.m9)(e),Vi("set",e._path),Oi("set",t,e._path,!1);const n=new s.BH;return nr(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class xr{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new wr("value",this,new kr(e.snapshotNode,new Cr(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new br(this,e,t):null}matches(e){return e instanceof xr&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Dr{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new br(this,e,t):null}createEvent(e,t){(0,s.hu)(null!=e.childName,"Child events should have a childName.");const n=Nr(new Cr(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new wr(e.type,this,new kr(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Dr&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Or(e,t,n,i,r){let s;if("object"===typeof i&&(s=void 0,r=i),"function"===typeof i&&(s=i),r&&r.onlyOnce){const t=n,i=(n,i)=>{sr(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new Tr(n,s||void 0),a="value"===t?new xr(o):new Dr(t,o);return function(e,t,n){let i;i=".info"===me(t._path)?Zn(e.infoSyncTree_,t,n):Zn(e.serverSyncTree_,t,n),Gi(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>sr(e._repo,e,a)}function Mr(e,t,n,i){return Or(e,"value",t,n,i)}!function(e){(0,s.hu)(!On,"__referenceConstructor has already been defined"),On=e}(Cr),function(e){(0,s.hu)(!Mn,"__referenceConstructor has already been defined"),Mn=e}(Cr);const Lr={};let Fr=!1;function Ur(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||k("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),I("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,c,l=_r(s,r),h=l.repoInfo;"undefined"!==typeof a&&(c=a.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(o=!0,s=`http://${c}?ns=${h.namespace}`,l=_r(s,r),h=l.repoInfo):o=!l.repoInfo.secure;const u=r&&o?new K(K.OWNER):new z(e.name,e.options,t);qi("Invalid Firebase Database URL",l),Ie(l.path)||k("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,i){let r=Lr[t.name];r||(r={},Lr[t.name]=r);let s=r[e.toURLString()];s&&k("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Hi(e,Fr,n,i),r[e.toURLString()]=s,s}(h,e,u,new B(e.name,n));return new Vr(d,e)}class Vr{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Yi(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Cr(this._repo,ge())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=Lr[t];n&&n[e.key]===e||k(`Database ${t}(${e.repoInfo_}) has already been deleted.`),or(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&k("Cannot call "+e+" on a deleted database.")}}function qr(e=(0,i.Mq)(),t){return(0,i.qX)(e,"database").getImmediate({identifier:t})}De.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},De.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var jr;!function(e){h=e}(i.Jn),(0,i.Xd)(new r.wA("database",((e,{instanceIdentifier:t})=>Ur(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),(0,i.KN)(c,l,jr),(0,i.KN)(c,l,"esm2017")},6257:function(e,t,n){"use strict";n.d(t,{JU:function(){return i.JU},ad:function(){return i.ad},cf:function(){return i.cf},pl:function(){return i.pl},r7:function(){return i.r7}});var i=n(1294)},8676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function i(e,t,i){var r,s=new Promise((function(s,o){n(r=e[t].apply(e,i)).then(s,o)}));return s.request=r,s}function r(e,t,n){var r=i(e,t,n);return r.then((function(e){if(e)return new h(e,r.request)}))}function s(e,t,n){n.forEach((function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}))}function o(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})}))}function a(e,t,n,i){i.forEach((function(i){i in n.prototype&&(e.prototype[i]=function(){return this[t][i].apply(this[t],arguments)})}))}function c(e,t,n,i){i.forEach((function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})}))}function l(e){this._index=e}function h(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise((function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}}))}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function p(e){this._db=e}function g(e,t,n){var r=i(indexedDB,"open",[e,t]),s=r.request;return s&&(s.onupgradeneeded=function(e){n&&n(new f(s.result,e.oldVersion,s.transaction))}),r.then((function(e){return new p(e)}))}function m(e){return i(indexedDB,"deleteDatabase",[e])}s(l,"_index",["name","keyPath","multiEntry","unique"]),o(l,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(l,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(h,"_cursor",["direction","key","primaryKey","value"]),o(h,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(h.prototype[e]=function(){var t=this,i=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,i),n(t._request).then((function(e){if(e)return new h(e,t._request)}))}))})})),u.prototype.createIndex=function(){return new l(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new l(this._store.index.apply(this._store,arguments))},s(u,"_store",["name","keyPath","indexNames","autoIncrement"]),o(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(u,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[u,l].forEach((function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),i=n[n.length-1],r=this._store||this._index,s=r[e].apply(r,n.slice(0,-1));s.onsuccess=function(){i(s.result)}})}))})),[l,u].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,i=[];return new Promise((function(r){n.iterateCursor(e,(function(e){e?(i.push(e.value),void 0===t||i.length!=t?e.continue():r(i)):r(i)}))}))})})),e.openDb=g,e.deleteDb=m,Object.defineProperty(e,"__esModule",{value:!0})}(t)},3454:function(e,t,n){"use strict";var i,r;e.exports=(null===(i=n.g.process)||void 0===i?void 0:i.env)&&"object"===typeof(null===(r=n.g.process)||void 0===r?void 0:r.env)?n.g.process:n(7663)},6363:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(8425)}])},9435:function(e,t,n){"use strict";n.d(t,{I8:function(){return Qe},db:function(){return Xe},WW:function(){return Je}});var i=n(2238),r=n(3333),s=n(4444),o=n(8463),a=n(8676);const c="@firebase/installations",l="0.5.5",h=1e4,u="w:0.5.5",d="FIS_v2",f=36e5,p={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},g=new s.LL("installations","Installations",p);function m(e){return e instanceof s.ZR&&e.code.includes("request-failed")}function y({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function _(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function v(e,t){const n=(await t.json()).error;return g.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function w({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function b(e,{refreshToken:t}){const n=w(e);return n.append("Authorization",function(e){return`FIS_v2 ${e}`}(t)),n}async function T(e){const t=await e();return t.status>=500&&t.status<600?e():t}function I(e){return new Promise((t=>{setTimeout(t,e)}))}const E=/^[cdef][\w-]{21}$/;function C(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}(e);return E.test(t)?t:""}catch(e){return""}}function k(e){return`${e.appName}!${e.appId}`}const S=new Map;function N(e,t){const n=k(e);A(n,t),function(e,t){const n=P();n&&n.postMessage({key:e,fid:t});x()}(n,t)}function A(e,t){const n=S.get(e);if(n)for(const i of n)i(t)}let R=null;function P(){return!R&&"BroadcastChannel"in self&&(R=new BroadcastChannel("[Firebase] FID Change"),R.onmessage=e=>{A(e.data.key,e.data.fid)}),R}function x(){0===S.size&&R&&(R.close(),R=null)}const D="firebase-installations-store";let O=null;function M(){return O||(O=(0,a.openDb)("firebase-installations-database",1,(e=>{if(0===e.oldVersion)e.createObjectStore(D)}))),O}async function L(e,t){const n=k(e),i=(await M()).transaction(D,"readwrite"),r=i.objectStore(D),s=await r.get(n);return await r.put(t,n),await i.complete,s&&s.fid===t.fid||N(e,t.fid),t}async function F(e){const t=k(e),n=(await M()).transaction(D,"readwrite");await n.objectStore(D).delete(t),await n.complete}async function U(e,t){const n=k(e),i=(await M()).transaction(D,"readwrite"),r=i.objectStore(D),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.complete,!o||s&&s.fid===o.fid||N(e,o.fid),o}async function V(e){let t;const n=await U(e,(n=>{const i=function(e){return $(e||{fid:C(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(g.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function(e,{fid:t}){const n=y(e),i=w(e),r={fid:t,authVersion:d,appId:e.appId,sdkVersion:u},s={method:"POST",headers:i,body:JSON.stringify(r)},o=await T((()=>fetch(n,s)));if(o.ok){const e=await o.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:_(e.authToken)}}throw await v("Create Installation",o)}(e,t);return L(e,n)}catch(n){throw m(n)&&409===n.customData.serverCode?await F(e):await L(e,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:q(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function q(e){let t=await j(e);for(;1===t.registrationStatus;)await I(100),t=await j(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await V(e);return n||t}return t}function j(e){return U(e,(e=>{if(!e)throw g.create("installation-not-found");return $(e)}))}function $(e){return 1===(t=e).registrationStatus&&t.registrationTime+h<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function G({appConfig:e,platformLoggerProvider:t},n){const i=function(e,{fid:t}){return`${y(e)}/${t}/authTokens:generate`}(e,n),r=b(e,n),s=t.getImmediate({optional:!0});s&&r.append("x-firebase-client",s.getPlatformInfoString());const o={installation:{sdkVersion:u}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await T((()=>fetch(i,a)));if(c.ok){return _(await c.json())}throw await v("Generate Auth Token",c)}async function B(e,t=!1){let n;const i=await U(e.appConfig,(i=>{if(!K(i))throw g.create("not-registered");const r=i.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+f}(e)}(r))return i;if(1===r.requestStatus)return n=async function(e,t){let n=await z(e.appConfig);for(;1===n.authToken.requestStatus;)await I(100),n=await z(e.appConfig);const i=n.authToken;return 0===i.requestStatus?B(e,t):i}(e,t),i;{if(!navigator.onLine)throw g.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await G(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await L(e.appConfig,i),n}catch(n){if(!m(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await L(e.appConfig,n)}else await F(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function z(e){return U(e,(e=>{if(!K(e))throw g.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+h<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n}))}function K(e){return void 0!==e&&2===e.registrationStatus}async function W(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await V(e);t&&await t}(n.appConfig);return(await B(n,t)).token}function H(e){return g.create("missing-app-config-values",{valueName:e})}const Y="installations",X=e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw H("App Configuration");if(!e.name)throw H("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw H(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,platformLoggerProvider:(0,i.qX)(t,"platform-logger"),_delete:()=>Promise.resolve()}},Q=e=>{const t=e.getProvider("app").getImmediate(),n=(0,i.qX)(t,Y).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await V(t.appConfig);return i?i.catch(console.error):B(t).catch(console.error),n.fid}(n),getToken:e=>W(n,e)}};(0,i.Xd)(new o.wA(Y,X,"PUBLIC")),(0,i.Xd)(new o.wA("installations-internal",Q,"PRIVATE")),(0,i.KN)(c,l),(0,i.KN)(c,l,"esm2017");const J="analytics",Z="https://www.googletagmanager.com/gtag/js",ee=new r.Yd("@firebase/analytics");function te(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}function ne(e,t,n,i){return async function(r,s,o){try{"event"===r?await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await te(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(s){ee.error(s)}}(e,t,n,s,o):"config"===r?await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await te(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(a){ee.error(a)}e("config",r,s)}(e,t,n,i,s,o):e("set",s)}catch(a){ee.error(a)}}}const ie={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},re=new s.LL("analytics","Analytics",ie);const se=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function oe(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ae(e,t=se,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw re.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw re.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new le;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),ce({appId:i,apiKey:r,measurementId:s},o,a,t)}async function ce(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=se){const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(re.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(c){if(a)return ee.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c.message}]`),{appId:o,measurementId:a};throw c}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:oe(i)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(a){}throw re.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(c){if(!function(e){if(!(e instanceof s.ZR)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return ee.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c.message}]`),{appId:o,measurementId:a};throw c}const t=503===Number(c.customData.httpStatus)?(0,s.$s)(n,r.intervalMillis,30):(0,s.$s)(n,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return r.setThrottleMetadata(o,l),ee.debug(`Calling attemptFetch again in ${t} millis`),ce(e,l,i,r)}}class le{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}async function he(e,t,n,i,r,o,a){var c;const l=ae(e);l.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ee.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>ee.error(e))),t.push(l);const h=async function(){if(!(0,s.hl)())return ee.warn(re.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,s.eu)()}catch(e){return ee.warn(re.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[u,d]=await Promise.all([l,h]);(function(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Z))return t;return null})()||function(e,t){const n=document.createElement("script");n.src=`${Z}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(o,u.measurementId),r("js",new Date);const f=null!==(c=null===a||void 0===a?void 0:a.config)&&void 0!==c?c:{};return f.origin="firebase",f.update=!0,null!=d&&(f.firebase_id=d),r("config",u.measurementId,f),u.measurementId}class ue{constructor(e){this.app=e}_delete(){return delete de[this.app.options.appId],Promise.resolve()}}let de={},fe=[];const pe={};let ge,me,ye="dataLayer",_e="gtag",ve=!1;function we(e,t,n){!function(){const e=[];if((0,s.ru)()&&e.push("This is a browser extension environment."),(0,s.zI)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=re.create("invalid-analytics-context",{errorInfo:t});ee.warn(n.message)}}();const i=e.options.appId;if(!i)throw re.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw re.create("no-api-key");ee.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=de[i])throw re.create("already-exists",{id:i});if(!ve){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(ye);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"===typeof window[r]&&(s=window[r]),window[r]=ne(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(de,fe,pe,ye,_e);me=e,ge=t,ve=!0}de[i]=he(e,fe,pe,t,ge,ye,n);return new ue(e)}function be(e,t,n,i){e=(0,s.m9)(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(me,de[e.app.options.appId],t,n,i).catch((e=>ee.error(e)))}const Te="@firebase/analytics",Ie="0.7.5";(0,i.Xd)(new o.wA(J,((e,{options:t})=>we(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),(0,i.Xd)(new o.wA("analytics-internal",(function(e){try{const t=e.getProvider(J).getImmediate();return{logEvent:(e,n,i)=>be(t,e,n,i)}}catch(t){throw re.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),(0,i.KN)(Te,Ie),(0,i.KN)(Te,Ie,"esm2017");(0,i.KN)("firebase","9.6.8","app");var Ee=n(6159),Ce=n(6256),ke=n(6257);const Se="firebasestorage.googleapis.com";class Ne extends s.ZR{constructor(e,t){super(Ae(e),`Firebase Storage: ${t} (${Ae(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ne.prototype)}_codeEquals(e){return Ae(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Ae(e){return"storage/"+e}function Re(){return new Ne("unknown","An unknown error occurred, please check the error payload for server response.")}function Pe(){return new Ne("canceled","User canceled the upload/download.")}function xe(e){return new Ne("invalid-argument",e)}function De(){return new Ne("app-deleted","The Firebase app was deleted.")}class Oe{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Oe.makeFromUrl(e,t)}catch(i){return new Oe(e,"")}if(""===n.path)return n;throw new Ne("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Se?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let c=0;c<a.length;c++){const t=a[c],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let r=i[t.indices.path];r||(r=""),n=new Oe(e,r),t.postModify(n);break}}if(null==n)throw function(e){return new Ne("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class Me{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Le(e,t,n,i){if(i<t)throw xe(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw xe(`Invalid value for '${e}'. Expected ${n} or less.`)}function Fe(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}var Ue;!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Ue||(Ue={}));class Ve{constructor(e,t,n,i,r,s,o,a,c,l,h){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new qe(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===Ue.NO_ERROR,r=n.getStatus();if(!t||this.isRetryStatusCode_(r)){const t=n.getErrorCode()===Ue.ABORT;return void e(!1,new qe(!1,null,t))}const s=-1!==this.successCodes_.indexOf(r);e(!0,new qe(s,n))}))},t=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?n(e):n()}catch(s){i(s)}else if(null!==r){const e=Re();e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else if(t.canceled){i(this.appDelete_?De():Pe())}else{i(new Ne("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new qe(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){r=setTimeout((()=>{r=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(l)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),u(n)}let p=!1;function g(e){p||(p=!0,d(),l||(null!==r?(e||(a=2),clearTimeout(r),u(0)):e||(a=1)))}return u(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||i}}class qe{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function je(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}class $e{constructor(e,t){this._service=e,this._location=t instanceof Oe?t:Oe.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new $e(e,t)}get root(){const e=new Oe(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return je(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Oe(this._location.bucket,e);return new $e(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Ne("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Ge(e,t){const n=null===t||void 0===t?void 0:t.storageBucket;return null==n?null:Oe.makeFromBucketSpec(n,e)}class Be{constructor(e,t,n,i,r){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=Se,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Oe.makeFromBucketSpec(i,this._host):Ge(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Oe.makeFromBucketSpec(this._url,e):this._bucket=Ge(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Le("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Le("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new $e(this,e)}_makeRequest(e,t,n,i){if(this._deleted)return new Me(De());{const r=function(e,t,n,i,r,s){const o=Fe(e.urlParams),a=e.url+o,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,i),new Ve(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r)}(e,this._appId,n,i,t,this._firebaseVersion);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const ze="@firebase/storage",Ke="0.9.2",We="storage";function He(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new Be(n,r,s,t,i.Jn)}var Ye;(0,i.Xd)(new o.wA(We,He,"PUBLIC").setMultipleInstances(!0)),(0,i.KN)(ze,Ke,""),(0,i.KN)(ze,Ke,"esm2017");(null===(Ye=(0,i.C6)())||void 0===Ye?void 0:Ye.length)||((0,i.ZF)({apiKey:"AIzaSyCc478GVD0tcVcw8kpWS1E3nwEDGXE_5bg",authDomain:"lofi-c845f.firebaseapp.com",databaseURL:"https://lofi-c845f-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"lofi-c845f",storageBucket:"lofi-c845f.appspot.com",messagingSenderId:"25098880734",appId:"1:25098880734:web:7dc6442522b7fe37aa644f",measurementId:"G-WGFZEC7GNN"}),function(e=(0,i.Mq)()){e=(0,s.m9)(e);const t=(0,i.qX)(e,J);t.isInitialized()?t.getImmediate():function(e,t={}){const n=(0,i.qX)(e,J);if(n.isInitialized()){const e=n.getImmediate();if((0,s.vZ)(t,n.getOptions()))return e;throw re.create("already-initialized")}n.initialize({options:t})}(e)}());var Xe=(0,ke.ad)(),Qe=(function(e=(0,i.Mq)(),t){e=(0,s.m9)(e),(0,i.qX)(e,We).getImmediate({identifier:t})}(),(0,Ee.v0)()),Je=(0,Ce.N8)()},6622:function(e,t,n){"use strict";n.d(t,{T:function(){return i}});var i={title:"\u3082\u304f\u3082\u304f\u90e8\u5c4b\u03b2",description:"\u4ed5\u4e8b\u3084\u52c9\u5f37\u306b\u3082\u304f\u3082\u304f\u3068\u53d6\u308a\u7d44\u3080\u90e8\u5c4b",origin:"https://dninomiya.github.io/lofi"}},8425:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var i=n(5893),r=n(8386),s=(n(906),n(5690)),o=n(9008),a=n(7294);const c={templateTitle:"",noindex:!1,nofollow:!1,defaultOpenGraphImageWidth:0,defaultOpenGraphImageHeight:0,defaultOpenGraphVideoWidth:0,defaultOpenGraphVideoHeight:0},l=(e,t=[],{defaultWidth:n,defaultHeight:i}={})=>t.reduce(((t,r,s)=>(t.push(a.createElement("meta",{key:`og:${e}:0${s}`,property:`og:${e}`,content:r.url})),r.alt&&t.push(a.createElement("meta",{key:`og:${e}:alt0${s}`,property:`og:${e}:alt`,content:r.alt})),r.secureUrl&&t.push(a.createElement("meta",{key:`og:${e}:secure_url0${s}`,property:`og:${e}:secure_url`,content:r.secureUrl.toString()})),r.type&&t.push(a.createElement("meta",{key:`og:${e}:type0${s}`,property:`og:${e}:type`,content:r.type.toString()})),r.width?t.push(a.createElement("meta",{key:`og:${e}:width0${s}`,property:`og:${e}:width`,content:r.width.toString()})):n&&t.push(a.createElement("meta",{key:`og:${e}:width0${s}`,property:`og:${e}:width`,content:n.toString()})),r.height?t.push(a.createElement("meta",{key:`og:${e}:height${s}`,property:`og:${e}:height`,content:r.height.toString()})):i&&t.push(a.createElement("meta",{key:`og:${e}:height${s}`,property:`og:${e}:height`,content:i.toString()})),t)),[]),h=e=>{const t=[];e.titleTemplate&&(c.templateTitle=e.titleTemplate);let n="";e.title?(n=e.title,c.templateTitle&&(n=c.templateTitle.replace(/%s/g,(()=>n)))):e.defaultTitle&&(n=e.defaultTitle),n&&t.push(a.createElement("title",{key:"title"},n));const i=e.noindex||c.noindex||e.dangerouslySetAllPagesToNoIndex,r=e.nofollow||c.nofollow||e.dangerouslySetAllPagesToNoFollow;let s="";if(e.robotsProps){const{nosnippet:t,maxSnippet:n,maxImagePreview:i,maxVideoPreview:r,noarchive:o,noimageindex:a,notranslate:c,unavailableAfter:l}=e.robotsProps;s=`${t?",nosnippet":""}${n?`,max-snippet:${n}`:""}${i?`,max-image-preview:${i}`:""}${o?",noarchive":""}${l?`,unavailable_after:${l}`:""}${a?",noimageindex":""}${r?`,max-video-preview:${r}`:""}${c?",notranslate":""}`}if(i||r?(e.dangerouslySetAllPagesToNoIndex&&(c.noindex=!0),e.dangerouslySetAllPagesToNoFollow&&(c.nofollow=!0),t.push(a.createElement("meta",{key:"robots",name:"robots",content:`${i?"noindex":"index"},${r?"nofollow":"follow"}${s}`}))):t.push(a.createElement("meta",{key:"robots",name:"robots",content:`index,follow${s}`})),e.description&&t.push(a.createElement("meta",{key:"description",name:"description",content:e.description})),e.mobileAlternate&&t.push(a.createElement("link",{rel:"alternate",key:"mobileAlternate",media:e.mobileAlternate.media,href:e.mobileAlternate.href})),e.languageAlternates&&e.languageAlternates.length>0&&e.languageAlternates.forEach((e=>{t.push(a.createElement("link",{rel:"alternate",key:`languageAlternate-${e.hrefLang}`,hrefLang:e.hrefLang,href:e.href}))})),e.twitter&&(e.twitter.cardType&&t.push(a.createElement("meta",{key:"twitter:card",name:"twitter:card",content:e.twitter.cardType})),e.twitter.site&&t.push(a.createElement("meta",{key:"twitter:site",name:"twitter:site",content:e.twitter.site})),e.twitter.handle&&t.push(a.createElement("meta",{key:"twitter:creator",name:"twitter:creator",content:e.twitter.handle}))),e.facebook&&e.facebook.appId&&t.push(a.createElement("meta",{key:"fb:app_id",property:"fb:app_id",content:e.facebook.appId})),(e.openGraph?.title||n)&&t.push(a.createElement("meta",{key:"og:title",property:"og:title",content:e.openGraph?.title||n})),(e.openGraph?.description||e.description)&&t.push(a.createElement("meta",{key:"og:description",property:"og:description",content:e.openGraph?.description||e.description})),e.openGraph){if((e.openGraph.url||e.canonical)&&t.push(a.createElement("meta",{key:"og:url",property:"og:url",content:e.openGraph.url||e.canonical})),e.openGraph.type){const n=e.openGraph.type.toLowerCase();t.push(a.createElement("meta",{key:"og:type",property:"og:type",content:n})),"profile"===n&&e.openGraph.profile?(e.openGraph.profile.firstName&&t.push(a.createElement("meta",{key:"profile:first_name",property:"profile:first_name",content:e.openGraph.profile.firstName})),e.openGraph.profile.lastName&&t.push(a.createElement("meta",{key:"profile:last_name",property:"profile:last_name",content:e.openGraph.profile.lastName})),e.openGraph.profile.username&&t.push(a.createElement("meta",{key:"profile:username",property:"profile:username",content:e.openGraph.profile.username})),e.openGraph.profile.gender&&t.push(a.createElement("meta",{key:"profile:gender",property:"profile:gender",content:e.openGraph.profile.gender}))):"book"===n&&e.openGraph.book?(e.openGraph.book.authors&&e.openGraph.book.authors.length&&e.openGraph.book.authors.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`book:author:0${n}`,property:"book:author",content:e}))})),e.openGraph.book.isbn&&t.push(a.createElement("meta",{key:"book:isbn",property:"book:isbn",content:e.openGraph.book.isbn})),e.openGraph.book.releaseDate&&t.push(a.createElement("meta",{key:"book:release_date",property:"book:release_date",content:e.openGraph.book.releaseDate})),e.openGraph.book.tags&&e.openGraph.book.tags.length&&e.openGraph.book.tags.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`book:tag:0${n}`,property:"book:tag",content:e}))}))):"article"===n&&e.openGraph.article?(e.openGraph.article.publishedTime&&t.push(a.createElement("meta",{key:"article:published_time",property:"article:published_time",content:e.openGraph.article.publishedTime})),e.openGraph.article.modifiedTime&&t.push(a.createElement("meta",{key:"article:modified_time",property:"article:modified_time",content:e.openGraph.article.modifiedTime})),e.openGraph.article.expirationTime&&t.push(a.createElement("meta",{key:"article:expiration_time",property:"article:expiration_time",content:e.openGraph.article.expirationTime})),e.openGraph.article.authors&&e.openGraph.article.authors.length&&e.openGraph.article.authors.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`article:author:0${n}`,property:"article:author",content:e}))})),e.openGraph.article.section&&t.push(a.createElement("meta",{key:"article:section",property:"article:section",content:e.openGraph.article.section})),e.openGraph.article.tags&&e.openGraph.article.tags.length&&e.openGraph.article.tags.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`article:tag:0${n}`,property:"article:tag",content:e}))}))):"video.movie"!==n&&"video.episode"!==n&&"video.tv_show"!==n&&"video.other"!==n||!e.openGraph.video||(e.openGraph.video.actors&&e.openGraph.video.actors.length&&e.openGraph.video.actors.forEach(((e,n)=>{e.profile&&t.push(a.createElement("meta",{key:`video:actor:0${n}`,property:"video:actor",content:e.profile})),e.role&&t.push(a.createElement("meta",{key:`video:actor:role:0${n}`,property:"video:actor:role",content:e.role}))})),e.openGraph.video.directors&&e.openGraph.video.directors.length&&e.openGraph.video.directors.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`video:director:0${n}`,property:"video:director",content:e}))})),e.openGraph.video.writers&&e.openGraph.video.writers.length&&e.openGraph.video.writers.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`video:writer:0${n}`,property:"video:writer",content:e}))})),e.openGraph.video.duration&&t.push(a.createElement("meta",{key:"video:duration",property:"video:duration",content:e.openGraph.video.duration.toString()})),e.openGraph.video.releaseDate&&t.push(a.createElement("meta",{key:"video:release_date",property:"video:release_date",content:e.openGraph.video.releaseDate})),e.openGraph.video.tags&&e.openGraph.video.tags.length&&e.openGraph.video.tags.forEach(((e,n)=>{t.push(a.createElement("meta",{key:`video:tag:0${n}`,property:"video:tag",content:e}))})),e.openGraph.video.series&&t.push(a.createElement("meta",{key:"video:series",property:"video:series",content:e.openGraph.video.series})))}e.defaultOpenGraphImageWidth&&(c.defaultOpenGraphImageWidth=e.defaultOpenGraphImageWidth),e.defaultOpenGraphImageHeight&&(c.defaultOpenGraphImageHeight=e.defaultOpenGraphImageHeight),e.openGraph.images&&e.openGraph.images.length&&t.push(...l("image",e.openGraph.images,{defaultWidth:c.defaultOpenGraphImageWidth,defaultHeight:c.defaultOpenGraphImageHeight})),e.defaultOpenGraphVideoWidth&&(c.defaultOpenGraphVideoWidth=e.defaultOpenGraphVideoWidth),e.defaultOpenGraphVideoHeight&&(c.defaultOpenGraphVideoHeight=e.defaultOpenGraphVideoHeight),e.openGraph.videos&&e.openGraph.videos.length&&t.push(...l("video",e.openGraph.videos,{defaultWidth:c.defaultOpenGraphVideoWidth,defaultHeight:c.defaultOpenGraphVideoHeight})),e.openGraph.locale&&t.push(a.createElement("meta",{key:"og:locale",property:"og:locale",content:e.openGraph.locale})),e.openGraph.site_name&&t.push(a.createElement("meta",{key:"og:site_name",property:"og:site_name",content:e.openGraph.site_name}))}return e.canonical&&t.push(a.createElement("link",{rel:"canonical",href:e.canonical,key:"canonical"})),e.additionalMetaTags&&e.additionalMetaTags.length>0&&e.additionalMetaTags.forEach((e=>{t.push(a.createElement("meta",{key:`meta:${e.keyOverride??e.name??e.property??e.httpEquiv}`,...e}))})),e.additionalLinkTags?.length&&e.additionalLinkTags.forEach((e=>{t.push(a.createElement("link",{key:`link${e.keyOverride??e.href}${e.rel}`,...e}))})),t};class u extends a.Component{render(){const{title:e,titleTemplate:t,defaultTitle:n,dangerouslySetAllPagesToNoIndex:i=!1,dangerouslySetAllPagesToNoFollow:r=!1,description:s,canonical:c,facebook:l,openGraph:u,additionalMetaTags:d,twitter:f,defaultOpenGraphImageWidth:p,defaultOpenGraphImageHeight:g,defaultOpenGraphVideoWidth:m,defaultOpenGraphVideoHeight:y,mobileAlternate:_,languageAlternates:v,additionalLinkTags:w,robotsProps:b}=this.props;return a.createElement(o.default,null,h({title:e,titleTemplate:t,defaultTitle:n,dangerouslySetAllPagesToNoIndex:i,dangerouslySetAllPagesToNoFollow:r,description:s,canonical:c,facebook:l,openGraph:u,additionalMetaTags:d,twitter:f,defaultOpenGraphImageWidth:p,defaultOpenGraphImageHeight:g,defaultOpenGraphVideoWidth:m,defaultOpenGraphVideoHeight:y,mobileAlternate:_,languageAlternates:v,additionalLinkTags:w,robotsProps:b}))}}var d=n(6622);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){f(e,t,n[t])}))}return e}var g=function(e){var t=e.Component,n=e.pageProps;return(0,i.jsxs)("div",{className:"bg-black min-h-screen text-white",children:[(0,i.jsx)(u,{titleTemplate:"%s | ".concat(d.T.title),twitter:{cardType:"summary_large_image"},description:d.T.description,openGraph:{type:"website",images:[{url:"".concat(d.T.origin,"/images/ogp.png")}]},defaultTitle:d.T.title}),(0,i.jsx)(r.H,{children:(0,i.jsx)(t,p({},n))}),(0,i.jsx)(s.x7,{})]})}},8386:function(e,t,n){"use strict";n.d(t,{H:function(){return p},a:function(){return g}});var i=n(4051),r=n.n(i),s=n(5893),o=n(6159),a=n(1294),c=n(6256),l=n(7294),h=n(9435),u=n(162);function d(e,t,n,i,r,s,o){try{var a=e[s](o),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(i,r)}var f=(0,l.createContext)(void 0),p=function(e){var t=e.children,n=(0,l.useState)(void 0),i=n[0],p=n[1],g=function(e){var t=(0,c.iH)(h.WW,"connectedUsers/".concat(e)),n=(0,c.iH)(h.WW,".info/connected");(0,c.jM)(n,(function(e){if(!0===e.val()){var n=(0,c.VF)(t);(0,c.ae)(n).remove(),(0,c.t8)(n,!0)}}))};return(0,l.useEffect)((function(){var e;return(0,o.Aj)(h.I8,(function(t){if(null===e||void 0===e||e(),t){var n=(0,a.JU)(h.db,"users/".concat(t.uid));e=(0,a.cf)(n,function(){var e,n=(e=r().mark((function e(n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.exists()){e.next=4;break}p(n.data()),e.next=6;break;case 4:return e.next=6,(0,u.r4)(t.uid);case 6:g(t.uid);case 7:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,r){var s=e.apply(t,n);function o(e){d(s,i,r,o,a,"next",e)}function a(e){d(s,i,r,o,a,"throw",e)}o(void 0)}))});return function(e){return n.apply(this,arguments)}}())}else p(null)}))}),[]),(0,l.useEffect)((function(){i&&!i.online&&(0,u.Nq)(i.id,{online:!0,startAt:Date.now()})}),[i]),(0,s.jsx)(f.Provider,{value:i,children:t})},g=function(){return(0,l.useContext)(f)}},162:function(e,t,n){"use strict";n.d(t,{r4:function(){return s},Nq:function(){return o}});var i=n(6257),r=n(9435),s=function(e){var t=(0,i.JU)(r.db,"users/".concat(e));return(0,i.pl)(t,{id:e,name:"noname",createdAt:Date.now(),lastLoggedInAt:Date.now(),lv:1,tomato:0,emoji:"bust_in_silhouette emoji",online:!1,totalWorkTime:0,keepDays:1})},o=function(e,t){var n=(0,i.JU)(r.db,"users/".concat(e));return(0,i.r7)(n,t)}},906:function(){},7663:function(e){!function(){var t={162:function(e){var t,n,i=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(i){try{return t.call(null,e,0)}catch(i){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],l=!1,h=-1;function u(){l&&a&&(l=!1,a.length?c=a.concat(c):h=-1,c.length&&d())}function d(){if(!l){var e=o(u);l=!0;for(var t=c.length;t;){for(a=c,c=[];++h<t;)a&&a[h].run();h=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||l||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}},o=!0;try{t[e](s,s.exports,i),o=!1}finally{o&&delete n[e]}return s.exports}i.ab="//";var r=i(162);e.exports=r}()},9008:function(e,t,n){e.exports=n(5443)},5690:function(e,t,n){"use strict";n.d(t,{x7:function(){return ye},ZP:function(){return _e}});var i=n(7294);let r={data:""},s=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||r,o=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,a=/\/\*[^]*?\*\/|\s\s+|\n/g,c=(e,t)=>{let n="",i="",r="";for(let s in e){let o=e[s];"@"==s[0]?"i"==s[1]?n=s+" "+o+";":i+="f"==s[1]?c(o,s):s+"{"+c(o,"k"==s[1]?"":t)+"}":"object"==typeof o?i+=c(o,t?t.replace(/([^,])+/g,(e=>s.replace(/(^:.*)|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):s):null!=o&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=c.p?c.p(s,o):s+":"+o+";")}return n+(t&&r?t+"{"+r+"}":r)+i},l={},h=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+h(e[n]);return t}return e},u=(e,t,n,i,r)=>{let s=h(e),u=l[s]||(l[s]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(s));if(!l[u]){let t=s!==e?e:(e=>{let t,n=[{}];for(;t=o.exec(e.replace(a,""));)t[4]?n.shift():t[3]?n.unshift(n[0][t[3]]=n[0][t[3]]||{}):n[0][t[1]]=t[2];return n[0]})(e);l[u]=c(r?{["@keyframes "+u]:t}:t,n?"":"."+u)}return((e,t,n)=>{-1==t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(l[u],t,i),u},d=(e,t,n)=>e.reduce(((e,i,r)=>{let s=t[r];if(s&&s.call){let e=s(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":c(e,""):!1===e?"":e}return e+i+(null==s?"":s)}),"");function f(e){let t=this||{},n=e.call?e(t.p):e;return u(n.unshift?n.raw?d(n,[].slice.call(arguments,1),t.p):n.reduce(((e,n)=>Object.assign(e,n&&n.call?n(t.p):n)),{}):n,s(t.target),t.g,t.o,t.k)}f.bind({g:1});let p,g,m,y=f.bind({k:1});function _(e,t){let n=this||{};return function(){let i=arguments;function r(s,o){let a=Object.assign({},s),c=a.className||r.className;n.p=Object.assign({theme:g&&g()},a),n.o=/ *go\d+/.test(c),a.className=f.apply(n,i)+(c?" "+c:""),t&&(a.ref=o);let l=e;return e[0]&&(l=a.as||e,delete a.as),m&&l[0]&&m(a),p(l,a)}return t?t(r):r}}function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},v.apply(this,arguments)}function w(e,t){return t||(t=e.slice(0)),e.raw=t,e}var b,T=function(e,t){return function(e){return"function"===typeof e}(e)?e(t):e},I=function(){var e=0;return function(){return(++e).toString()}}(),E=function(){var e=void 0;return function(){if(void 0===e&&"undefined"!==typeof window){var t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}}();!function(e){e[e.ADD_TOAST=0]="ADD_TOAST",e[e.UPDATE_TOAST=1]="UPDATE_TOAST",e[e.UPSERT_TOAST=2]="UPSERT_TOAST",e[e.DISMISS_TOAST=3]="DISMISS_TOAST",e[e.REMOVE_TOAST=4]="REMOVE_TOAST",e[e.START_PAUSE=5]="START_PAUSE",e[e.END_PAUSE=6]="END_PAUSE"}(b||(b={}));var C=new Map,k=function(e){if(!C.has(e)){var t=setTimeout((function(){C.delete(e),R({type:b.REMOVE_TOAST,toastId:e})}),1e3);C.set(e,t)}},S=function e(t,n){switch(n.type){case b.ADD_TOAST:return v({},t,{toasts:[n.toast].concat(t.toasts).slice(0,20)});case b.UPDATE_TOAST:return n.toast.id&&function(e){var t=C.get(e);t&&clearTimeout(t)}(n.toast.id),v({},t,{toasts:t.toasts.map((function(e){return e.id===n.toast.id?v({},e,n.toast):e}))});case b.UPSERT_TOAST:var i=n.toast;return t.toasts.find((function(e){return e.id===i.id}))?e(t,{type:b.UPDATE_TOAST,toast:i}):e(t,{type:b.ADD_TOAST,toast:i});case b.DISMISS_TOAST:var r=n.toastId;return r?k(r):t.toasts.forEach((function(e){k(e.id)})),v({},t,{toasts:t.toasts.map((function(e){return e.id===r||void 0===r?v({},e,{visible:!1}):e}))});case b.REMOVE_TOAST:return void 0===n.toastId?v({},t,{toasts:[]}):v({},t,{toasts:t.toasts.filter((function(e){return e.id!==n.toastId}))});case b.START_PAUSE:return v({},t,{pausedAt:n.time});case b.END_PAUSE:var s=n.time-(t.pausedAt||0);return v({},t,{pausedAt:void 0,toasts:t.toasts.map((function(e){return v({},e,{pauseDuration:e.pauseDuration+s})}))})}},N=[],A={toasts:[],pausedAt:void 0},R=function(e){A=S(A,e),N.forEach((function(e){e(A)}))},P={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},x=function(e){return function(t,n){var i=function(e,t,n){return void 0===t&&(t="blank"),v({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},n,{id:(null==n?void 0:n.id)||I()})}(t,e,n);return R({type:b.UPSERT_TOAST,toast:i}),i.id}},D=function(e,t){return x("blank")(e,t)};D.error=x("error"),D.success=x("success"),D.loading=x("loading"),D.custom=x("custom"),D.dismiss=function(e){R({type:b.DISMISS_TOAST,toastId:e})},D.remove=function(e){return R({type:b.REMOVE_TOAST,toastId:e})},D.promise=function(e,t,n){var i=D.loading(t.loading,v({},n,null==n?void 0:n.loading));return e.then((function(e){return D.success(T(t.success,e),v({id:i},n,null==n?void 0:n.success)),e})).catch((function(e){D.error(T(t.error,e),v({id:i},n,null==n?void 0:n.error))})),e};var O=function(e){var t=function(e){void 0===e&&(e={});var t=(0,i.useState)(A),n=t[0],r=t[1];(0,i.useEffect)((function(){return N.push(r),function(){var e=N.indexOf(r);e>-1&&N.splice(e,1)}}),[n]);var s=n.toasts.map((function(t){var n,i,r;return v({},e,e[t.type],t,{duration:t.duration||(null==(n=e[t.type])?void 0:n.duration)||(null==(i=e)?void 0:i.duration)||P[t.type],style:v({},e.style,null==(r=e[t.type])?void 0:r.style,t.style)})}));return v({},n,{toasts:s})}(e),n=t.toasts,r=t.pausedAt;(0,i.useEffect)((function(){if(!r){var e=Date.now(),t=n.map((function(t){if(t.duration!==1/0){var n=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(n<0))return setTimeout((function(){return D.dismiss(t.id)}),n);t.visible&&D.dismiss(t.id)}}));return function(){t.forEach((function(e){return e&&clearTimeout(e)}))}}}),[n,r]);var s=(0,i.useMemo)((function(){return{startPause:function(){R({type:b.START_PAUSE,time:Date.now()})},endPause:function(){r&&R({type:b.END_PAUSE,time:Date.now()})},updateHeight:function(e,t){return R({type:b.UPDATE_TOAST,toast:{id:e,height:t}})},calculateOffset:function(e,t){var i,r=t||{},s=r.reverseOrder,o=void 0!==s&&s,a=r.gutter,c=void 0===a?8:a,l=r.defaultPosition,h=n.filter((function(t){return(t.position||l)===(e.position||l)&&t.height})),u=h.findIndex((function(t){return t.id===e.id})),d=h.filter((function(e,t){return t<u&&e.visible})).length,f=(i=h.filter((function(e){return e.visible}))).slice.apply(i,o?[d+1]:[0,d]).reduce((function(e,t){return e+(t.height||0)+c}),0);return f}}}),[n,r]);return{toasts:n,handlers:s}};function M(){var e=w(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"]);return M=function(){return e},e}function L(){var e=w(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]);return L=function(){return e},e}function F(){var e=w(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return F=function(){return e},e}function U(){var e=w(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]);return U=function(){return e},e}var V=y(U()),q=y(F()),j=y(L()),$=_("div")(M(),(function(e){return e.primary||"#ff4b4b"}),V,q,(function(e){return e.secondary||"#fff"}),j);function G(){var e=w(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"]);return G=function(){return e},e}function B(){var e=w(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]);return B=function(){return e},e}var z=y(B()),K=_("div")(G(),(function(e){return e.secondary||"#e0e0e0"}),(function(e){return e.primary||"#616161"}),z);function W(){var e=w(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"]);return W=function(){return e},e}function H(){var e=w(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]);return H=function(){return e},e}function Y(){var e=w(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]);return Y=function(){return e},e}var X=y(Y()),Q=y(H()),J=_("div")(W(),(function(e){return e.primary||"#61d345"}),X,Q,(function(e){return e.secondary||"#fff"}));function Z(){var e=w(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"]);return Z=function(){return e},e}function ee(){var e=w(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]);return ee=function(){return e},e}function te(){var e=w(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]);return te=function(){return e},e}function ne(){var e=w(["\n  position: absolute;\n"]);return ne=function(){return e},e}var ie=_("div")(ne()),re=_("div")(te()),se=y(ee()),oe=_("div")(Z(),se),ae=function(e){var t=e.toast,n=t.icon,r=t.type,s=t.iconTheme;return void 0!==n?"string"===typeof n?(0,i.createElement)(oe,null,n):n:"blank"===r?null:(0,i.createElement)(re,null,(0,i.createElement)(K,Object.assign({},s)),"loading"!==r&&(0,i.createElement)(ie,null,"error"===r?(0,i.createElement)($,Object.assign({},s)):(0,i.createElement)(J,Object.assign({},s))))};function ce(){var e=w(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]);return ce=function(){return e},e}function le(){var e=w(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]);return le=function(){return e},e}var he=function(e){return"\n0% {transform: translate3d(0,"+-200*e+"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"},ue=function(e){return"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,"+-150*e+"%,-1px) scale(.6); opacity:0;}\n"},de=_("div",i.forwardRef)(le()),fe=_("div")(ce()),pe=(0,i.memo)((function(e){var t=e.toast,n=e.position,r=e.style,s=e.children,o=null!=t&&t.height?function(e,t){var n=e.includes("top")?1:-1,i=E()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[he(n),ue(n)],r=i[1];return{animation:t?y(i[0])+" 0.35s cubic-bezier(.21,1.02,.73,1) forwards":y(r)+" 0.4s forwards cubic-bezier(.06,.71,.55,1)"}}(t.position||n||"top-center",t.visible):{opacity:0},a=(0,i.createElement)(ae,{toast:t}),c=(0,i.createElement)(fe,Object.assign({},t.ariaProps),T(t.message,t));return(0,i.createElement)(de,{className:t.className,style:v({},o,r,t.style)},"function"===typeof s?s({icon:a,message:c}):(0,i.createElement)(i.Fragment,null,a,c))}));function ge(){var e=w(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]);return ge=function(){return e},e}!function(e,t,n,i){c.p=t,p=e,g=n,m=i}(i.createElement);var me=f(ge()),ye=function(e){var t=e.reverseOrder,n=e.position,r=void 0===n?"top-center":n,s=e.toastOptions,o=e.gutter,a=e.children,c=e.containerStyle,l=e.containerClassName,h=O(s),u=h.toasts,d=h.handlers;return(0,i.createElement)("div",{style:v({position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none"},c),className:l,onMouseEnter:d.startPause,onMouseLeave:d.endPause},u.map((function(e){var n,s=e.position||r,c=function(e,t){var n=e.includes("top"),i=n?{top:0}:{bottom:0},r=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return v({left:0,right:0,display:"flex",position:"absolute",transition:E()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:"translateY("+t*(n?1:-1)+"px)"},i,r)}(s,d.calculateOffset(e,{reverseOrder:t,gutter:o,defaultPosition:r})),l=e.height?void 0:(n=function(t){d.updateHeight(e.id,t.height)},function(e){e&&setTimeout((function(){var t=e.getBoundingClientRect();n(t)}))});return(0,i.createElement)("div",{ref:l,className:e.visible?me:"",key:e.id,style:c},"custom"===e.type?T(e.message,e):a?a(e):(0,i.createElement)(pe,{toast:e,position:s}))})))},_e=D},2238:function(e,t,n){"use strict";n.d(t,{Jn:function(){return b},qX:function(){return y},Xd:function(){return m},Mq:function(){return I},C6:function(){return E},ZF:function(){return T},KN:function(){return C}});var i=n(8463),r=n(3333),s=n(4444),o=n(8676);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const c="@firebase/app",l="0.7.18",h=new r.Yd("@firebase/app"),u="[DEFAULT]",d={[c]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},f=new Map,p=new Map;function g(e,t){try{e.container.addComponent(t)}catch(n){h.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function m(e){const t=e.name;if(p.has(t))return h.debug(`There were multiple attempts to register component ${t}.`),!1;p.set(t,e);for(const n of f.values())g(n,e);return!0}function y(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const _={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."},v=new s.LL("app","Firebase",_);class w{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw v.create("app-deleted",{appName:this._name})}}const b="9.6.8";function T(e,t={}){if("object"!==typeof t){t={name:t}}const n=Object.assign({name:u,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!==typeof r||!r)throw v.create("bad-app-name",{appName:String(r)});const o=f.get(r);if(o){if((0,s.vZ)(e,o.options)&&(0,s.vZ)(n,o.config))return o;throw v.create("duplicate-app",{appName:r})}const a=new i.H0(r);for(const i of p.values())a.addComponent(i);const c=new w(e,n,a);return f.set(r,c),c}function I(e="[DEFAULT]"){const t=f.get(e);if(!t)throw v.create("no-app",{appName:e});return t}function E(){return Array.from(f.values())}function C(e,t,n){var r;let s=null!==(r=d[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void h.warn(e.join(" "))}m(new i.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const k="firebase-heartbeat-store";let S=null;function N(){return S||(S=(0,o.openDb)("firebase-heartbeat-database",1,(e=>{if(0===e.oldVersion)e.createObjectStore(k)})).catch((e=>{throw v.create("storage-open",{originalErrorMessage:e.message})}))),S}async function A(e,t){try{const n=(await N()).transaction(k,"readwrite"),i=n.objectStore(k);return await i.put(t,R(e)),n.complete}catch(n){throw v.create("storage-set",{originalErrorMessage:n.message})}}function R(e){return`${e.name}!${e.options.appId}`}class P{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new x(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=(new Date).toISOString().substring(0,10);if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!this._heartbeatsCache.some((e=>e.date===t)))return this._heartbeatsCache.push({date:t,userAgent:e}),this._heartbeatsCache=this._heartbeatsCache.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache)return"";const{heartbeatsToSend:e,unsentEntries:t}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.userAgent===r.userAgent));if(e){if(e.dates.push(r.date),D(n)>t){e.dates.pop();break}}else if(n.push({userAgent:r.userAgent,dates:[r.date]}),D(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache),n=(0,s.h$)(JSON.stringify({version:2,heartbeats:e}));return t.length>0?(this._heartbeatsCache=t,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache=null,this._storage.deleteAll()),n}}class x{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{return(await N()).transaction(k).objectStore(k).get(R(e))}catch(t){throw v.create("storage-get",{originalErrorMessage:t.message})}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)||[]}return[]}async overwrite(e){return await this._canUseIndexedDBPromise?A(this.app,{heartbeats:e}):void 0}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return A(this.app,{heartbeats:[...t,...e]})}}async delete(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return A(this.app,{heartbeats:t.filter((t=>!e.includes(t)))})}}async deleteAll(){return await this._canUseIndexedDBPromise?async function(e){try{const t=(await N()).transaction(k,"readwrite");return await t.objectStore(k).delete(R(e)),t.complete}catch(t){throw v.create("storage-delete",{originalErrorMessage:t.message})}}(this.app):void 0}}function D(e){return(0,s.h$)(JSON.stringify({version:2,heartbeats:e})).length}var O;O="",m(new i.wA("platform-logger",(e=>new a(e)),"PRIVATE")),m(new i.wA("heartbeat",(e=>new P(e)),"PRIVATE")),C(c,l,O),C(c,l,"esm2017"),C("fire-js","")},8463:function(e,t,n){"use strict";n.d(t,{wA:function(){return r},H0:function(){return a}});var i=n(4444);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),i=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&s.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(i){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===s?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(r){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:function(e,t,n){"use strict";n.d(t,{in:function(){return r},Yd:function(){return l}});const i=[];var r;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));const s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=a[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class l{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],(function(){return t(6363),t(387)}));var n=e.O();_N_E=n}]);